{"version":3,"sources":["webpack:///webpack/bootstrap 01064f96f153b6ae8610","webpack:///./app/javascript/packs/spf/base.js","webpack:///./app/javascript/packs/common/csrf.js","webpack:///./app/javascript/packs/spf/array/array.js","webpack:///./app/javascript/packs/spf/state.js","webpack:///./app/javascript/packs/spf/config.js","webpack:///./app/javascript/packs/spf/string/string.js","webpack:///./app/javascript/packs/spf/debug/debug.js","webpack:///./app/javascript/packs/common/handleMethod2.js","webpack:///./app/javascript/packs/spf/dom/dom.js","webpack:///./app/javascript/packs/spf/history/history.js","webpack:///./app/javascript/packs/spf/url/url.js","webpack:///./app/javascript/packs/spf/cache/cache.js","webpack:///./app/javascript/packs/spf/dom/classlist.js","webpack:///./app/javascript/packs/spf/net/resource.js","webpack:///./app/javascript/packs/spf/net/script.js","webpack:///./app/javascript/packs/spf/net/style.js","webpack:///./app/javascript/packs/spf/tasks/tasks.js","webpack:///./app/javascript/packs/spf/dom/dataset.js","webpack:///./app/javascript/packs/spf/nav/nav.js","webpack:///./app/javascript/packs/spf/nav/response.js","webpack:///./app/javascript/packs/spf/pubsub/pubsub.js","webpack:///./app/javascript/packs/common/ActionCable.js","webpack:///./app/javascript/packs/common/loadingBar.js","webpack:///./app/javascript/packs/modules/dataLinks.js","webpack:///./app/javascript/packs/modules/formSubmit.js","webpack:///./app/javascript/packs/modules/postHandler.js","webpack:///./app/javascript/packs/spf/entry.js","webpack:///./app/stylesheet/globalA.scss","webpack:///./app/javascript/packs/common/handleMethod.js","webpack:///./app/javascript/packs/entries/globalA.js","webpack:///./app/javascript/packs/spf/async/async.js","webpack:///./app/javascript/packs/spf/main.js","webpack:///./app/javascript/packs/spf/nav/request.js","webpack:///./app/javascript/packs/spf/net/connect.js","webpack:///./app/javascript/packs/spf/net/xhr.js","webpack:///(webpack)/buildin/module.js"],"names":["spfBase","SPF_BOOTLOADER","SPF_DEBUG","SPF_TRACING","bind","fn","self","var_args","args","Array","prototype","slice","call","arguments","newArgs","push","apply","execute","err","dispatch","name","opt_detail","document","createEvent","evt","bubbles","cancelable","initCustomEvent","dispatchEvent","now","window","performance","timing","navigationStart","Date","getTime","uid","state","parseInt","nullFunction","EventName","CLICK","CSS_BEFORE_UNLOAD","CSS_UNLOAD","DONE","ERROR","HISTORY","JS_BEFORE_UNLOAD","JS_UNLOAD","PART_DONE","PART_PROCESS","PROCESS","READY","RELOAD","REQUEST","ScriptResource","StyleResource","LinkResource","ResponseFragment","SingleResponse","MultipartResponse","RequestOptions","EventDetail","TaskScheduler","rorParams","csrfToken","querySelector","getAttribute","csrfParam","isCrossDomain","originAnchor","createElement","href","location","urlAnchor","url","protocol","host","e","spfArray","ArrayLike","each","arr","opt_obj","forEach","i","l","length","every","some","filter","res","a","indexOf","val","opt_fromIndex","start","map","toArray","isArray","Object","toString","spfState","has","key","values_","get","set","value","Key","ASYNC_DEFERS","ASYNC_LISTENER","CACHE_COUNTER","CACHE_MAX","CACHE_STORAGE","CONFIG_VALUES","HISTORY_CALLBACK","HISTORY_ERROR_CALLBACK","HISTORY_IGNORE_POP","HISTORY_INIT","HISTORY_LISTENER","HISTORY_TIMESTAMP","HISTORY_URL","NAV_COUNTER","NAV_INIT","NAV_INIT_TIME","NAV_CLICK_LISTENER","NAV_MOUSEDOWN_LISTENER","NAV_SCROLL_LISTENER","NAV_SCROLL_TEMP_POSITION","NAV_SCROLL_TEMP_URL","NAV_PREFETCHES","NAV_PROMOTE","NAV_PROMOTE_TIME","NAV_REQUEST","PUBSUB_SUBS","RESOURCE_NAME","RESOURCE_PATHS_PREFIX","RESOURCE_STATUS","RESOURCE_URL","SCRIPT_DEPS","SCRIPT_URL","TASKS_UID","spfConfig","Value","defaults","init","opt_config","config","values","clear","spfString","contains","str","substr","startsWith","prefix","opt_offset","idx","lastIndexOf","endsWith","suffix","isString","trim","String","replace","partition","sep","split","nosep","join","hashcode","result","charCodeAt","toSelectorCase","toLowerCase","spfDebug","debug","isLevelEnabled","Level","DEBUG","log","info","INFO","warn","WARN","error","method","console","current","overall","formatDuration","start_","split_","unshift","direct_","reset","end","dur","toFixed","level","levels_","OUTPUT","handleMethod","link","linkMethod","obj","target","RPs","paramsObj","formEle","createForm","params","f","style","display","setAttribute","s","undefined","appendChild","appendFormToDom","form","body","submitForm","submit","spfDom","query","selector","opt_root","root","querySelectorAll","insertSiblingBefore","newNode","refNode","parentNode","insertBefore","insertSiblingAfter","nextSibling","unpackElement","element","child","parent","nodeType","removeNode","firstChild","removeChild","packElement","container","getAncestor","matcher","opt_parent","setAttributes","attributes","className","cssText","createIframe","opt_id","opt_document","opt_callback","id","doc","iframeEl","src","onload","spfHistory","callback","errorCallback","addEventListener","getCurrentUrl_","pop_","historyState","referrer","dispose","removeEventListener","add","opt_url","opt_state","opt_doCallback","push_","currentState","getCurrentState_","removeCurrentEntry","history","back","timestamp","doReplaceState_","doPushState_","data","title","iframe","getIframe","pushState","contentWindow","Error","replaceState","frame","getElementById","spfUrl","URLUtils","utils","aEl","hostname","port","pathname","search","hash","username","password","origin","absolute","relative","opt_keepHash","unhash","path","identify","opt_type","ident","type","hashParts","queryParts","querySep","queryVal","hashSep","hashVal","ext","substring","appendParameters","parameters","delim","removeParameters","param","regex","RegExp","_","appendPersistentParameters","parameterConfig","unprotocol","spfCache","storage","storage_","unit","valid_","updateCount_","remove","opt_lifetime","lifetime","max","create_","setTimeout","collect","trim_","Unit","isNaN","Infinity","age","extra","keys","min","count","opt_storage","spfDomClasslist","node","classList","match","cls","classes","item","newClasses","spfNetResource","status","load","opt_fn","isJS","Type","JS","canonicalize","pseudonym","topic","prevUrl","unloadPrepare_","unloadComplete","unloadComplete_","spfPubsub","subscribe","prevName","prevTopic","rename","check","el","find","create","unload","destroy","subscriptions","names","loaded","ready","flush","opt_statusGroup","opt_prevUrl","State","LOADING","tag","next","LOADED","label","onerror","onreadystatechange","test","readyState","targetEl","getElementsByTagName","async","rel","prevEl","els","discover","contentSelector","innerText","prefetch","opt_force","IMG","preconnect_","spfTasks","run","prefetch_","group","isCSS","CSS","fetchEl","IS_IE","extraElForIE","img","Image","eval","text","previous","complete","exec","styleSheet","createTextNode","paths","index","p","opt_group","status_","name_","url_","navigator","userAgent","spfNetScript","urls","opt_require","unknown","known","spf","sort","done","ignore","unsubscribe","require","unrequire","require_","deps","deps_","descendants","dep","list","descend","declare","opt_urls","spfNetStyle","opt_delay","queues","queues_","queue","createQueue_","task","createTask_","items","opt_sync","active","scheduledKey","timeoutKey","suspended","semaphore","do_","suspend","resume","cancel","clearAsyncTasks_","cancelAllExcept","opt_keyPrefix","opt_skipKey","keyPrefix","step","nextFn","taskFn","shift","scheduleTask_","delay","scheduler","addTask","cancelTask","clearTimeout","Task","Queue","spfDomDataset","dataset","string","spfNav","handleHistory_","dispatchError_","handleClick_","isTouchCapablePlatform_","handleMouseDown_","handleScroll_","handleClick","handleMouseDown","handleScroll","getAncestorWithLinkClass_","getAncestorWithNoLinkClass_","getAncestorWithHref_","tagName","getEventURL_","metaKey","altKey","ctrlKey","shiftKey","button","linkEl","nolinkEl","isAllowed_","destination","isEligible_","limit","isNavigable_","opt_current","absoluteUrl","absoluteCurrent","defaultPrevented","dispatchClick_","options","createOptions_","Info","navigate_","preventDefault","position","getScrollTempPosition_","clearScrollTempPosition_","scroll","referer","reverse","reloadId","reload","ReloadReason","FORBIDDEN","INELIGIBLE","dispatchHistory_","setScrollTempPosition_","navigate","opt_options","handleError","handleNavigateError_","navigateAddHistory_","navigateScroll_","dispatchRequest_","REQUEST_CANCELED","cancelAllPrefetchesExcept","preprocessKey","prefetches","prefetches_","prefetchXhr","navigatePromotePrefetch_","navigateSendRequest_","promoteKey","handlePart","handleNavigatePart_","handleSuccess","handleNavigateSuccess_","clearResourceTimings_","xhr","spfNavRequest","send","headers","onPart","onError","onSuccess","postData","scrolled","scrollIntoView","pageXOffset","pageYOffset","updateState","newState","opt_xhr","partial","dispatchPartProcess_","PART_PROCESS_CANCELED","RESPONSE_RECEIVED","handleNavigateRedirect_","spfNavResponse","process","dispatchPartDone_","response","original","multipart","dispatchProcess_","PROCESS_CANCELED","r","parts","part","dispatchDone_","redirectUrl","abort","reason","opt_err","message","logReason","dispatchReload_","encodeURIComponent","load_","handleLoadError_","handleLoadPart_","handleLoadSuccess_","withCredentials","addPrefetch","isPrefetch","removePrefetch","handleLoadRedirect_","processFn","preprocess","redirectFn","Callback","redirectOpts","resp","opt_noEvents","detail","proceed","opt_referer","opt_previous","opt_skipUrl","clearResourceTimings","opt_reqs","Info_","opt_info","parse","opt_multipart","opt_lastDitch","beginToken","Token","BEGIN","delimToken","DELIMITER","endToken","END","lastDitchHalfToken","chunk","finish","JSON","extract","isNavigate","isReverse","hasPosition","hasScrolled","sync","num","fullUrl","head","extracted","extract_","installLinks_","installStyles_","installScripts_","attrs","fragments","numBeforeFragments","installScripts","animationClass","noAnimation","CAN_ANIMATE_","htmlHandler","innerHTML","animation","Animation_","prepareAnimation_","runAnimation_","completeAnimation_","duration","numAfterFragments","numFragments","foot","preinstallLinks_","preinstallStyles_","preinstallScripts_","dirClass","fromClass","toClass","startClass","startClassDeprecated","oldEl","oldClass","newEl","newClass","html","endClass","endClassDeprecated","frag","Extraction_","script","ElementRegEx","SCRIPT_STYLE","full","attr","AttributeRegEx","NAME","SRC","ASYNC","TYPE","inject","LINK","REL","HREF","spfNetConnect","preconnect","testEl","prefixes","subFn","publish","publish_","opt_unsub","oldTopic","newTopic","existing","concat","ActionCable","INTERNAL","createConsumer","ref","getConfig","default_mount_path","Consumer","createWebSocketURL","startDebugging","debugging","stopDebugging","messages","module","exports","me","ConnectionMonitor","clamp","secondsSince","pollInterval","staleThreshold","connection","visibilityDidChange","reconnectAttempts","isRunning","startedAt","stoppedAt","startPolling","getPollInterval","stop","stopPolling","recordPing","pingedAt","recordConnect","disconnectedAt","recordDisconnect","poll","pollTimeout","_this","reconnectIfStale","interval","constructor","Math","round","connectionIsStale","disconnectedRecently","reopen","visibilityState","isOpen","time","number","message_types","protocols","supportedProtocols","unsupportedProtocol","Connection","reopenDelay","consumer","open","monitor","disconnected","webSocket","stringify","isActive","getState","uninstallEventHandlers","WebSocket","installEventHandlers","close","arg","allowReconnect","ref1","error1","getProtocol","isState","isProtocolSupported","states","eventName","handler","events","event","identifier","welcome","ping","confirmation","notify","rejection","reject","notifyAll","willAttemptReconnect","Subscriptions","channelName","mixin","channel","subscription","Subscription","ensureActiveConnection","sendCommand","forget","findAll","len","results","callbackName","command","extend","perform","action","object","properties","connect","disconnect","LoadingBar","height","width","percent","show","timer","loadingEle","bar","inner","setInterval","floor","random","clearInterval","update","backgroundColor","loadingBarEle","parentElement","dataLinks","processDataLink","ev","A","gc","currentName","hmInstance","fd","fa","processFormSubmit","tt","closest","fm","FormData","onProcess","fnpuLoad","onDone","formSubmit","exitProcessPostLink","processPostLink","spfEntry","api_","spfMain","extra_","spfEs","fn1","ns","fn2","app","onClick","onHistory","onRequest","onPartProcess","onPartDone","onScriptBeforeUnload","onScriptUnload","onStyleBeforeUnload","onStyleUnload","enabled","msg","ins","detach","timer_","spfAsync","defer","defers_","POSTMESSAGE_SUPPORTED_","postMessage","PREFIX_","run_","handleMessage_","addListener_","attachEvent","removeListener_","detachEvent","supported","listener","enable","canInit_","History","discover_","Options","toUpperCase","requestUrl","cacheKey","getCacheKey_","cached","getCacheObject_","handleCache","handleResponseFromCache_","configHeaders","headerId","chunking","Chunking_","handleHeaders","handleHeadersFromXHR_","handleChunk","handleChunkFromXHR_","handleComplete","handleCompleteFromXHR_","xhrOpts","timeoutMs","onHeaders","onChunk","onTimeout","responseType","spfNetXhr","post","updateCache","done_","getResponseHeader","parsed","responseText","t","startTime","metric","cacheType","cache","setCacheObject_","opt_cacheType","opt_requestType","opt_set","cacheValue","PostData","chunked","offset","XMLHttpRequest","xhr_abort","HEADERS_RECEIVED","isChunked_","getEntriesByName","pop","isFormData","addContentTypeFormUrlEncoded","setRequestHeader","encoding","firefoxSpdy","loadTimes","chrome","chromeSpdy","wasFetchedViaSpdy","UNSENT","OPENED"],"mappings":"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","file":"globalA.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/packs/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 74);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 01064f96f153b6ae8610","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview The base SPF functions.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// A general note on the SPF framework.\n//\n// SPF is an independent framework intended to be compiled using the Closure\n// Compiler, but it has no dependencies on the Closure Library.  Each file has\n// goog.provide and goog.require statements for automatic dependency management\n// by the compiler, but these primitives are processed and removed during\n// compilation.  For testing and development, these functions are stubbed in\n// stub.js.\n//\n// A general note on browser compatibility.\n//\n// SPF aims to be broadly compatible with the most common browsers, as long as\n// that support does not require an inordinate amount of code.  In addition,\n// the primary functionality of SPF -- pushstate-based navigation -- requires\n// advanced browser functionality not found in older browsers.  In practice,\n// this means that the common library functions are supported in IE 8+, with\n// all functions supported in IE 10+.\n\n// goog.provide('spf');\n\nlet spfBase = {}\n\n/** @define {boolean} Compiler flag to build the bootstrap script loader. */\nvar SPF_BOOTLOADER = false\n\n/** @define {boolean} Compiler flag to include debugging code. */\nvar SPF_DEBUG = false\n\n/** @define {boolean} Compiler flag to include tracing code. */\nvar SPF_TRACING = false\n\n/**\n * Creates a new function that, when called, has its `this` set to the\n * provided value, with a given sequence of arguments preceding any provided\n * when the new function is called.\n *\n * @param {?function(this:T, ...)} fn A function to partially apply.\n * @param {T} self Specifies the object which this should point to when the\n *     function is run.\n * @param {...*} var_args Additional arguments that are partially applied to the\n *     function.\n * @return {!Function} A partially-applied form of the function bind() was\n *     invoked on.\n * @template T\n */\nspfBase.bind = function (fn, self, var_args) {\n  var args = Array.prototype.slice.call(arguments, 2)\n  return function () {\n    // Clone the args and append additional ones.\n    var newArgs = args.slice()\n    newArgs.push.apply(newArgs, arguments)\n    return fn.apply(self, newArgs)\n  }\n}\n\n/**\n * Executes a function inside a try/catch to gracefully handle failures.\n *\n * @param {Function} fn Function to be executed.\n * @param {...*} var_args Arguments to apply to the function.\n * @return {*} The function result or Error if execution failed.\n */\nspfBase.execute = function (fn, var_args) {\n  if (fn) {\n    var args = Array.prototype.slice.call(arguments, 1)\n    try {\n      return fn.apply(null, args)\n    } catch (err) {\n      return err\n    }\n  }\n}\n\n/**\n * Dispatches a custom event.\n *\n * @param {spfBase.EventName} name The custom event name.\n * @param {!Object=} opt_detail The custom event detail (data).\n * @return {boolean} False if the event was canceled.\n */\nspfBase.dispatch = function (name, opt_detail) {\n  if (document.createEvent) {\n    var evt = document.createEvent('CustomEvent')\n    var bubbles = true\n    var cancelable = true\n    evt.initCustomEvent(name, bubbles, cancelable, opt_detail)\n    return document.dispatchEvent(evt)\n  }\n  return true\n}\n\n/**\n * Gets the current timestamp.\n *\n * @return {number} A value representing the number of milliseconds\n *     between midnight, January 1, 1970 and the current time.  On browsers\n *     that support DOMHighResTimestamp, this value is a floating point number;\n *     otherwise, it is an integer.\n */\nspfBase.now = (function () {\n  if (window.performance && window.performance.timing &&\n      window.performance.now) {\n    return function () {\n      return (window.performance.timing.navigationStart +\n              window.performance.now())\n    }\n  }\n  return function () {\n    return (new Date()).getTime()\n  }\n})()\n\n/**\n * Gets a UID.\n *\n * @return {number} A unique number.\n */\nspfBase.uid = function () {\n  // Special case to not use spfBase.state directly to avoid circular dependencies.\n  var state = (window['_spf_state'] = window['_spf_state'] || {})\n  var uid = parseInt(state['uid'], 10) || 0\n  uid++\n  return (state['uid'] = uid)\n}\n\n/**\n * An empty no-op function.\n */\nspfBase.nullFunction = function () {}\n\n/**\n * @enum {string}\n */\nspfBase.EventName = {\n  CLICK: 'spfclick',\n  CSS_BEFORE_UNLOAD: 'spfcssbeforeunload',\n  CSS_UNLOAD: 'spfcssunload',\n  DONE: 'spfdone',\n  ERROR: 'spferror',\n  HISTORY: 'spfhistory',\n  JS_BEFORE_UNLOAD: 'spfjsbeforeunload',\n  JS_UNLOAD: 'spfjsunload',\n  PART_DONE: 'spfpartdone',\n  PART_PROCESS: 'spfpartprocess',\n  PROCESS: 'spfprocess',\n  READY: 'spfready',\n  RELOAD: 'spfreload',\n  REQUEST: 'spfrequest'\n}\n\n/** Type definition for a parsed script resource in a SPF response fragment.\n *\n * @typedef {{\n *   url: (string|undefined),\n *   text: (string|undefined),\n *   name: (string|undefined),\n *   async: (boolean|undefined)\n * }}\n */\nspfBase.ScriptResource\n\n/** Type definition for a parsed style resource in a SPF response fragment.\n *\n * @typedef {{\n *   url: (string|undefined),\n *   text: (string|undefined),\n *   name: (string|undefined)\n * }}\n */\nspfBase.StyleResource\n\n/** Type definition for a parsed link resource in a SPF response fragment.\n *\n * @typedef {{\n *   url: (string|undefined),\n *   rel: (string|undefined)\n * }}\n */\nspfBase.LinkResource\n\n/**\n * Type definition for a fragment of a SPF response.  Either a string of HTML or\n * an object with the resources parsed out of the HTML.\n *\n * @typedef {string|{\n *   html: (string|undefined),\n *   scripts: (Array.<spf.ScriptResource>|undefined),\n *   styles: (Array.<spf.StyleResource>|undefined),\n *   links: (Array.<spf.LinkResource>|undefined)\n * }}\n */\nspfBase.ResponseFragment\n\n/**\n * Type definition for a single SPF response object.\n * - attr: Map of Element IDs to maps of attibute names to attribute values\n *       to set on the Elements.\n * - body: Map of Element IDs to HTML strings containing content with which\n *       to update the Elements.\n * - cacheKey: Key used to cache this response.\n * - cacheType: String of the type of caching to use for this response.\n * - foot: HTML string containing <script> tags of JS to execute.\n * - head: HTML string containing <link> and <style> tags of CSS to install.\n * - name: String of the general name of this type of response. This will be\n *       used to generate \"from\" and \"to\" CSS classes for animation.\n * - redirect: String of a URL to request instead.\n * - reload: Boolean to indicate the page should be reloaded.\n * - timing: Map of timing attributes to timestamp numbers.\n * - title: String of the new Document title.\n * - url: String of the correct URL for the current request. This will replace\n *       the current URL in history.\n *\n * @typedef {{\n *   attr: (Object.<string, Object.<string, string>>|undefined),\n *   body: (Object.<string, spf.ResponseFragment>|undefined),\n *   cacheKey: (string|undefined),\n *   cacheType: (string|undefined),\n *   foot: (spf.ResponseFragment|undefined),\n *   head: (spf.ResponseFragment|undefined),\n *   name: (string|undefined),\n *   redirect: (string|undefined),\n *   reload: (boolean|undefined),\n *   timing: (Object.<string, number>|undefined),\n *   title: (string|undefined),\n *   url: (string|undefined)\n * }}\n */\nspfBase.SingleResponse\n\n/**\n * Type definition for a multipart SPF response object.\n * - cacheKey: Key used to cache this response.\n * - cacheType: String of the type of caching to use for this response.\n * - parts: List of response objects.\n * - timing: Map of timing attributes to timestamp numbers.\n * - type: The string \"multipart\".\n *\n * @typedef {{\n *   cacheKey: (string|undefined),\n *   cacheType: (string|undefined),\n *   parts: (Array.<spf.SingleResponse>|undefined),\n *   timing: (Object.<string, number>|undefined),\n *   type: string\n * }}\n */\nspfBase.MultipartResponse\n\n/**\n * Type definition for the configuration options for requesting a URL.\n * - headers: optional map of headers to send with the request.\n * - method: optional method with which to send the request; defaults to \"GET\".\n * - onDone: optional callback when either repsonse is done being processed.\n * - onError: optional callback if an error occurs.\n * - onPartDone: optional callback when part of a multipart response is done\n *       being processed.\n * - onPartProcess: optional callback when part of a multipart response will be\n *       pocessed.\n * - onProcess: optional callback when a single response will be processed.\n * - onRequest: optional callback when a request will be made.\n * - postData: optional data to send with a request.  Only used if the method\n *       is set to \"POST\".\n * - withCredentials: optional flag to send credentials if true.\n *\n * @typedef {{\n *   headers: (Object.<string>|undefined),\n *   method: (string|undefined),\n *   onDone: (function(spf.EventDetail)|undefined),\n *   onError: (function(spf.EventDetail)|undefined),\n *   onPartDone: (function(spf.EventDetail)|undefined),\n *   onPartProcess: (function(spf.EventDetail)|undefined),\n *   onProcess: (function(spf.EventDetail)|undefined),\n *   onRequest: (function(spf.EventDetail)|undefined),\n *   postData: (ArrayBuffer|Blob|Document|FormData|null|string|undefined),\n *   withCredentials: (boolean|undefined)\n * }}\n */\nspfBase.RequestOptions\n\n/**\n * Type definition for custom event detail (data), also used for callbacks.\n * - err: optional error that occurred; defined for \"error\" events\n * - name: optional name of the script or stylesheet that will be unloaded;\n *       defined for \"jsbeforeunload\", \"jsunload\", \"cssbeforeunload\",\n *       and \"cssunload\" events.\n * - part: optional part of a multipart response; defined for \"partprocess\"\n *       and \"partdone\" events.\n * - previous: optional URL of the previous page; defined for \"history\" and\n *       \"request\" events.\n * - reason: optional reason code and text; defined for the \"reload\" event.\n * - referer: optional URL of the referer page; defined for \"history\" and\n *       \"request\" events.\n * - response: optional complete response; defined for \"process\" and\n *       \"done\" events.\n * - target: optional target element; defined for \"click\" events.\n * - url: optional URL of the request; defined for \"error\", \"reload\", \"click\",\n *       \"history\", \"request\", \"partprocess\", \"partdone\", \"process\", and \"done\"\n *       events - or - optional URL of the script/stylesheet that will be\n *       unloaded; defined for \"jsbeforeunload\", \"jsunload\", \"cssbeforeunload\",\n *       and \"cssunload\" events.\n *\n * @typedef {{\n *   err: (Error|undefined),\n *   name: (string|undefined),\n *   part: (spf.SingleResponse|undefined),\n *   previous: (string|undefined),\n *   reason: (string|undefined),\n *   referer: (string|undefined),\n *   target: (Element|undefined),\n *   response: (spf.SingleResponse|spf.MultipartResponse|undefined),\n *   url: (string|undefined)\n * }}\n */\nspfBase.EventDetail\n\n/**\n * Type definition for a task scheduler optionally used by spf.tasks.\n * - addTask: Function to add a new task to the scheduler. It returns a key\n *       which can be used to cancel its execution.\n * - cancelTask: Function which cancels a previously scheduled task.\n *\n * @typedef {{\n *   addTask: (function(!Function): number),\n *   cancelTask: (function(number))\n * }}\n */\nspfBase.TaskScheduler\n\nexport {SPF_DEBUG, SPF_BOOTLOADER, SPF_TRACING, spfBase}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/base.js","export let rorParams = {\n  // Up-to-date Cross-Site Request Forgery token\n  csrfToken: () => document.querySelector('meta[name=csrf-token]').getAttribute('content'),\n  // URL param that must contain the CSRF token\n  csrfParam: () => document.querySelector('meta[name=csrf-param]').getAttribute('content'),\n  // Determines if the request is a cross domain request.\n  isCrossDomain: url => {\n    let originAnchor = document.createElement('a')\n    originAnchor.href = location.href\n    let urlAnchor = document.createElement('a')\n\n    try {\n      urlAnchor.href = url\n      // This is a workaround to a IE bug.\n      urlAnchor.href = urlAnchor.href\n\n      // If URL protocol is false or is a string containing a single colon\n      // *and* host are false, assume it is not a cross-domain request\n      // (should only be the case for IE7 and IE compatibility mode).\n      // Otherwise, evaluate protocol and host of the URL against the origin\n      // protocol and host.\n      return !(((!urlAnchor.protocol || urlAnchor.protocol === ':') && !urlAnchor.host) ||\n        (originAnchor.protocol + '//' + originAnchor.host ===\n          urlAnchor.protocol + '//' + urlAnchor.host))\n    } catch (e) {\n      // If there is an error parsing the URL, assume it is crossDomain.\n      return true\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/common/csrf.js","/**\n * @fileoverview Array manipulation functions.\n *\n */\n\n// goog.provide('spfArray');\n\nimport {spfBase, SPF_BOOTLOADER} from '../base'\nlet spfArray = {}\n\n/**\n * @typedef {Array|NodeList|Arguments|{length: number}}\n */\nspfArray.ArrayLike\n\n/**\n * Compatible Array#forEach implementation.\n *\n * @param {Array.<ITEM>|spfArray.ArrayLike} arr The array.\n * @param {?function(this:THIS, ITEM, number, ?) : ?} fn The function to\n *   execute for each item.  The function is executed with three arguments:\n *   the item value, the item index, and the array.\n * @param {THIS=} opt_obj The value to use as \"this\" in the function.\n * @template THIS, ITEM\n */\nspfArray.each = function (arr, fn, opt_obj) {\n  // When built for the bootloader, optimize for size over speed.\n  if (!SPF_BOOTLOADER && arr.forEach) {\n    arr.forEach(fn, opt_obj)\n    return\n  }\n  for (var i = 0, l = arr.length; i < l; i++) {\n    if (i in arr) {\n      fn.call(opt_obj, arr[i], i, arr)\n    }\n  }\n}\n\n/**\n * Compatible Array#every implementation.\n *\n * @param {Array.<ITEM>|spfArray.ArrayLike} arr The array.\n * @param {?function(this:THIS, ITEM, number, ?) : boolean} fn The function to\n *   execute for each item.  The function is executed with three arguments:\n *   the item value, the item index, and the array; it should return true\n *   or false.\n * @param {THIS=} opt_obj The value to use as \"this\" in the function.\n * @return {boolean} Whether the result of every execution was truthy.\n * @template THIS, ITEM\n */\nspfArray.every = function (arr, fn, opt_obj) {\n  // When built for the bootloader, optimize for size over speed.\n  if (!SPF_BOOTLOADER && arr.every) {\n    return arr.every(fn, opt_obj)\n  }\n  for (var i = 0, l = arr.length; i < l; i++) {\n    if (i in arr && !fn.call(opt_obj, arr[i], i, arr)) {\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * Compatible Array#some implementation.\n *\n * @param {Array.<ITEM>|spfArray.ArrayLike} arr The array.\n * @param {?function(this:THIS, ITEM, number, ?) : boolean} fn The function to\n *   execute for each item.  The function is executed with three arguments:\n *   the item value, the item index, and the array; it should return true\n *   or false.\n * @param {THIS=} opt_obj The value to use as \"this\" in the function.\n * @return {boolean} Whether the result of any execution was truthy.\n * @template THIS, ITEM\n */\nspfArray.some = function (arr, fn, opt_obj) {\n  // When built for the bootloader, optimize for size over speed.\n  if (!SPF_BOOTLOADER && arr.some) {\n    return arr.some(fn, opt_obj)\n  }\n  for (var i = 0, l = arr.length; i < l; i++) {\n    if (i in arr && fn.call(opt_obj, arr[i], i, arr)) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n * Compatible Array#filter implementation.\n *\n * @param {Array.<ITEM>|spfArray.ArrayLike} arr The array.\n * @param {?function(this:THIS, ITEM, number, ?) : RESULT} fn The function to\n *   execute for each item.  The function is executed with three arguments:\n *   the item value, the item index, and the array; it should return the\n *   new result.\n * @param {THIS=} opt_obj The value to use as \"this\" in the function.\n * @return {!Array.<RESULT>} A new array of filtered results.\n * @template THIS, ITEM, RESULT\n */\nspfArray.filter = function (arr, fn, opt_obj) {\n  // When built for the bootloader, optimize for size over speed.\n  if (!SPF_BOOTLOADER && arr.filter) {\n    return arr.filter(fn, opt_obj)\n  }\n  var res = []\n  spfArray.each(arr, function (a, i, arr) {\n    if (fn.call(opt_obj, a, i, arr)) {\n      res.push(a)\n    }\n  })\n  return res\n}\n\n/**\n * Compatible Array#indexOf implementation.\n *\n * @param {Array.<ITEM>|spfArray.ArrayLike} arr The array.\n * @param {ITEM} val The value to find.\n * @param {number=} opt_fromIndex The starting index to search from.\n * @return {number} The index of the first matching element.\n * @template ITEM\n */\nspfArray.indexOf = function (arr, val, opt_fromIndex) {\n  if (!SPF_BOOTLOADER && arr.indexOf) {\n    return arr.indexOf(val, opt_fromIndex)\n  }\n  var start = opt_fromIndex || 0\n  for (var i = start; i < arr.length; i++) {\n    if (i in arr && arr[i] === val) {\n      return i\n    }\n  }\n  return -1\n}\n\n/**\n * Compatible Array#map implementation.\n *\n * @param {Array.<ITEM>|spfArray.ArrayLike} arr The array.\n * @param {?function(this:THIS, ITEM, number, ?) : RESULT} fn The function to\n *   execute for each item.  The function is executed with three arguments:\n *   the item value, the item index, and the array; it should return the\n *   new result.\n * @param {THIS=} opt_obj The value to use as \"this\" in the function.\n * @return {Array.<RESULT>} A new array of mapped results.\n * @template THIS, ITEM, RESULT\n */\nspfArray.map = function (arr, fn, opt_obj) {\n  // When built for the bootloader, optimize for size over speed.\n  if (!SPF_BOOTLOADER && arr.map) {\n    return arr.map(fn, opt_obj)\n  }\n  var res = []\n  res.length = arr.length\n  spfArray.each(arr, function (a, i, arr) {\n    res[i] = fn.call(opt_obj, a, i, arr)\n  })\n  return res\n}\n\n/**\n * Converts to an array if needed.\n *\n * @param {?} val The value.\n * @return {Array} An array.\n */\nspfArray.toArray = function (val) {\n  return spfArray.isArray(val) ? val : [val]\n}\n\n/**\n * Simple Array.isArray implementation.\n *\n * @param {?} val Value to test.\n * @return {boolean} Whether the value is an array.\n */\nspfArray.isArray = function (val) {\n  // When built for the bootloader, optimize for size over complete accuracy.\n  if (SPF_BOOTLOADER) {\n    // This test will fail if a fake object like \"{push: 1}\" is passed in, but\n    // for the bootloader, this is an acceptable trade off.\n    return !!(val && val.push)\n  }\n  return Object.prototype.toString.call(val) == '[object Array]'\n}\n\nexport default spfArray\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/array/array.js","// Copyright 2014 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions for handling the SPF state.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// goog.provide('spfState');\n\nlet spfState = {}\n\n/**\n * Checks whether a current state value exists.\n *\n * @param {spfState.Key} key The state key.\n * @return {boolean} Whether the state value exists.\n */\nspfState.has = function (key) {\n  return key in spfState.values_\n}\n\n/**\n * Gets a current state value.\n *\n * @param {spfState.Key} key The state key.\n * @return {*} The state value.\n */\nspfState.get = function (key) {\n  return spfState.values_[key]\n}\n\n/**\n * Sets a current state value.\n *\n * @param {spfState.Key} key The state key.\n * @param {T} value The state value.\n * @return {T} The state value.\n * @template T\n */\nspfState.set = function (key, value) {\n  spfState.values_[key] = value\n  return value\n}\n\n/**\n * @enum {string}\n */\nspfState.Key = {\n  ASYNC_DEFERS: 'async-defers',\n  ASYNC_LISTENER: 'async-listener',\n  CACHE_COUNTER: 'cache-counter',\n  CACHE_MAX: 'cache-max',\n  CACHE_STORAGE: 'cache-storage',\n  CONFIG_VALUES: 'config',\n  HISTORY_CALLBACK: 'history-callback',\n  HISTORY_ERROR_CALLBACK: 'history-error-callback',\n  HISTORY_IGNORE_POP: 'history-ignore-pop',\n  HISTORY_INIT: 'history-init',\n  HISTORY_LISTENER: 'history-listener',\n  HISTORY_TIMESTAMP: 'history-timestamp',\n  HISTORY_URL: 'history-url',\n  NAV_COUNTER: 'nav-counter',\n  NAV_INIT: 'nav-init',\n  NAV_INIT_TIME: 'nav-init-time',\n  NAV_CLICK_LISTENER: 'nav-listener',\n  NAV_MOUSEDOWN_LISTENER: 'nav-mousedown-listener',\n  NAV_SCROLL_LISTENER: 'nav-scroll-listener',\n  NAV_SCROLL_TEMP_POSITION: 'nav-scroll-position',\n  NAV_SCROLL_TEMP_URL: 'nav-scroll-url',\n  NAV_PREFETCHES: 'nav-prefetches',\n  NAV_PROMOTE: 'nav-promote',\n  NAV_PROMOTE_TIME: 'nav-promote-time',\n  NAV_REQUEST: 'nav-request',\n  PUBSUB_SUBS: 'ps-s',\n  RESOURCE_NAME: 'rsrc-n',\n  RESOURCE_PATHS_PREFIX: 'rsrc-p-',\n  RESOURCE_STATUS: 'rsrc-s',\n  RESOURCE_URL: 'rsrc-u',\n  SCRIPT_DEPS: 'js-d',\n  SCRIPT_URL: 'js-u',\n  TASKS_UID: 'uid'\n}\n\n/**\n * Current state values.  Globally exported to maintain continuity\n * across revisions.\n * @private {Object}\n */\nspfState.values_ = {}\nspfState['_spf_state'] = spfState.values_\n\nexport default spfState\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/state.js","// Copyright 2014 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions for handling the SPF config.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport spfState from './state'\nlet spfConfig = {}\n\n/**\n * Type definition for a SPF config value.\n *\n * Function type temporarily needed for experimental-html-handler.\n * TODO(philharnish): Remove \"Function\".\n *\n * @typedef {string|number|boolean|Function|null}\n */\nspfConfig.Value\n\n/**\n * Default configuration values.\n * @type {!Object.<spfConfig.Value>}\n */\nspfConfig.defaults = {\n  'animation-class': 'fnpu-animate',\n  'animation-duration': 425,\n  'cache-lifetime': 10 * 60 * 1000,  // 10 minute cache lifetime (ms).\n  'cache-max': 50,  // 50 items.\n  'cache-unified': false,\n  'link-class': 'fnpu-link',\n  'nolink-class': 'fnpu-nolink',\n  'navigate-limit': 20,  // 20 navigations per session.\n  'navigate-lifetime': 24 * 60 * 60 * 1000,  // 1 day session lifetime (ms).\n  'reload-identifier': null,  // Always a param, no '?' needed.\n  'request-timeout': 0,  // No request timeout.\n  'url-identifier': '?fnpu=__type__'\n}\n\n/**\n * Initialize the configuration with an optional object.  If values are not\n * provided, the defaults are used if they exist.\n *\n * @param {Object.<spfConfig.Value>=} opt_config Optional configuration object.\n */\nspfConfig.init = function (opt_config) {\n  var config = opt_config || {}\n  // Set primary configs; each has a default.\n  for (var key in spfConfig.defaults) {\n    var value = (key in config) ? config[key] : spfConfig.defaults[key]\n    spfConfig.set(key, value)\n  }\n  // Set advanced and experimental configs; none have defaults.\n  for (var key in config) {\n    if (!(key in spfConfig.defaults)) {\n      spfConfig.set(key, config[key])\n    }\n  }\n}\n\n/**\n * Checks whether a current configuration value exists.\n *\n * @param {string} name The configuration name.\n * @return {boolean} Whether the configuration value exists.\n */\nspfConfig.has = function (name) {\n  return name in spfConfig.values\n}\n\n/**\n * Gets a current configuration value.\n *\n * @param {string} name The configuration name.\n * @return {spfConfig.Value|undefined} The configuration value.\n */\nspfConfig.get = function (name) {\n  return spfConfig.values[name]\n}\n\n/**\n * Sets a current configuration value.\n *\n * @param {string} name The configuration name.\n * @param {spfConfig.Value} value The configuration value.\n * @return {spfConfig.Value} The configuration value.\n */\nspfConfig.set = function (name, value) {\n  spfConfig.values[name] = value\n  return value\n}\n\n/**\n * Removes all data from the config.\n */\nspfConfig.clear = function () {\n  for (var key in spfConfig.values) {\n    delete spfConfig.values[key]\n  }\n}\n\n/**\n * The config storage object.\n * @type {!Object.<spfConfig.Value>}\n */\nspfConfig.values = {}\n\n// Automatic initialization for spfConfig.values.\nif (!spfState.has(spfState.Key.CONFIG_VALUES)) {\n  spfState.set(spfState.Key.CONFIG_VALUES, spfConfig.values)\n}\nspfConfig.values = /** @type {!Object.<spfConfig.Value>} */ (\n    spfState.get(spfState.Key.CONFIG_VALUES))\n\nexport default spfConfig\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/config.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview String manipulation functions.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport {spfBase, SPF_BOOTLOADER} from '../base'\nlet spfString = {}\n\n// goog.provide('spfString');\n\n// goog.require('spf');\n\n/**\n * Checks whether a string contains a given substring.\n *\n * @param {string} str The string to test.\n * @param {string} substr The substring to test for.\n * @return {boolean} True if `str` contains `substr`.\n */\nspfString.contains = function (str, substr) {\n  return str.indexOf(substr) != -1\n}\n\n/**\n * Fast prefix-checker.\n *\n * @param {string} str The string to check.\n * @param {string} prefix A string to look for at the start of `str`.\n * @param {number=} opt_offset Offset from index 0 at which to check.\n * @return {boolean} True if `str` begins with `prefix`.\n */\nspfString.startsWith = function (str, prefix, opt_offset) {\n  var idx = opt_offset || 0\n  return str.lastIndexOf(prefix, idx) == idx\n}\n\n/**\n * Fast suffix-checker.\n *\n * @param {string} str The string to check.\n * @param {string} suffix A string to look for at the end of `str`.\n * @return {boolean} True if `str` ends with `suffix`.\n */\nspfString.endsWith = function (str, suffix) {\n  var l = str.length - suffix.length\n  return l >= 0 && str.indexOf(suffix, l) == l\n}\n\n/**\n * Simple check for if a value is a string.\n *\n * @param {?} val Value to test.\n * @return {boolean} Whether the value is a string.\n */\nspfString.isString = function (val) {\n  // When built for the bootloader, optimize for size over complete accuracy.\n  if (SPF_BOOTLOADER) {\n    // The return value for typeof will be one of the following:\n    // * number\n    // * string\n    // * boolean\n    // * function\n    // * object\n    // * undefined\n    // Match \"string\" to provide an identity test.\n    // This test will fail if a string object like \"new String()\" is passed in,\n    // but for the bootloader, this is an acceptable trade off.\n    return typeof val === 'string'\n  }\n  return Object.prototype.toString.call(val) == '[object String]'\n}\n\n/**\n * Removes leading and trailing whitespace.\n *\n * @param {string} str The string to trim.\n * @return {string} The trimmed string.\n */\nspfString.trim = (function () {\n  if (String.prototype.trim) {\n    return function (str) { return str.trim() }\n  } else {\n    return function (str) { return str.replace(/^\\s+|\\s+$/g, '') }\n  }\n})()\n\n/**\n * Partitions a string by dividing it at the first occurance of a separator and\n * returning an array of 3 parts: the part before the separator, the separator\n * itself, and the part after the separator.  If the separator is not found,\n * the last two items will be empty strings.\n *\n * @param {string} str The string to partition.\n * @param {string} sep The separator.\n * @return {!Array.<string>} The partitioned string result.\n */\nspfString.partition = function (str, sep) {\n  var arr = str.split(sep)\n  var nosep = arr.length == 1\n  return [arr[0], (nosep ? '' : sep), (nosep ? '' : arr.slice(1).join(sep))]\n}\n\n/**\n * String hash function similar to java.lang.String.hashCode().\n * The hash code for a string is computed as\n * s[0] * 31 ^ (n - 1) + s[1] * 31 ^ (n - 2) + ... + s[n - 1],\n * where s[i] is the ith character of the string and n is the length of\n * the string. We mod the result to make it between 0 (inclusive) and 2^32\n * (exclusive).\n *\n * @param {string} str A string.\n * @return {number} Hash value for `str`, between 0 (inclusive) and 2^32\n *  (exclusive). The empty string returns 0.\n */\nspfString.hashcode = function (str) {\n  str = str || ''\n  var result = 0\n  for (var i = 0, l = str.length; i < l; ++i) {\n    result = 31 * result + str.charCodeAt(i)\n    // Normalize to 4 byte range, 0 ... 2^32.\n    result %= 0x100000000\n  }\n  return result\n}\n\n/**\n * Converts a string from camelCase to selector-case (e.g. from\n * \"multiPartString\" to \"multi-part-string\"), useful for converting JS\n * style and dataset properties to equivalent CSS selectors and HTML keys.\n *\n * @param {string} str The string in camelCase form.\n * @return {string} The string in selector-case form.\n */\nspfString.toSelectorCase = function (str) {\n  return String(str).replace(/([A-Z])/g, '-$1').toLowerCase()\n}\n\nexport default spfString\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/string/string.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Debugging and console logging functions.\n * This module is designed to be removed completely by the compiler\n * for production builds.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// goog.provide('spfDebug');\n\nimport {spfBase, SPF_DEBUG} from '../base'\n\nlet spfDebug = {}\n\n/**\n * Log to the browser console using \"debug\", the low priority method.\n *\n * @param {...*} var_args Items to log.\n */\nspfDebug.debug = function (var_args) {\n  if (spfDebug.isLevelEnabled(spfDebug.Level.DEBUG)) {\n    spfDebug.log(spfDebug.Level.DEBUG, 'spf', arguments)\n  }\n}\n\n/**\n * Log to the browser console using \"info\", the medium priority method.\n *\n * @param {...*} var_args Items to log.\n */\nspfDebug.info = function (var_args) {\n  if (spfDebug.isLevelEnabled(spfDebug.Level.INFO)) {\n    spfDebug.log(spfDebug.Level.INFO, 'spf', arguments)\n  }\n}\n\n/**\n * Log to the browser console using \"warn\", the high priority method.\n *\n * @param {...*} var_args Items to log.\n */\nspfDebug.warn = function (var_args) {\n  if (spfDebug.isLevelEnabled(spfDebug.Level.WARN)) {\n    spfDebug.log(spfDebug.Level.WARN, 'spf', arguments)\n  }\n}\n\n/**\n * Log to the browser console using \"error\", the critical priority method.\n *\n * @param {...*} var_args Items to log.\n */\nspfDebug.error = function (var_args) {\n  if (spfDebug.isLevelEnabled(spfDebug.Level.ERROR)) {\n    spfDebug.log(spfDebug.Level.ERROR, 'spf', arguments)\n  }\n}\n\n/**\n * Log to the browser console the specified method.  If the method does not\n * exist, fallback to using \"log\" and prefix the message with the intended\n * method.  Note that in the fallback, all logged items will be converted to\n * strings before output for compatibility.\n *\n * @param {string} method The console method to use when logging.\n * @param {string} prefix The string prefix to prepend to the logged items.\n * @param {{length: number}} args List of items to log.\n */\nspfDebug.log = function (method, prefix, args) {\n  if (!SPF_DEBUG || !window.console) {\n    return\n  }\n  args = Array.prototype.slice.call(args)\n  var current = spfBase.now()\n  var overall = spfDebug.formatDuration(spfDebug.start_, current)\n  if (spfDebug.split_) {\n    var split = spfDebug.formatDuration(spfDebug.split_, current)\n    args.unshift(overall + '/' + split + ':')\n  } else {\n    args.unshift(overall + ':')\n  }\n  if (spfDebug.direct_) {\n    args.unshift('[' + prefix + ']')\n    // Note that passing null for execution context throws an Error in Chrome.\n    window.console[method].apply(window.console, args)\n  } else {\n    args.unshift('[' + prefix + ' - ' + method + ']')\n    window.console.log(args.join(' '))\n  }\n}\n\n/**\n * Reset the timer used for logging duration.  Call to log split times\n * since last reset in addition to overall duration.\n */\nspfDebug.reset = function () {\n  spfDebug.split_ = spfBase.now()\n}\n\n/**\n * Formats two millisecond timestamps into a duration string.\n * See {@link spfBase.now} for timestamp generation.\n *\n * @param {number} start The starting millisecond timestamp.\n * @param {number} end The ending millisecond timestamp.\n * @return {string} The formatted duration string.\n */\nspfDebug.formatDuration = function (start, end) {\n  var dur = (end - start) / 1000\n  if (dur.toFixed) {\n    dur = dur.toFixed(3)\n  }\n  return dur + 's'\n}\n\n/**\n * Checks whether a logging level is enabled for output.\n *\n * @param {spfDebug.Level} level The logging level.\n * @return {boolean} True if the logging level is enabled.\n */\nspfDebug.isLevelEnabled = function (level) {\n  return (spfDebug.levels_[level] >= spfDebug.levels_[spfDebug.OUTPUT])\n}\n\n/**\n * The timestamp of when debugging was initialized, for overall duration.\n * @private {number}\n */\nspfDebug.start_ = spfBase.now()\n\n/**\n * The timestamp of when debugging was reset, for split durations.\n * @private {number}\n */\nspfDebug.split_ = 0\n\n/**\n * Whether to support direct console logging.  This mode allows logging of\n * objects directly to the console without casting to a string.\n * Note: IE does not support direct logging, but also does not support the\n * debug method, so this property will be false in IE.\n * @private {boolean}\n */\nspfDebug.direct_ = !!(window.console && window.console.debug)\n\n/**\n * A map of logging output levels to corresponding numeric values.\n * @private {Object.<string, number>}\n * @const\n */\nspfDebug.levels_ = {\n  'debug': 1,\n  'info': 2,\n  'warn': 3,\n  'error': 4\n}\n\n/**\n * The level of logging output, corresponding to browser console logging\n * functions: \"debug\", \"info\", \"warn\", \"error\".\n * @enum {string}\n */\nspfDebug.Level = {\n  DEBUG: 'debug',\n  INFO: 'info',\n  WARN: 'warn',\n  ERROR: 'error'\n}\n\n/**\n * @define {string} OUTPUT is provided to control the level of output\n * from debugging code.  Valid values correspond to browser console logging\n * functions: \"debug\", \"info\", \"warn\", and \"error\", and can be set by the\n * compiler when \"--define spfDebug.OUTPUT='warn'\" or similar is specified.\n */\nspfDebug.OUTPUT = 'debug'\n\nexport default spfDebug\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/debug/debug.js","import {rorParams as RPs} from '../common/csrf'\n/**\n * [handleMethod description]\n * @param  {HTMLElement} link [description]\n * @return {[type]}      [description]\n * Handles \"data-method\" on links such as:\n * <a href=\"/users/5\" data-method=\"delete\" rel=\"nofollow\" data-confirm=\"Are you sure?\">Delete</a>\n */\nexport function handleMethod (link, linkMethod, obj = {}) {\n  var href = link.getAttribute('href'),\n    method = linkMethod,\n    target = link.getAttribute('target'),\n    csrfToken = RPs.csrfToken(),\n    csrfParam = RPs.csrfParam()\n  var paramsObj = {\n    href: href,\n    method: method,\n    target: target,\n    csrfToken: csrfToken,\n    csrfParam: csrfParam\n  }\n  var formEle = createForm(paramsObj, obj)\n  // appendFormToDom(formEle);\n  return formEle\n  // submitForm(formEle);\n}\nfunction createForm (params, obj) {\n  var f = document.createElement('form')\n  f.style.display = 'none'\n  f.setAttribute('method', 'post')\n  f.setAttribute('action', params.href)\n  if (params.target) {\n    f.setAttribute('target', params.target)\n  };\n\n  var i = document.createElement('input')\n  i.setAttribute('type', 'hidden')\n  i.setAttribute('name', '_method')\n  i.setAttribute('value', params.method)\n\n  var s\n  if (params.csrfParam !== undefined &&\n      params.csrfToken !== undefined &&\n      !RPs.isCrossDomain(params.href)) {\n    s = document.createElement('input')\n    s.setAttribute('type', 'hidden')\n    s.setAttribute('name', params.csrfParam)\n    s.setAttribute('value', params.csrfToken)\n  }\n  f.appendChild(i)\n\n  // for (let key in obj.data) {\n  //   if (obj.data.hasOwnProperty(key)) {\n  //     let t = document.createElement('input');\n  //     t.setAttribute('type','hidden');\n  //     t.setAttribute('name','' + obj.ns + '[' + key + ']');\n  //     t.setAttribute('value',obj.data[key]);\n  //     f.appendChild(t);\n  //   }\n  // }\n\n  if (s) {\n    f.appendChild(s)\n  };\n  return f\n}\n\nfunction appendFormToDom (form) {\n  document.body.appendChild(form)\n}\nfunction submitForm (form) {\n  form.submit()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/common/handleMethod2.js","/**\n * @fileoverview Basic DOM manipulation functions.\n *\n */\n\n// goog.provide('spfDom');\n\nimport {spfBase} from '../base'\nlet spfDom = {}\n\n/**\n * Gets nodes matching a selector.\n *\n * Note: IE8 does not support CSS3 selectors, and unsupported browsers will\n * return an empty Array.\n *\n * @param {string} selector Selector to match.\n * @param {(Document|Element)=} opt_root Optional document or element to query.\n * @return {Array.<Node>|NodeList} nodes Matching nodes.\n */\nspfDom.query = function (selector, opt_root) {\n  var root = opt_root || document\n  if (root.querySelectorAll) {\n    return root.querySelectorAll(selector)\n  }\n  return []\n}\n\n/**\n * Inserts a new node before an existing reference node (i.e. as the previous\n * sibling). If the reference node has no parent, then does nothing.\n *\n * @param {Node} newNode Node to insert.\n * @param {Node} refNode Reference node to insert before.\n */\nspfDom.insertSiblingBefore = function (newNode, refNode) {\n  refNode.parentNode.insertBefore(newNode, refNode)\n}\n\n/**\n * Inserts a new node after an existing reference node (i.e. as the next\n * sibling). If the reference node has no parent, then does nothing.\n *\n * @param {Node} newNode Node to insert.\n * @param {Node} refNode Reference node to insert after.\n */\nspfDom.insertSiblingAfter = function (newNode, refNode) {\n  refNode.parentNode.insertBefore(newNode, refNode.nextSibling)\n}\n\n/**\n * Unpacks an element. That is, removes it and replace it with its children.\n * Does nothing if the element is not in the document.\n *\n * @param {Element} element The element to flatten.\n * @return {Element|undefined} The original element, detached from the document\n *     tree, sans children; or undefined, if the element was not in the document\n *     to begin with.\n */\nspfDom.unpackElement = function (element) {\n  var child, parent = element.parentNode\n  if (parent && parent.nodeType != 11) {  // 11 = document fragment\n    // Use IE DOM function (supported by Opera too) if available\n    if (element.removeNode) {\n      return /** @type {Element} */ (element.removeNode(false))\n    } else {\n      // Move all children of the original node up one level.\n      while ((child = element.firstChild)) {\n        parent.insertBefore(child, element)\n      }\n      // Detach the original element.\n      return /** @type {Element} */ (parent.removeChild(element))\n    }\n  }\n}\n\n/**\n * Packs an element. That is, adds a new child and places its previous\n * children inside of the new one.\n *\n * @param {Element} element The element to pack.\n * @param {Element} container The new container of the existing children.\n */\nspfDom.packElement = function (element, container) {\n  if (container) {\n    var child\n    // Move all children of the original node down one level.\n    while ((child = element.firstChild)) {\n      container.appendChild(child)\n    }\n    // Attach the new parent.\n    element.appendChild(container)\n  }\n}\n\n/**\n * Walks up the DOM hierarchy returning the first ancestor that passes the\n * matcher function.\n *\n * @param {Node|EventTarget} element The DOM node to start with.\n * @param {function(Node) : boolean} matcher A function that returns true if\n *     the passed node matches the desired criteria.\n * @param {Node=} opt_parent The DOM node to end with.  If provided, it will\n *     be the highest point in the hierarchy walked.  If not provided, the\n *     full hierarchy will be walked.\n * @return {Node} DOM node that matched the matcher, or null if there was\n *     no match.\n */\nspfDom.getAncestor = function (element, matcher, opt_parent) {\n  while (element) {\n    if (matcher(element)) {\n      // Found a match, return it.\n      return element\n    }\n    if (opt_parent && element == opt_parent) {\n      // Reached the parent, return null.\n      return null\n    }\n    // Walk up the hierarchy.\n    element = element.parentNode\n  }\n  // Reached the root, return null.\n  return null\n}\n\n/**\n * Set attributes on an element from a map of attribute name/value pairs.\n *\n * NOTE: IE7 and earlier will need HTML attribute names specified as JS\n * properties instead (e.g. set \"bgColor\" as well as \"bgcolor\") and\n * does not support adding inline event handlers (e.g. setting \"onclick\"\n * is unsupported).  Event handlers should be added directly instead.\n *\n * @param {Element} element The element to update.\n * @param {Object.<string, string>} attributes The map of name/value pairs.\n */\nspfDom.setAttributes = function (element, attributes) {\n  for (var name in attributes) {\n    var value = attributes[name]\n    if (name == 'class') {\n      element.className = value\n    } else if (name == 'style') {\n      element.style.cssText = value\n    } else {\n      element.setAttribute(name, value)\n      // Updating the \"value\" attribute of an input via `el.setAttribute` does\n      // not change what is displayed, and assigning directly via `el.value` is\n      // needed.  But, _only_ updating via `el.value` means that calls to\n      // `el.getAttribute` will return the original value.  So, do both.\n      if (name == 'value') {\n        element[name] = value\n      }\n    }\n  }\n}\n\n/**\n * Installs an empty iframe in the page.\n *\n * @param {string=} opt_id Id of the iframe element.\n * @param {Document=} opt_document Content document element.\n * @param {Function=} opt_callback Callback function to execute onload.\n * @return {!HTMLIFrameElement}\n */\nspfDom.createIframe = function (opt_id, opt_document, opt_callback) {\n  var id = opt_id || ''\n  var doc = opt_document || document\n  var iframeEl = doc.createElement('iframe')\n  iframeEl.id = id\n  iframeEl.src = 'javascript:\"\"'\n  iframeEl.style.display = 'none'\n  if (opt_callback) {\n    iframeEl.onload = spfBase.bind(opt_callback, null, iframeEl)\n  }\n  doc.body.appendChild(iframeEl)\n  return /** @type {!HTMLIFrameElement} */ (iframeEl)\n}\n\nexport default spfDom\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/dom/dom.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions for detecting and creating history entries\n * using the HTML5 history modification API.  It enables browser history\n * (e.g. back/forward) and URL updates without leaving the current page,\n * as long as the url is within the same domain.\n * See {@link http://www.w3.org/TR/html5/history.html}.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// goog.provide('spfHistory');\n\nimport {spfBase} from '../base'\nimport spfConfig from '../config'\nimport spfDebug from '../debug/debug'\nimport spfDom from '../dom/dom'\nimport spfState from '../state'\n\nlet spfHistory = {}\n\n/**\n * Initialize pushstate-based HTML5 History management.\n *\n * @param {function(string, Object=)} callback The function to handle\n *     a history event. The first parameter will be the URL\n *     the user is browsing to.  The second parameter will be an optional\n *     state object associated with that URL.\n * @param {function(string, Error)} errorCallback The function to handle\n *     errors. The first parameter will be the URL with the error.  The\n *     second parameter will be the error object.\n */\nspfHistory.init = function (callback, errorCallback) {\n  if (!spfState.get(spfState.Key.HISTORY_INIT) && window.addEventListener) {\n    var url = spfHistory.getCurrentUrl_()\n    window.addEventListener('popstate', spfHistory.pop_, false)\n    // Whether history is initialized.\n    spfState.set(spfState.Key.HISTORY_INIT, true)\n    // A callback to handle history events.\n    spfState.set(spfState.Key.HISTORY_CALLBACK, callback)\n    // A callback to handle errors.\n    spfState.set(spfState.Key.HISTORY_ERROR_CALLBACK, errorCallback)\n    // The event listener.\n    spfState.set(spfState.Key.HISTORY_LISTENER, spfHistory.pop_)\n    // The URL of the current history entry, used to detect returning to the\n    // the first state.\n    spfState.set(spfState.Key.HISTORY_URL, url)\n    // The timestamp of the current history entry, used to distinguish\n    // between backward and forward state changes.\n    spfState.set(spfState.Key.HISTORY_TIMESTAMP, spfBase.now())\n    // Set the initial referer to properly send referer on back button.\n    var historyState = { 'spf-referer': document.referrer }\n    try {\n      spfHistory.replace(url, historyState)\n    } catch (err) {\n      // If history.replaceState was null an error will be thrown.\n      if (errorCallback) {\n        errorCallback(url, err)\n      }\n    }\n  }\n}\n\n/**\n * Dispose pushstate-based HTML5 History management.\n */\nspfHistory.dispose = function () {\n  if (spfState.get(spfState.Key.HISTORY_INIT)) {\n    if (window.removeEventListener) {\n      window.removeEventListener('popstate', /** @type {function(Event)} */ (\n          spfState.get(spfState.Key.HISTORY_LISTENER)), false)\n    }\n    spfState.set(spfState.Key.HISTORY_INIT, false)\n    spfState.set(spfState.Key.HISTORY_CALLBACK, null)\n    spfState.set(spfState.Key.HISTORY_ERROR_CALLBACK, null)\n    spfState.set(spfState.Key.HISTORY_LISTENER, null)\n    spfState.set(spfState.Key.HISTORY_URL, null)\n    spfState.set(spfState.Key.HISTORY_TIMESTAMP, 0)\n  }\n}\n\n/**\n * Add a history entry.\n *\n * @param {?string=} opt_url The URL associated with this entry to display in\n *     the browser.  This can be either a relative or an absolute URL, and if\n *     omitted, the current browser URL will be used.\n * @param {Object=} opt_state The state object associated with this history\n *     entry.  When the user returns to this entry, the \"state\" property of the\n *     event will contain a copy of this object.\n * @param {boolean=} opt_doCallback Whether to do the history event callback.\n * @throws {Error} If the state object is too large. For example, Firefox will\n *     pass the object to JSON.stringify and impose a 640k character limit.\n * @throws {Error} If the URL is not in the same domain, a SECURITY_ERR\n *     (code == 18) is thrown.\n * @throws {Error} If window.history.pushState is not a function.\n */\nspfHistory.add = function (opt_url, opt_state, opt_doCallback) {\n  spfDebug.info('history.add ', opt_url)\n  spfHistory.push_(false, opt_url, opt_state, opt_doCallback)\n}\n\n/**\n * Replace the current history entry, merging any newly provided state values\n * with existing ones.\n *\n * @param {?string=} opt_url The URL associated with this entry to display in\n *     the browser.  This can be either a relative or an absolute URL, and if\n *     omitted, the current browser URL will be used.\n * @param {Object=} opt_state The state object associated with this history\n *     entry.  When the user returns to this entry, the \"state\" property of the\n *     event will contain a copy of this object.\n * @param {boolean=} opt_doCallback Whether to do the history event callback.\n * @throws {Error} If the state object is too large. For example, Firefox will\n *     pass the object to JSON.stringify and impose a 640k character limit.\n * @throws {Error} If the URL is not in the same domain, a SECURITY_ERR\n *     (code == 18) is thrown.\n * @throws {Error} If window.history.replaceState is not a function.\n */\nspfHistory.replace = function (opt_url, opt_state, opt_doCallback) {\n  var state = null\n  // Set the existing state values.\n  var currentState = spfHistory.getCurrentState_()\n  if (currentState) {\n    state = {}\n    for (var key in currentState) {\n      state[key] = currentState[key]\n    }\n  }\n  // Update the state values with new ones.\n  if (opt_state) {\n    state = state || {}\n    for (var key in opt_state) {\n      state[key] = opt_state[key]\n    }\n  }\n  spfDebug.info('history.replace ', opt_url)\n  spfHistory.push_(true, opt_url, state, opt_doCallback)\n}\n\n/**\n * Remove the latest history state from the stack.\n * NOTE: If this is called without a state having been pushed, it will result in\n * a back action to the last page. Use with care.\n */\nspfHistory.removeCurrentEntry = function () {\n  spfState.set(spfState.Key.HISTORY_IGNORE_POP, true)\n  window.history.back()\n}\n\n/**\n * See {@link #add} or {@link #replace}.\n *\n * @param {boolean} replace Whether to replace the previous entry.\n * @param {?string=} opt_url The URL associated with this entry.\n * @param {Object=} opt_state The state object associated with this entry.\n * @param {boolean=} opt_doCallback Whether to do the history event callback.\n * @private\n */\nspfHistory.push_ = function (replace, opt_url, opt_state, opt_doCallback) {\n  if (!opt_url && !opt_state) {\n    return\n  }\n  var url = opt_url || spfHistory.getCurrentUrl_()\n  var state = opt_state || {}\n  var timestamp = spfBase.now()\n  spfState.set(spfState.Key.HISTORY_TIMESTAMP, timestamp)\n  state['spf-timestamp'] = timestamp\n  if (replace) {\n    spfHistory.doReplaceState_(state, '', url)\n    spfDebug.debug('    replaceState:  ', 'url=', url, 'state=', state)\n  } else {\n    spfHistory.doPushState_(state, '', url)\n    spfDebug.debug('    pushState:  ', 'url=', url, 'state=', state)\n  }\n  spfState.set(spfState.Key.HISTORY_URL, url)\n  if (opt_doCallback) {\n    var callback = /** @type {function(string, Object=)} */ (\n        spfState.get(spfState.Key.HISTORY_CALLBACK))\n    if (callback) {\n      callback(url, state)\n    }\n  }\n}\n\n/**\n * Handles popstate events when the active history entry changes.\n *\n * @param {Event} evt The popstate event.\n * @private\n */\nspfHistory.pop_ = function (evt) {\n  var url = spfHistory.getCurrentUrl_()\n  spfDebug.info('history.pop ', 'url=', url, 'evt=', evt)\n  // Skip a pop event and reset flag if the ignore state is set.\n  if (spfState.get(spfState.Key.HISTORY_IGNORE_POP)) {\n    spfState.set(spfState.Key.HISTORY_IGNORE_POP, false)\n    return\n  }\n  // Avoid the initial event on first load, and ignore events for history\n  // entries that are not handled by SPF (e.g. when navigating within a page\n  // using links with hash-only URLs, there are no associated states).\n  if (!evt.state) {\n    return\n  }\n  var state = evt.state\n  var timestamp = state['spf-timestamp']\n  // If the URL is the same and a state is present, the browser has left\n  // and returned to first load via back/forward.  In this case, reset\n  // the state to the original.\n  if (url == spfState.get(spfState.Key.HISTORY_URL)) {\n    spfState.set(spfState.Key.HISTORY_TIMESTAMP, timestamp)\n    spfHistory.doReplaceState_(state, '', url)\n    spfDebug.debug('    replaceState:  ', 'url=', url, 'state=', state)\n  } else {\n    var current = parseInt(spfState.get(spfState.Key.HISTORY_TIMESTAMP), 10)\n    state['spf-back'] = (timestamp < current)\n    state['spf-current'] = spfState.get(spfState.Key.HISTORY_URL)\n    spfState.set(spfState.Key.HISTORY_TIMESTAMP, timestamp)\n    spfState.set(spfState.Key.HISTORY_URL, url)\n    var callback = /** @type {function(string, Object=)} */ (\n        spfState.get(spfState.Key.HISTORY_CALLBACK))\n    if (callback) {\n      callback(url, state)\n    }\n  }\n}\n\n/**\n * @return {string} The location href.\n * @private\n */\nspfHistory.getCurrentUrl_ = function () {\n  return window.location.href\n}\n\n/**\n * @return {Object} The current history state object.\n * @private\n */\nspfHistory.getCurrentState_ = function () {\n  return /** @type {Object} */ (window.history.state)\n}\n\n/**\n * @param {*} data New state.\n * @param {string} title The title for a new session history entry.\n * @param {string=} opt_url The URL for a new session history entry.\n * @private\n */\nspfHistory.doPushState_ = function (data, title, opt_url) {\n  // It is common for third party code to interfere with pushState.\n  // This check makes sure that pushState is a function when called to\n  // avoid js errors and a state where the back arrow stops working.\n  var iframe = spfHistory.getIframe()\n  var pushState = iframe.contentWindow.history.pushState\n  if (typeof pushState === 'function') {\n    pushState.call(window.history, data, title, opt_url)\n  } else {\n    throw new Error('history.pushState is not a function.')\n  }\n}\n\n/**\n * @param {*} data New state.\n * @param {string} title The title for a session history entry.\n * @param {string=} opt_url The URL for a new session history entry.\n * @private\n */\nspfHistory.doReplaceState_ = function (data, title, opt_url) {\n  var iframe = spfHistory.getIframe()\n  var replaceState = iframe.contentWindow.history.replaceState\n  if (typeof replaceState === 'function') {\n    replaceState.call(window.history, data, title, opt_url)\n  } else {\n    throw new Error('history.replaceState is not a function')\n  }\n}\n\n/**\n * @return {!HTMLIFrameElement} The history iframe.\n */\nspfHistory.getIframe = function () {\n  var frame = document.getElementById('history-iframe')\n  if (!frame) {\n    frame = spfDom.createIframe('history-iframe')\n  }\n  return /** @type {!HTMLIFrameElement} */ (frame)\n}\n\nexport default spfHistory\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/history/history.js","// Copyright 2013 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview URL manipulation functions.\n *\n * @author nicksay@google.com (Alex Nicksay)\n * @suppress {missingProperties}\n */\n\nimport spfArray from '../array/array'\nimport spfConfig from '../config'\nimport spfString from '../string/string'\n\nlet spfUrl = {}\n// goog.provide('spfUrl');\n\n// goog.require('spfArray');\n// goog.require('spfConfig');\n// goog.require('spfString');\n\n/**\n * See {@link https://developer.mozilla.org/en-US/docs/Web/API/URLUtils}.\n *\n * @typedef {{\n *   href: string,\n *   protocol: string,\n *   host: string,\n *   hostname: string,\n *   port: string,\n *   pathname: string,\n *   search: string,\n *   hash: string,\n *   username: string,\n *   password: string,\n *   origin: string\n * }}\n */\nspfUrl.URLUtils\n\n/**\n * Returns a URLUtils compatible object for a given url. For the interface, see\n * {@link https://developer.mozilla.org/en-US/docs/Web/API/URLUtils}.\n *\n * @param {string} url A relative or absolute URL.\n * @return {spfUrl.URLUtils} The URLUtils object.\n */\nspfUrl.utils = function (url) {\n  var aEl = document.createElement('a')\n  // If the URL is relative, IE will not populate host/port parameters.\n  aEl.href = url\n  // Assigning the absolute URL back to the href value solves this IE bug.\n  aEl.href = aEl.href\n  var utils = {\n    href: aEl.href,\n    protocol: aEl.protocol,\n    host: aEl.host,\n    hostname: aEl.hostname,\n    port: aEl.port,\n    pathname: aEl.pathname,\n    search: aEl.search,\n    hash: aEl.hash,\n    username: aEl.username,\n    password: aEl.password\n  }\n  // The origin is the combination of scheme, domain, and port.\n  utils.origin = utils.protocol + '//' + utils.host\n  // IE does not include the leading slash on a path. So if the path is\n  // available, but no leading slash is present, prepend one.\n  if (!utils.pathname || utils.pathname[0] != '/') {\n    utils.pathname = '/' + utils.pathname\n  }\n  return utils\n}\n\n/**\n * Converts a relative URL to absolute based on the current document domain.\n *\n * @param {string} relative A relative URL.\n * @param {boolean=} opt_keepHash  Whether to keep any hash in the URL,\n *     if one exists.  Defaults to false.\n * @return {string} An absolute URL (with hash removed, if possible).\n */\nspfUrl.absolute = function (relative, opt_keepHash) {\n  var utils = spfUrl.utils(relative)\n  return opt_keepHash ? utils.href : spfUrl.unhash(utils.href)\n}\n\n/**\n * Returns the path portion of a given URL.\n *\n * @param {string} url A relative or absolute URL.\n * @return {string} The path portion of the URL.\n */\nspfUrl.path = function (url) {\n  var utils = spfUrl.utils(url)\n  return utils.pathname\n}\n\n/**\n * Returns the origin of a given URL (scheme + domain + port).\n *\n * @param {string} url A relative or absolute URL.\n * @return {string} The origin of the URL.\n */\nspfUrl.origin = function (url) {\n  var utils = spfUrl.utils(url)\n  return utils.origin\n}\n\n/**\n * Adds the SPF identifier to a URL, to be used in requests.  If the\n * identifier contains `__type__` then that value will be replaced\n * with the value of `opt_type`.\n *\n * @param {string} url A URL.\n * @param {string=} opt_type An optional type for identification.\n * @return {string} An identified URL.\n */\nspfUrl.identify = function (url, opt_type) {\n  var ident = /** @type {string} */ (spfConfig.get('url-identifier')) || ''\n  if (ident) {\n    var type = opt_type || ''\n    ident = ident.replace('__type__', type)\n\n    // Split the URL.\n    var hashParts = spfString.partition(url, '#')\n    var queryParts = spfString.partition(hashParts[0], '?')\n    var path = queryParts[0]\n    var querySep = queryParts[1]\n    var queryVal = queryParts[2]\n    var hashSep = hashParts[1]\n    var hashVal = hashParts[2]\n\n    // Inject the identifier.\n    if (spfString.startsWith(ident, '?')) {\n      // If using a query-based identifier, append the identifier to the\n      // existing query string.\n      // For \"?ident\":\n      //     /path -> path?ident\n      //     /path?query -> path?query&ident\n      if (querySep) {\n        ident = ident.replace('?', '&')\n      }\n      queryVal += ident\n    } else if (spfString.startsWith(ident, '.')) {\n      // If using an extension-based identifier, replace the existing\n      // extension with the identifier.  If no extension exists, the\n      // identifier is appended.  However, if the URL specifies a directory\n      // (i.e. it ends with \"/\"), then append \"index\" to the URL first.\n      // For \".ident\":\n      //     /path -> /path.ident\n      //     /path.ext -> /path.ident\n      //     /path/ -> /path/index.ident\n      if (spfString.endsWith(path, '/')) {\n        ident = 'index' + ident\n      } else {\n        var ext = path.lastIndexOf('.')\n        if (ext > -1) {\n          path = path.substring(0, ext)\n        }\n      }\n      path += ident\n    } else {\n      // Finally, if using any other identifier, just append the identifier,\n      // preventing duplicate \"/\" in the URL.\n      // For \"/ident\":\n      //     /path -> /path/ident\n      //     /path/ -> /path/ident\n      // For \"_ident\":\n      //     /path -> /path_ident\n      //     /path/ -> /path/_ident\n      if (spfString.endsWith(path, '/') && spfString.startsWith(ident, '/')) {\n        ident = ident.substring(1)\n      }\n      path += ident\n    }\n\n    // Re-assemble the URL.\n    url = path + querySep + queryVal + hashSep + hashVal\n  }\n  return url\n}\n\n/**\n * Appends the parameters to the url. Any existing parameters or hashes are\n * maintained.\n *\n * @param {string} url A URL.\n * @param {!Object.<string, string>} parameters An object with new parameters\n *    as key/value pairs.\n * @return {string} A new URL with the parameters included.\n */\nspfUrl.appendParameters = function (url, parameters) {\n  var result = spfString.partition(url, '#')\n  url = result[0]\n  var delim = spfString.contains(url, '?') ? '&' : '?'\n  for (var key in parameters) {\n    url += delim + key\n    if (parameters[key]) {\n      url += '=' + parameters[key]\n    }\n    delim = '&'\n  }\n  // Reattach the hash.\n  return url + result[1] + result[2]\n}\n\n/**\n * Removes a list of parameters from a given url.\n *\n * @param {string} url A URL.\n * @param {!Array.<string>} parameters A list of parameter keys to remove.\n * @return {string} A new URL with the parameters removed.\n */\nspfUrl.removeParameters = function (url, parameters) {\n  var result = spfString.partition(url, '#')\n  url = result[0]\n  spfArray.each(parameters, function (param) {\n    // Strip all parameters matching the param key.\n    var regex = new RegExp('([?&])' + param + '(?:=[^&]*)?(?:(?=[&])|$)', 'g')\n    url = url.replace(regex, function (_, delim) {\n      return delim == '?' ? delim : ''\n    })\n  })\n  // Remove an unecessary trailing question marks.\n  if (spfString.endsWith(url, '?')) {\n    url = url.slice(0, -1)\n  }\n  // Reattach the hash.\n  return url + result[1] + result[2]\n}\n\n/**\n * Appends a configurable set of parameters that should persist across URLs.\n *\n * @param {string} url A URL.\n * @return {string} A new URL with the persistent parameters included.\n */\nspfUrl.appendPersistentParameters = function (url) {\n  // Get the param config of the form \"abc=def&foo=bar\"\n  var parameterConfig = spfConfig.get('advanced-persistent-parameters') || ''\n  var result = spfString.partition(url, '#')\n  url = result[0]\n  var delim = spfString.contains(url, '?') ? '&' : '?'\n  // Append the persistent parameters to the URL.\n  url += parameterConfig ? delim + parameterConfig : ''\n  // Reattach the hash.\n  return url + result[1] + result[2]\n}\n\n/**\n * Converts an absolute URL to protocol-relative (e.g. no http: or https:).\n * Has no effect on relative URLs.\n *\n * @param {string} url An absolute URL.\n * @return {string} An protocol-relative URL, if possible.\n */\nspfUrl.unprotocol = function (url) {\n  return url.replace(/^[a-zA-Z]+:\\/\\//, '//')\n}\n\n/**\n * Removes a hash from a URL.\n *\n * @param {string} url A URL.\n * @return {string}  A URL without a hash, if possible.\n */\nspfUrl.unhash = function (url) {\n  var res = spfString.partition(url, '#')\n  return res[0]\n}\n\nexport default spfUrl\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/url/url.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Data caching functions.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// goog.provide('spfCache');\n\nimport {spfBase} from '../base'\nimport spfConfig from '../config'\nimport spfState from '../state'\n\nlet spfCache = {}\n\n/**\n * Gets data from the cache.  If the data age exceeds the data lifetime, no\n * data is returned.\n *\n * If data is successfully returned from cache, the data's moved to the top of\n * the cache, making it less likely to be garbage collected.\n *\n * @param {string} key Key for the data object.\n * @return {*} The data, if it exists.\n */\nspfCache.get = function (key) {\n  var storage = spfCache.storage_()\n  if (!(key in storage)) {\n    return\n  }\n  var unit = storage[key]\n  // If the data is valid, return it.\n  if (spfCache.valid_(unit)) {\n    spfCache.updateCount_(unit)\n    return unit['data']\n  }\n  // Otherwise, the data should be removed from the cache.\n  spfCache.remove(key)\n}\n\n/**\n * Sets data in the cache if the both the specified lifetime and the\n * globally configured maximum allow it.\n *\n * @param {string} key Key for the data object.\n * @param {*} data The data.\n * @param {?number=} opt_lifetime Lifetime for the data object.\n *     Defaults to forever if not specified or if null is specified. If a\n *     lifetime of less than 1 is specified, the data is not set in the cache.\n */\nspfCache.set = function (key, data, opt_lifetime) {\n  var lifetime = parseInt(opt_lifetime, 10)\n  var max = parseInt(spfConfig.get('cache-max'), 10)\n  if (lifetime <= 0 || max <= 0) {\n    return\n  }\n  var storage = spfCache.storage_()\n  storage[key] = spfCache.create_(key, data, lifetime)\n  // When setting data in the cache, trigger an asynchronous garbage collection\n  // run to prevent unnecessary memory growth.\n  setTimeout(spfCache.collect, 1000)\n}\n\n/**\n * Removes data from the cache.\n *\n * @param {string} key Key for the data object.\n */\nspfCache.remove = function (key) {\n  var storage = spfCache.storage_()\n  if (key in storage) {\n    delete storage[key]\n  }\n}\n\n/**\n * Removes all data from the cache.\n */\nspfCache.clear = function () {\n  spfCache.storage_({})\n}\n\n/**\n * Removes expired data from the cache (aka garbage collection). Invalid data\n * and data with an age exceeding the data lifetime will be removed.\n */\nspfCache.collect = function () {\n  var storage = spfCache.storage_()\n  for (var key in storage) {\n    var unit = storage[key]\n    // If invalid data exists, remove.\n    if (!spfCache.valid_(unit)) {\n      delete storage[key]\n    }\n  }\n  // Trim the oldest entries if the cache is still above the max size.\n  spfCache.trim_()\n}\n\n// TODO(nicksay): Make count non-optional with next release.\n/**\n * Type definition for a SPF cache unit object.\n * - data: The data to cache.\n * - life: Lifetime of the data (milliseconds).\n * - time: Timestamp when the data was stored (milliseconds).\n * - count: The counter for the cached data.\n *\n * @typedef {{\n *   data: *,\n *   life: number,\n *   time: number,\n *   count: number\n * }}\n */\nspfCache.Unit\n\n/**\n * @param {spfCache.Unit} unit The cache unit.\n * @return {boolean}\n * @private\n */\nspfCache.valid_ = function (unit) {\n  // Ensure valid data is availabe.\n  if (!(unit && 'data' in unit)) {\n    return false\n  }\n  // A lifetime of NaN is considered forever.  If the age is less than the\n  // lifetime, then the unit is valid.  Note that if the timestamp is\n  // missing, the unit will not be valid.\n  var lifetime = unit['life']\n  lifetime = isNaN(lifetime) ? Infinity : lifetime\n  var timestamp = unit['time']\n  var age = spfBase.now() - timestamp\n  return age < lifetime\n}\n\n/**\n * Trim down the cache units to fit under the cache maximum, based on the\n * lowest count value (oldest entry).\n *\n * @private\n */\nspfCache.trim_ = function () {\n  var storage = spfCache.storage_()\n  var max = parseInt(spfConfig.get('cache-max'), 10)\n  max = isNaN(max) ? Infinity : max\n  var extra = Object.keys(storage).length - max\n  // If the current cache is smaller than the max, no trimming is needed.\n  if (extra <= 0) {\n    return\n  }\n\n  // Remove the smallest element 'extra' times to trim the cache down to size.\n  for (var i = 0; i < extra; i++) {\n    var min = {count: Infinity}\n    for (var key in storage) {\n      if (storage[key].count < min.count) {\n        min.key = key\n        min.count = storage[key].count\n      }\n    }\n    delete storage[min.key]\n  }\n}\n\n/**\n * @param {string} key Key for the data object.\n * @param {*} data The data.\n * @param {number} lifetime Lifetime for the data object.\n * @return {!spfCache.Unit}\n * @private\n */\nspfCache.create_ = function (key, data, lifetime) {\n  var unit = {'data': data, 'life': lifetime, 'time': spfBase.now(), 'count': 0}\n  spfCache.updateCount_(unit)\n  return unit\n}\n\n/**\n * Update the count of the given unit and the global cache counter to the\n * latest.\n * @param {spfCache.Unit} unit The cache unit.\n * @private\n */\nspfCache.updateCount_ = function (unit) {\n  var count = parseInt(spfState.get(spfState.Key.CACHE_COUNTER), 10) || 0\n  count++\n  spfState.set(spfState.Key.CACHE_COUNTER, count)\n\n  unit.count = count\n}\n\n/**\n * @param {!Object.<string, spfCache.Unit>=} opt_storage Optional storage\n *     object to overwrite the current value.\n * @return {!Object.<string, spfCache.Unit>} Current storage object.\n * @private\n */\nspfCache.storage_ = function (opt_storage) {\n  if (opt_storage || !spfState.has(spfState.Key.CACHE_STORAGE)) {\n    return /** @type {!Object.<string, spfCache.Unit>} */ (\n        spfState.set(spfState.Key.CACHE_STORAGE, (opt_storage || {})))\n  }\n  return /** @type {!Object.<string, spfCache.Unit>} */ (\n      spfState.get(spfState.Key.CACHE_STORAGE))\n}\n\nexport default spfCache\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/cache/cache.js","/**\n * @fileoverview Element class manipulation functions.\n * See {@link http://www.w3.org/TR/html5/dom.html#classes}.\n *\n */\n\n// goog.provide('spfDomClasslist');\n\nimport spfArray from '../array/array'\nlet spfDomClasslist = {}\n\n/**\n * Returns an array of class names on a node.\n *\n * @param {Node|EventTarget} node DOM node to evaluate.\n * @return {{length: number}} Array-like object of class names on the node.\n */\nspfDomClasslist.get = function (node) {\n  if (node.classList) {\n    return node.classList\n  } else {\n    return node.className && node.className.match(/\\S+/g) || []\n  }\n}\n\n/**\n * Returns true if a node has a class.\n *\n * @param {Node|EventTarget} node DOM node to test.\n * @param {string} cls Class name to test for.\n * @return {boolean} Whether node has the class.\n */\nspfDomClasslist.contains = function (node, cls) {\n  if (!cls) {\n    return false\n  } else if (node.classList) {\n    return node.classList.contains(cls)\n  } else {\n    var classes = spfDomClasslist.get(node)\n    return spfArray.some(classes, function (item) {\n      return item == cls\n    })\n  }\n}\n\n/**\n * Adds a class to a node. Does not add multiples.\n *\n * @param {Node|EventTarget} node DOM node to add class to.\n * @param {string} cls Class name to add.\n */\nspfDomClasslist.add = function (node, cls) {\n  if (cls) {\n    if (node.classList) {\n      node.classList.add(cls)\n    } else if (!spfDomClasslist.contains(node, cls)) {\n      node.className += ' ' + cls\n    }\n  }\n}\n\n/**\n * Removes a class from a node.\n *\n * @param {Node|EventTarget} node DOM node to remove class from.\n * @param {string} cls Class name to remove.\n */\nspfDomClasslist.remove = function (node, cls) {\n  if (cls) {\n    if (node.classList) {\n      node.classList.remove(cls)\n    } else {\n      var classes = spfDomClasslist.get(node)\n      var newClasses = spfArray.filter(classes, function (item) {\n        return item != cls\n      })\n      node.className = newClasses.join(' ')\n    }\n  }\n}\n\nexport default spfDomClasslist\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/dom/classlist.js","// Copyright 2014 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions for loading and unloading external resources such\n * as scripts and stylesheets.\n * See {@link spfBase.net.script} and {@link spfBase.net.style}.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// goog.provide('spfNetResource');\n// goog.provide('spfNetResource.name');\n// goog.provide('spfNetResource.status');\n// goog.provide('spfNetResource.url');\n\nimport {spfBase, SPF_BOOTLOADER, SPF_DEBUG} from '../base'\nimport spfArray from '../array/array'\nimport spfDebug from '../debug/debug'\nimport spfDom from '../dom/dom'\nimport spfDomClasslist from '../dom/classlist'\nimport spfPubsub from '../pubsub/pubsub'\nimport spfState from '../state'\nimport spfString from '../string/string'\nimport spfTasks from '../tasks/tasks'\nimport spfUrl from '../url/url'\n\nlet spfNetResource = {}\nspfNetResource.status = spfNetResource.status || {}\nspfNetResource.name = spfNetResource.name || {}\nspfNetResource.url = spfNetResource.url || {}\n\n/**\n * Loads a resource asynchronously and optionally defines a name to use for\n * dependency management and unloading.  See {@link #unload} to remove\n * previously loaded resources.\n *\n * NOTE: Automatic unloading of stylesheets depends on \"onload\" support and is\n * best effort.  Chrome 19, Safari 6, Firefox 9, Opera and IE 5.5 are supported.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url URL of the resource to load.\n * @param {string} name Name to identify the resource.\n * @param {Function=} opt_fn Optional callback function to execute when the\n *     resource is loaded.\n */\nspfNetResource.load = function (type, url, name, opt_fn) {\n  spfDebug.debug('resource.load', type, url, name)\n  var isJS = type == spfNetResource.Type.JS\n\n  url = spfNetResource.canonicalize(type, url)\n\n  // Calling load without a name or with an empty string for a name isn't\n  // officially supported, but if it happens, use a pseudonym to allow the\n  // the resource to load and fire the callback.\n  var pseudonym = name || '^' + url\n  var topic = spfNetResource.key(type, pseudonym)\n  var prevUrl\n\n  // If a name is provided with a different URL, then also unload the previous\n  // version after the resource is loaded.\n  //\n  // NOTE: When built for the bootloader, automatic unloading of scripts is not\n  // supported.  If someone is attempting to load a new version of a script\n  // before loading the main SPF code, then this should be an error.  Automatic\n  // unloading of scripts is primarily intended for navigation between versions.\n  if (name && !SPF_BOOTLOADER) {\n    // If loading a new resource for a name, handle unloading the previous one.\n    prevUrl = spfNetResource.url.get(type, name)\n    if (prevUrl && url != prevUrl) {\n      var evt = isJS ? spfBase.EventName.JS_BEFORE_UNLOAD\n                       : spfBase.EventName.CSS_BEFORE_UNLOAD\n      spfBase.dispatch(evt, {'name': name, 'url': prevUrl})\n      spfNetResource.unloadPrepare_(type, name, prevUrl)\n      // Wait until the new resource has finished loading before destroying\n      // the previous one to avoid flashes of unstyled content w/ CSS.\n      var unloadComplete = spfBase.bind(spfNetResource.unloadComplete_, null,\n                                    type, name, prevUrl)\n      spfPubsub.subscribe(topic, unloadComplete)\n    }\n  }\n\n  // Associate the name/pseudonym with the resource for tracking name changes.\n  // Associate the resource with the name/pseudonym for unloading + callbacks.\n  var prevName = spfNetResource.name.get(type, url)\n  if (prevName && pseudonym != prevName) {\n    // If changing names for this resource, remove the existing\n    // name-to-resource and resource-to-name mappings (which are re-set just\n    // below), and then transfer any callbacks.\n    spfNetResource.url.clear(type, prevName)\n    spfNetResource.name.clear(type, url)\n    var prevTopic = spfNetResource.key(type, prevName)\n    spfPubsub.rename(prevTopic, topic)\n  }\n  spfNetResource.name.set(type, url, pseudonym)\n  spfNetResource.url.set(type, pseudonym, url)\n\n  // Subscribe the callback to execute when the url is loaded.\n  spfDebug.debug('  subscribing callback', topic)\n  spfPubsub.subscribe(topic, opt_fn)\n  var check = spfBase.bind(spfNetResource.check, null, type)\n\n  // If a status exists, the resource is already loading or loaded.\n  // Otherwise, create the resource.\n  if (spfNetResource.status.get(type, url)) {\n    if (prevName && pseudonym != prevName) {\n      // If changing names for this resource and it's already loaded, find\n      // it and update the name attribute to keep the DOM in sync.\n      var el = spfNetResource.find(type, url)\n      if (el) {\n        el.setAttribute('name', name || '')\n      }\n    }\n    check()\n  } else {\n    // If prevUrl is defined and the type is CSS, the styleshet will be loaded\n    // in-place. This works because previous elements aren't destroyed until\n    // loading is complete.\n    var el = spfNetResource.create(type, url, check, undefined, undefined,\n        prevUrl)\n    if (el && name) {\n      el.setAttribute('name', name)\n    }\n  }\n}\n\n/**\n * Unloads resources identified by dependency name.  See {@link #load}.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} name The dependency name.\n */\nspfNetResource.unload = function (type, name) {\n  spfDebug.warn('resource.unload', type, name)\n  var url = spfNetResource.url.get(type, name)\n  spfNetResource.unloadPrepare_(type, name, url)\n  spfNetResource.unloadComplete_(type, name, url)\n}\n\n/**\n * See {@link #unload}.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} name The dependency name.\n * @param {string|undefined} url The URL.\n * @private\n */\nspfNetResource.unloadPrepare_ = function (type, name, url) {\n  spfDebug.debug('  > resource.unloadPrepare_', type, url)\n  // Clear the dependency name to URL mapping.\n  spfNetResource.url.clear(type, name)\n  // Clear the URL to dependency name mapping.\n  if (url) {\n    spfNetResource.name.clear(type, url)\n  }\n  var topic = spfNetResource.key(type, name)\n  spfDebug.debug('  clearing callbacks for', topic)\n  // Clear any pending callbacks for the dependency name.\n  spfPubsub.clear(topic)\n}\n\n/**\n * See {@link #unload}.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} name The dependency name.\n * @param {string|undefined} url The URL.\n * @private\n */\nspfNetResource.unloadComplete_ = function (type, name, url) {\n  var isJS = type == spfNetResource.Type.JS\n  if (url) {\n    spfDebug.debug('  > resource.unloadComplete_', type, url)\n    var evt = isJS ? spfBase.EventName.JS_UNLOAD\n                     : spfBase.EventName.CSS_UNLOAD\n    spfBase.dispatch(evt, {'name': name, 'url': url})\n    spfNetResource.destroy(type, url)\n  }\n}\n\n/**\n * Executes any pending callbacks possible by checking if any URLs for names\n * of a given type have loaded.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n */\nspfNetResource.check = function (type) {\n  spfDebug.debug('resource.check', type)\n  var prefix = spfNetResource.key(type, '')\n  for (var topic in spfPubsub.subscriptions) {\n    if (topic.indexOf(prefix) == 0) {\n      var names = topic.substring(prefix.length).split('|')\n      var loaded = spfBase.bind(spfNetResource.url.loaded, null, type)\n      var ready = spfArray.every(names, loaded)\n      spfDebug.debug(' ', topic, '->', names, '=', ready)\n      if (ready) {\n        spfDebug.debug('  publishing', topic)\n        // Because check evaluates the pubsub.subscriptions array to determine\n        // if urls for names are loaded, there is a potential subscribe/publish\n        // infinite loop:\n        //     require_ -> load (subscribe) -> check (publish) ->\n        //     load (subscribe) -> <loop forever> ...\n        // To avoid this, use flush instead of publish + clear to ensure that\n        // previously subscribed functions are removed before execution:\n        //     require_ -> load (subscribe) -> check (flush) -> <no loop>\n        spfPubsub.flush(topic)\n      }\n    }\n  }\n}\n\n/**\n * Adds a resource to the page by creating an element and appending it to\n * the document.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url URL of the resource.\n * @param {Function=} opt_callback Callback for when the resource has loaded.\n * @param {Document=} opt_document Optional document to use.\n * @param {string=} opt_statusGroup Optional group to use in status tracking.\n * @param {string=} opt_prevUrl Optional URL of the previous version of this\n *     resource. Used for stylesheets to load new versions in-place to prevent\n*      changing the order of the cascade.\n * @return {Element} The dynamically created element.\n */\nspfNetResource.create = function (type, url, opt_callback, opt_document,\n    opt_statusGroup, opt_prevUrl) {\n  spfDebug.debug('resource.create', type, url, 'loading')\n  // When built for the bootloader, always assume JS is being loaded.\n  var isJS = SPF_BOOTLOADER || type == spfNetResource.Type.JS\n  url = spfNetResource.canonicalize(type, url)\n  spfNetResource.status.set(spfNetResource.State.LOADING,\n                              type, url, opt_statusGroup)\n  var tag = isJS ? 'script' : 'link'\n  var doc = opt_document || document\n  var el = doc.createElement(tag)\n  var next = function () {\n    spfDebug.debug('resource.create', type, url, 'done')\n    // Only update status if the resource has not been removed in the interim.\n    if (spfNetResource.status.get(type, url, opt_statusGroup)) {\n      spfDebug.debug('resource.create', type, url, 'loaded')\n      spfNetResource.status.set(spfNetResource.State.LOADED,\n                                  type, url, opt_statusGroup)\n    }\n    if (isJS && el && el.parentNode && doc == document && !SPF_DEBUG) {\n      // Remove scripts afterwards to avoid unnecessary increased DOM size.\n      el.parentNode.removeChild(el)\n    }\n    // IE 10 has a bug where it will synchronously call load handlers for\n    // cached resources, force this to be async for consistency.\n    if (opt_callback) {\n      setTimeout(opt_callback, 0)\n    }\n    return null\n  }\n  if (!url) {\n    return next()\n  }\n  var label = spfNetResource.label(url)\n  el.className = spfNetResource.key(type, label)\n  // Chrome, Safari, Firefox, Opera and IE 9 support script onload.\n  // Chrome 19, Safari 6, Firefox 9, Opera and IE 5.5 support stylesheet onload.\n  // To support scripts IE 8 and below, use script onreadystatechange.\n  if ('onload' in el) {\n    el.onerror = el.onload = next\n  } else {\n    el.onreadystatechange = function () {\n      // For IE 8 and below, script readyState will be one of the following:\n      // * uninitialized\n      // * loading\n      // * loaded\n      // * interactive\n      // * complete\n      // Match either \"loaded\" or \"complete\" to provide the equivalent of\n      // script onload.  (Note that \"interactive\" can be skipped).\n      if (/^c|loade/.test(el.readyState)) {\n        next()\n      }\n    }\n  }\n  // For scripts, set the onload and onreadystatechange handlers before\n  // setting the src to avoid potential IE bug where handlers are not called.\n  // Prefer placing resources in the head instead of the body to avoid errors\n  // when called from the head in the first place.\n  var targetEl = doc.getElementsByTagName('head')[0] || doc.body\n  if (isJS) {\n    el.async = true\n    el.src = url\n    // Use insertBefore for JS to avoid IE execution errors.\n    targetEl.insertBefore(el, targetEl.firstChild)\n  } else {\n    el.rel = 'stylesheet'\n    el.href = url\n    // If this stylesheet already exists under a different URL,\n    // reload it in-place to prevent changing the order of the cascade.\n    // It is only reloaded it in-place if it already exists in the head,\n    // otherwise the new element is appended.\n    var prevEl = opt_prevUrl\n        ? spfNetResource.find(type, opt_prevUrl, targetEl) : null\n    if (prevEl) {\n      targetEl.insertBefore(el, prevEl)\n    } else {\n      targetEl.appendChild(el)\n    }\n  }\n  return el\n}\n\n/**\n * Removes a resource by removing a previously created element that was\n * appended to the document.  See {@link #create}.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url URL of the resource.\n * @param {Document=} opt_document Optional document to use.\n */\nspfNetResource.destroy = function (type, url, opt_document) {\n  url = spfNetResource.canonicalize(type, url)\n  var el = spfNetResource.find(type, url, opt_document)\n  if (el && el.parentNode) {\n    el.parentNode.removeChild(el)\n  }\n  spfNetResource.status.clear(type, url)\n}\n\n/**\n * Finds a previously created element.\n * See {@link #create}.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url URL of the resource.\n * @param {(Document|Element)=} opt_root Optional document or element to\n *     search in.\n * @return {!Node|undefined} The found element, or undefined if not found.\n */\nspfNetResource.find = function (type, url, opt_root) {\n  var label = spfNetResource.label(url)\n  var cls = spfNetResource.key(type, label)\n  var selector = '.' + cls\n  var els = spfDom.query(selector, opt_root)\n  return els[0]\n}\n\n/**\n * Discovers existing resources in the document and registers them as loaded.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @return {Array.<Node>|NodeList} The newly found elements.\n */\nspfNetResource.discover = function (type) {\n  spfDebug.debug('resource.discover', type)\n  var isJS = type == spfNetResource.Type.JS\n  var selector = isJS ? 'script[src]' : 'link[rel~=\"stylesheet\"]'\n  var els = []\n  spfArray.each(spfDom.query(selector), function (el) {\n    var url = isJS ? el.src : el.href\n    url = spfNetResource.canonicalize(type, url)\n    // Ignore if already loading or loaded.\n    if (!spfNetResource.status.get(type, url)) {\n      spfNetResource.status.set(spfNetResource.State.LOADED, type, url)\n      var label = spfNetResource.label(url)\n      var cls = spfNetResource.key(type, label)\n      spfDomClasslist.add(el, cls)\n      var name = el.getAttribute('name')\n      if (name) {\n        spfNetResource.name.set(type, url, name)\n        spfNetResource.url.set(type, name, url)\n      }\n      els.push(el)\n      spfDebug.debug('  found', url, cls, name)\n    }\n  })\n\n  var contentSelector = isJS ? 'script[name]' : 'style[name]'\n  var str = ''\n  var id = ''\n  var name = ''\n  var label = ''\n  var cls = ''\n  spfArray.each(spfDom.query(contentSelector), function (el) {\n    name = el.getAttribute('name')\n    if (name) {\n      str = el.innerText.replace(/(\\r\\n|\\n|\\r)/gm, '')\n\n      // Use a hashcode to identify the resource instead of a URL.\n      id = 'hash-' + spfString.hashcode(str.replace(/\\s/g, ''))\n\n      // Ignore if already loading or loaded.\n      if (!spfNetResource.status.get(type, id)) {\n        spfNetResource.status.set(spfNetResource.State.LOADED, type, id)\n\n        spfNetResource.url.set(type, name, id)\n\n        label = spfNetResource.label(id)\n        cls = spfNetResource.key(type, label)\n        el.className = cls\n        el.setAttribute('name', name)\n\n        els.push(el)\n      }\n    }\n  })\n\n  return els\n}\n\n/**\n * Prefetches a resource by creating a dummy element and appending it to an\n * iframe document.  The resource will be requested but not loaded. Use to\n * prime the browser cache and avoid needing to request the resource when\n * subsequently loaded.  See {@link #get}.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url URL of the resource.\n * @param {boolean=} opt_force Whether to force fetching the resource even if\n *     it has already been fetched before; useful for preconnect when the\n *     connection keep-alive is shorter than repeat attempt intervals.\n */\nspfNetResource.prefetch = function (type, url, opt_force) {\n  if (!url) {\n    return\n  }\n  url = spfNetResource.canonicalize(type, url)\n  // Skip fetching if the element is already loaded on the page, unless\n  // opt_force is specified.\n  if (!opt_force && spfNetResource.status.get(type, url)) {\n    return\n  }\n  // If opt_force is specified, tracking whether the element exists is unneeded,\n  // and if prefetching an image (e.g. for URL preconnection), the standard DOM\n  // logic is also unneeded.  In this case, use the simpler/faster Image object.\n  if (opt_force && type == spfNetResource.Type.IMG) {\n    spfNetResource.preconnect_(url)\n    return\n  }\n  var label = spfNetResource.label(url)\n  var id = spfNetResource.key(type, label)\n  var key = spfNetResource.key(type, 'prefetch')\n  var el = /** @type {HTMLIFrameElement} */ (document.getElementById(key))\n  if (!el) {\n    el = spfDom.createIframe(key, null, function (el) {\n      // Use the title attribute as the iframe's loaded flag.\n      el.title = key\n      spfTasks.run(key, true)\n    })\n  } else {\n    // Return if the resource is already prefetched, unless opt_force is\n    // specified.\n    if (!opt_force && el.contentWindow.document.getElementById(id)) {\n      return\n    }\n  }\n  // Firefox needs the iframe to be fully created in the DOM before continuing.\n  // So delay adding elements to the iframe until onload.\n  var next = spfBase.bind(spfNetResource.prefetch_, null, el, type, url, id, key)\n  if (!el.title) {\n    spfTasks.add(key, next)\n  } else {\n    next()\n  }\n}\n\n/**\n * See {@link #prefetch}.\n *\n * @param {HTMLIFrameElement} el The iframe to load resources in.\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url URL of the resource.\n * @param {string} id The computed unique id of the resource.\n * @param {string} group The group value to use when tracking these resources.\n * @private\n */\nspfNetResource.prefetch_ = function (el, type, url, id, group) {\n  var isJS = type == spfNetResource.Type.JS\n  var isCSS = type == spfNetResource.Type.CSS\n  var doc = el.contentWindow.document\n  // If an element with a given id already exists, remove it before prefetching\n  // the resource to avoid growing the overall DOM size.  Since `prefetch`\n  // already checks for the element's existence before calling this method,\n  // this is to prevent repeated calls with `opt_force` from always generating\n  // new nodes.\n  var fetchEl = doc.getElementById(id)\n  if (fetchEl) {\n    fetchEl.parentNode.removeChild(fetchEl)\n  }\n  if (isJS) {\n    fetchEl = doc.createElement('object')\n    if (spfNetResource.IS_IE) {\n      // IE needs a <script> in order to complete the request, but\n      // fortunately will not execute it unless in the DOM.  Attempting to\n      // use an <object> like other browsers will cause the download to hang.\n      // The <object> will just be a placeholder for the request made.\n      var extraElForIE = doc.createElement('script')\n      extraElForIE.src = url\n    } else {\n      // Otherwise scripts need to be prefetched as objects to avoid execution.\n      fetchEl.data = url\n    }\n    fetchEl.id = id\n    doc.body.appendChild(fetchEl)\n  } else if (isCSS) {\n    // Stylesheets can be prefetched in the same way as loaded.\n    fetchEl = spfNetResource.create(type, url, null, doc, group)\n    fetchEl.id = id\n  } else {\n    // For establishing a preconnection, use an image request.\n    fetchEl = doc.createElement('img')\n    if (spfNetResource.IS_IE) {\n      // IE needs page-level cache busting to properly re-request images, but\n      // not network-level.  Use URL hashes to trick it into re-sending.\n      url = url + '#' + spfBase.now()\n    }\n    fetchEl.src = url\n    fetchEl.id = id\n    doc.body.appendChild(fetchEl)\n  }\n}\n\n/**\n * See {@link #prefetch}.\n *\n * @param {string} url URL of the resource.\n * @private\n */\nspfNetResource.preconnect_ = function (url) {\n  // For establishing a preconnection, use an image request.  When the DOM logic\n  // is not needed to track status, use the simpler/faster object approach.\n  var img = new Image()\n  if (spfNetResource.IS_IE) {\n    // IE needs page-level cache busting to properly re-request images, but\n    // not network-level.  Use URL hashes to trick it into re-sending.\n    url = url + '#' + spfBase.now()\n  }\n  img.src = url\n}\n\n/**\n * Evaluates resource text and defines a name to use for management.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} text The text of the resource.\n * @param {string} name Name to identify the resource.\n */\nspfNetResource.eval = function (type, text, name) {\n  var isJS = type == spfNetResource.Type.JS\n  var previous = spfNetResource.url.get(type, name)\n  // Use a hashcode to identify the resource instead of a URL.\n  var id = 'hash-' + spfString.hashcode(text.replace(/\\s/g, ''))\n  spfNetResource.url.set(type, name, id)\n  var complete = spfNetResource.status.loaded(type, id)\n  if (complete) {\n    return\n  }\n  var el = spfNetResource.exec(type, text)\n  if (!el) {\n    return\n  }\n  spfNetResource.status.set(spfNetResource.State.LOADED, type, id)\n  if (el && (!isJS || SPF_DEBUG)) {\n    // Script elements are removed after execution, so only modify attributes\n    // if a style or in debug mode.\n    var label = spfNetResource.label(id)\n    var cls = spfNetResource.key(type, label)\n    el.className = cls\n    el.setAttribute('name', name)\n  }\n  previous = previous && previous[0]\n  if (previous) {\n    spfNetResource.destroy(type, previous)\n  }\n}\n\n/**\n * Executes resource text by creating an element and appending it to\n * the document.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} text The text of the resource.\n * @return {Element} The dynamically created element.\n */\nspfNetResource.exec = function (type, text) {\n  text = spfString.trim(text)\n  if (!text) {\n    return null\n  }\n  var isJS = type == spfNetResource.Type.JS\n  var targetEl = document.getElementsByTagName('head')[0] || document.body\n  var el\n  if (isJS) {\n    el = document.createElement('script')\n    el.text = text\n    // Place the scripts in the head instead of the body to avoid errors\n    // when called from the head in the first place.\n    targetEl.appendChild(el)\n    if (!SPF_DEBUG) {\n      // Remove scripts afterwards to avoid unnecessary increased DOM size.\n      targetEl.removeChild(el)\n    }\n  } else {\n    el = document.createElement('style')\n    // IE requires the style element to be in the document before accessing\n    // the StyleSheet object.\n    targetEl.appendChild(el)\n    if ('styleSheet' in el) {\n      el.styleSheet.cssText = text\n    } else {\n      el.appendChild(document.createTextNode(text))\n    }\n  }\n  return el\n}\n\n/**\n * Sets the path prefix or replacement map to use when resolving relative URLs.\n * See {@link #canonicalize}.\n *\n * Note: The order in which replacements are made is not guaranteed.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string|Object.<string>} paths The paths.\n */\nspfNetResource.path = function (type, paths) {\n  var key = /** @type {spfState.Key} */ (\n      spfState.Key.RESOURCE_PATHS_PREFIX + type)\n  spfState.set(key, paths)\n}\n\n/**\n * Convert a resource URL to the \"canonical\" version in three steps:\n *   1: replacing path segments (see {@link #path})\n *   2: appending a file type extension\n *   3: converting to absolute (see {@link spfUrl.absolute})\n * Absolute URLs (i.e. those that start with http://) are ignored for all\n * three steps.  Protocol-relative URLs (i.e. those that start with //)\n * are ignored for steps 1 and 2.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The initial url.\n * @return {string} The adjusted url.\n */\nspfNetResource.canonicalize = function (type, url) {\n  var key = /** @type {spfState.Key} */ (\n      spfState.Key.RESOURCE_PATHS_PREFIX + type)\n  if (url) {\n    var index = url.indexOf('//')\n    if (index < 0) {\n      // Relative URL: \"//\" not found.\n      if (spfString.startsWith(url, 'hash-')) {\n        // Ignore hashcode IDs.\n        return url\n      }\n      var paths = spfState.get(key) || ''\n      if (spfString.isString(paths)) {\n        url = paths + url\n      } else {\n        for (var p in paths) {\n          url = url.replace(p, paths[p])\n        }\n      }\n      // Images don't have a standard extension format.\n      if (type != spfNetResource.Type.IMG) {\n        url = url.indexOf('.' + type) < 0 ? url + '.' + type : url\n      }\n      url = spfUrl.absolute(url)\n    } else if (index == 0) {\n      // Protocol-Relative URL: \"//\" found at start.\n      url = spfUrl.absolute(url)\n    }\n  }\n  return url\n}\n\n/**\n * Build the full resource key.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} label The resource label.\n * @param {string=} opt_group An optional group name for the resource.\n * @return {string} The compound key.\n */\nspfNetResource.key = function (type, label, opt_group) {\n  return type + '-' + label + (opt_group ? '-' + opt_group : '')\n}\n\n/**\n * Convert a URL to an internal \"label\" for use in identifying it.\n *\n * @param {?} url The resource URL.\n * @return {string} The label.\n */\nspfNetResource.label = function (url) {\n  return url ? String(url).replace(/[^\\w]/g, '') : ''\n}\n\n/**\n * Sets the loading status for a resource URL.\n *\n * @param {spfNetResource.State} status The loading status.\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The URL.\n * @param {string=} opt_group Optional group.\n */\nspfNetResource.status.set = function (status, type, url, opt_group) {\n  var key = spfNetResource.key(type, url, opt_group)\n  spfNetResource.status_[key] = status\n}\n\n/**\n * Returns the loading status for a resource URL.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The URL.\n * @param {string=} opt_group Optional group.\n * @return {spfNetResource.State|undefined} The loading status.\n */\nspfNetResource.status.get = function (type, url, opt_group) {\n  var key = spfNetResource.key(type, url, opt_group)\n  return spfNetResource.status_[key]\n}\n\n/**\n * Clears the previously set loading status for a resource URL.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The URL.\n */\nspfNetResource.status.clear = function (type, url) {\n  var key = spfNetResource.key(type, url)\n  delete spfNetResource.status_[key]\n}\n\n/**\n * Checks to see if the status for a resource URL is \"loaded\".\n * URLs that are empty strings are always \"loaded\".\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The URL.\n * @return {boolean} Whether the URL is loaded.\n */\nspfNetResource.status.loaded = function (type, url) {\n  var status = spfNetResource.status.get(type, url)\n  return url == '' || status == spfNetResource.State.LOADED\n}\n\n/**\n * Sets the dependency name for a resource URL.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The URL.\n * @param {string} name The dependency name.\n */\nspfNetResource.name.set = function (type, url, name) {\n  var key = spfNetResource.key(type, url)\n  spfNetResource.name_[key] = name\n}\n\n/**\n * Returns the dependency name currently set for a resource URL.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The URL.\n * @return {string|undefined} The dependency name.\n */\nspfNetResource.name.get = function (type, url) {\n  var key = spfNetResource.key(type, url)\n  return spfNetResource.name_[key]\n}\n\n/**\n * Clears the previously set dependency name for a resource URL.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} url The URL.\n */\nspfNetResource.name.clear = function (type, url) {\n  var key = spfNetResource.key(type, url)\n  delete spfNetResource.name_[key]\n}\n\n/**\n * Sets the resource URL for a dependency name.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} name The dependency name.\n * @param {string} url The URL.\n */\nspfNetResource.url.set = function (type, name, url) {\n  var key = spfNetResource.key(type, name)\n  spfNetResource.url_[key] = url\n}\n\n/**\n * Returns the resource URL currently set for a dependency name.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} name The dependency name.\n * @return {string|undefined} The URL.\n */\nspfNetResource.url.get = function (type, name) {\n  var key = spfNetResource.key(type, name)\n  var url = spfNetResource.url_[key]\n  return url\n}\n\n/**\n * Clears the previously set resource URL for a dependency name.\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} name The dependency name.\n */\nspfNetResource.url.clear = function (type, name) {\n  var key = spfNetResource.key(type, name)\n  delete spfNetResource.url_[key]\n}\n\n/**\n * Checks to see if the resource URL for a dependency name has been loaded.\n * Dependency names that are empty strings are always \"loaded\".\n *\n * @param {spfNetResource.Type} type Type of the resource.\n * @param {string} name The dependency name.\n * @return {boolean}\n */\nspfNetResource.url.loaded = function (type, name) {\n  var url = spfNetResource.url.get(type, name)\n  return url != undefined && spfNetResource.status.loaded(type, url)\n}\n\n/**\n * Map a URL to a resource status.\n * @type {!Object.<spfNetResource.State>}\n * @private\n */\nspfNetResource.status_ = {}\n\n/**\n * Map a URL to a dependency name.\n * @type {!Object.<string>}\n * @private\n */\nspfNetResource.name_ = {}\n\n/**\n * Map a dependency name to a URL.\n * @type {!Object.<string>}\n * @private\n */\nspfNetResource.url_ = {}\n\n/**\n * Whether the browser is Internet Explorer; valid for MSIE 8+ aka Trident 4+.\n * @type {boolean}\n * @const\n */\nspfNetResource.IS_IE = spfString.contains(navigator.userAgent, ' Trident/')\n\n/**\n * The loading state of a resource.\n * @enum {number}\n */\nspfNetResource.State = {\n  LOADING: 1,\n  LOADED: 2\n}\n\n/**\n * Supported resource types.\n * @enum {string}\n */\nspfNetResource.Type = {\n  CSS: 'css',\n  IMG: 'img',\n  JS: 'js'\n}\n\n// Automatic initiazation for spfNetResource.status_.\n// When built for the bootloader, unconditionally set in state.\nif (SPF_BOOTLOADER) {\n  spfState.set(spfState.Key.RESOURCE_STATUS, spfNetResource.status_)\n} else {\n  if (!spfState.has(spfState.Key.RESOURCE_STATUS)) {\n    spfState.set(spfState.Key.RESOURCE_STATUS, spfNetResource.status_)\n  }\n  spfNetResource.status_ =\n      /** @type {!Object.<spfNetResource.State>} */ (\n      spfState.get(spfState.Key.RESOURCE_STATUS))\n}\n\n// Automatic initiazation for spfNetResource.name_.\n// When built for the bootloader, unconditionally set the map in state.\nif (SPF_BOOTLOADER) {\n  spfState.set(spfState.Key.RESOURCE_NAME, spfNetResource.name_)\n} else {\n  if (!spfState.has(spfState.Key.RESOURCE_NAME)) {\n    spfState.set(spfState.Key.RESOURCE_NAME, spfNetResource.name_)\n  }\n  spfNetResource.name_ = /** @type {!Object.<string>} */ (\n      spfState.get(spfState.Key.RESOURCE_NAME))\n}\n\n// Automatic initiazation for spfNetResource.url_.\n// When built for the bootloader, unconditionally set the map in state.\nif (SPF_BOOTLOADER) {\n  spfState.set(spfState.Key.RESOURCE_URL, spfNetResource.url_)\n} else {\n  if (!spfState.has(spfState.Key.RESOURCE_URL)) {\n    spfState.set(spfState.Key.RESOURCE_URL, spfNetResource.url_)\n  }\n  spfNetResource.url_ = /** @type {!Object.<string>} */ (\n      spfState.get(spfState.Key.RESOURCE_URL))\n}\n\nexport default spfNetResource\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/net/resource.js","// Copyright 2014 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions for dynamically loading scripts without blocking.\n *\n * Provides asynchronous loading and dependency management, loosely similar to\n * $script.js {@link https://github.com/ded/script.js/} but with enhancements.\n * Designed to be built as both a standlone bootstrap script loader in the\n * document head and also built as part of the main SPF code. When both the\n * bootstrap and main code is loaded on the same page, the main code extends\n * the bootstrap code for seamless script loading.\n *\n * Unconditionally load a script:\n *     spfNetScript.get(url, function() {\n *       // url is loaded\n *     });\n *\n * Conditionally load a script only if not already loaded:\n *     spfNetScript.load(url, 'name', function() {\n *       // url is loaded\n *     });\n * Or:\n *     spfNetScript.load(url, 'name');\n *     spfNetScript.ready('name', function() {\n *       // url is loaded\n *     });\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\nimport {SPF_BOOTLOADER} from '../base'\nimport spfArray from '../array/array'\nimport spfDebug from '../debug/debug'\nimport spfNetResource from '../net/resource'\nimport spfPubsub from '../pubsub/pubsub'\nimport spfState from '../state'\nimport spfString from '../string/string'\n\n// goog.provide('spfNetScript');\nlet spfNetScript = {}\n\n/**\n * Loads a script asynchronously and defines a name to use for dependency\n * management and unloading.  See {@link #ready} to wait for named scripts to\n * be loaded and {@link #unload} to remove previously loaded scripts.\n *\n * - Subsequent calls to load the same URL will not reload the script.  To\n *   reload a script, unload it first with {@link #unload}.  To unconditionally\n *   load a script, see {@link #get}.\n *\n * - A name must be specified to identify the same script at different URLs.\n *   (For example, \"main-A.js\" and \"main-B.js\" are both \"main\".)  When a name\n *   is specified, all other scripts with the same name will be unloaded\n *   before the callback is executed.  This allows switching between\n *   versions of the same script at different URLs.\n *\n * - A callback can be specified to execute once the script has loaded.  The\n *   callback will be executed each time, even if the script is not reloaded.\n *\n * @param {string} url URL of the script to load.\n * @param {string} name Name to identify the script.\n * @param {Function=} opt_fn Optional callback function to execute when the\n *     script is loaded.\n */\nspfNetScript.load = function (url, name, opt_fn) {\n  var type = spfNetResource.Type.JS\n  spfNetResource.load(type, url, name, opt_fn)\n}\n\n/**\n * Unloads scripts identified by name.  See {@link #load}.\n *\n * NOTE: Unloading a script will prevent execution of ALL pending callbacks\n * but is NOT guaranteed to stop the browser loading a pending URL.\n *\n * @param {string} name The name.\n */\nspfNetScript.unload = function (name) {\n  var type = spfNetResource.Type.JS\n  spfNetResource.unload(type, name)\n}\n\n/**\n * Discovers existing scripts in the document and registers them as loaded.\n */\nspfNetScript.discover = function () {\n  var type = spfNetResource.Type.JS\n  spfNetResource.discover(type)\n}\n\n/**\n * Unconditionally loads a script by dynamically creating an element and\n * appending it to the document without regard for dependencies or whether it\n * has been loaded before.  A script directly loaded by this method cannot\n * be unloaded by name.  Compare to {@link #load}.\n *\n * @param {string} url URL of the script to load.\n * @param {Function=} opt_fn Function to execute when loaded.\n */\nspfNetScript.get = function (url, opt_fn) {\n  var type = spfNetResource.Type.JS\n  spfNetResource.create(type, url, opt_fn)\n}\n\n/**\n * Prefetchs one or more scripts; the scripts will be requested but not loaded.\n * Use to prime the browser cache and avoid needing to request the script when\n * subsequently loaded.  See {@link #load}.\n *\n * @param {string|Array.<string>} urls One or more URLs of scripts to prefetch.\n */\nspfNetScript.prefetch = function (urls) {\n  var type = spfNetResource.Type.JS\n  // Convert to an array if needed.\n  urls = spfArray.toArray(urls)\n  spfArray.each(urls, function (url) {\n    spfNetResource.prefetch(type, url)\n  })\n}\n\n/**\n * Waits for one or more scripts identified by name to be loaded and executes\n * the callback function.  See {@link #load} or {@link #done} to define names.\n * If an empty name is provided, it will be considered loaded immediately.\n *\n * @param {string|Array.<string>} names One or more names.\n * @param {Function=} opt_fn Callback function to execute when the\n *     scripts have loaded.\n * @param {Function=} opt_require Callback function to execute if names\n *     are specified that have not yet been defined/loaded.\n */\nspfNetScript.ready = function (names, opt_fn, opt_require) {\n  var type = spfNetResource.Type.JS\n\n  // Convert to an array if needed.\n  names = spfArray.toArray(names)\n  spfDebug.debug('script.ready', names)\n\n  // Filter out empty names.\n  names = spfArray.filter(names, function (name) {\n    return !!name\n  })\n\n  // Find unknown names.\n  var unknown = []\n  spfArray.each(names, function (name) {\n    if (spfNetResource.url.get(type, name) == undefined) {\n      unknown.push(name)\n    }\n  })\n\n  // Check if all urls for the names are loaded.\n  var known = !unknown.length\n  if (opt_fn) {\n    var loaded = spf.bind(spfNetResource.url.loaded, null, type)\n    var ready = spfArray.every(names, loaded)\n    if (known && ready) {\n      // If ready, execute the callback.\n      opt_fn()\n    } else {\n      // Otherwise, wait for them to be loaded.\n      var topic = spfNetResource.key(type, names.sort().join('|'))\n      spfDebug.debug('  subscribing', topic)\n      spfPubsub.subscribe(topic, opt_fn)\n    }\n  }\n  // If provided, call the require function to allow lazy-loading.\n  if (opt_require && !known) {\n    opt_require(unknown)\n  }\n}\n\n/**\n * Notifies any waiting callbacks that `name` has completed loading.\n * Use with {@link #ready} for arbitrary readiness not directly tied to scripts.\n *\n * @param {string} name The ready name.\n */\nspfNetScript.done = function (name) {\n  var type = spfNetResource.Type.JS\n  spfNetResource.url.set(type, name, '')  // No associated URL.\n  spfNetResource.check(type)\n}\n\n/**\n * \"Ignores\" a script load by canceling execution of a pending callback.\n *\n * Stops waiting for one or more scripts identified by name to be loaded and\n * cancels the pending callback execution.  The callback must have been\n * registered by {@link #load} or {@link #ready}.  If the callback was\n * registered by {@link #ready} and more than one name was provided, the same\n * names must be used here.\n *\n * @param {string|Array.<string>} names One or more names.\n * @param {Function} fn Callback function to cancel.\n */\nspfNetScript.ignore = function (names, fn) {\n  var type = spfNetResource.Type.JS\n  // Convert to an array if needed.\n  names = spfArray.toArray(names)\n  spfDebug.debug('script.ignore', names)\n  var topic = spfNetResource.key(type, names.sort().join('|'))\n  spfDebug.debug('  unsubscribing', topic)\n  spfPubsub.unsubscribe(topic, fn)\n}\n\n/**\n * Recursively loads scripts identified by name, first loading\n * any dependendent scripts.  Use {@link #declare} to define dependencies.\n *\n * @param {string|Array.<string>} names One or more names.\n * @param {Function=} opt_fn Callback function to execute when the\n *     scripts have loaded.\n */\nspfNetScript.require = function (names, opt_fn) {\n  var type = spfNetResource.Type.JS\n  spfDebug.debug('script.require', names)\n\n  // When built for the bootloader, automatic unloading of scripts is not\n  // supported.  If someone is attempting to load a new version of a script\n  // before loading the main SPF code, then this should be an error.  Automatic\n  // unloading of scripts is primarily intended for navigation between versions.\n  if (!SPF_BOOTLOADER) {\n    // Convert to an array if needed.\n    names = spfArray.toArray(names)\n    spfArray.each(names, function (name) {\n      if (name) {\n        var url = spfNetScript.url_[name] || name\n        url = spfNetResource.canonicalize(type, url)\n        var previous = spfNetResource.url.get(type, name)\n        if (previous && url != previous) {\n          spfNetScript.unrequire(name)\n        }\n      }\n    })\n  }\n\n  spfNetScript.ready(names, opt_fn, spfNetScript.require_)\n}\n\n/**\n * See {@link #require}.\n *\n * @param {Array.<string>} names The names.\n * @private\n */\nspfNetScript.require_ = function (names) {\n  // Iterate and check if there are declared dependencies.\n  // If so, check if the deps are ready and if not recurse.\n  // If not, load the scripts for that name.\n  spfArray.each(names, function (name) {\n    var deps = spfNetScript.deps_[name]\n    var url = spfNetScript.url_[name] || name\n    var next = function () {\n      spfNetScript.load(url, name)\n    }\n    if (deps) {\n      spfNetScript.require(deps, next)\n    } else {\n      next()\n    }\n  })\n}\n\n/**\n * Recursively unloads scripts identified by name, first unloading\n * any dependendent scripts.  Use {@link #declare} to define dependencies.\n *\n * @param {string|Array.<string>} names One or more names.\n */\nspfNetScript.unrequire = function (names) {\n  spfDebug.debug('script.unrequire', names)\n  // Convert to an array if needed.\n  names = spfArray.toArray(names)\n  spfArray.each(names, function (name) {\n    var descendants = []\n    for (var dep in spfNetScript.deps_) {\n      var list = spfNetScript.deps_[dep]\n      list = spfArray.toArray(list)\n      spfArray.each(list, function (l) {\n        if (l == name) {\n          descendants.push(dep)\n        }\n      })\n    }\n    spfArray.each(descendants, function (descend) {\n      spfNetScript.unrequire(descend)\n    })\n    spfNetScript.unload(name)\n  })\n}\n\n/**\n * Evaluates script text and defines a name to use for management.\n *\n * - Subsequent calls to evaluate the same text will not re-evaluate the script.\n *   To unconditionally evalute a script, see {@link #exec}.\n *\n * @param {string} text The text of the script.\n * @param {string} name Name to identify the script.\n * @return {undefined}\n */\nspfNetScript.eval = function (text, name) {\n  var type = spfNetResource.Type.JS\n  var el = spfNetResource.eval(type, text, name)\n}\n\n/**\n * Unconditionally evaluates script text.  See {@link #eval}.\n *\n * @param {string} text The text of the script.\n */\nspfNetScript.exec = function (text) {\n  var type = spfNetResource.Type.JS\n  var el = spfNetResource.exec(type, text)\n}\n\n/**\n * Sets the dependency map and optional URL map used when requiring scripts.\n * See {@link #require}.\n *\n * @param {Object.<(string|Array.<string>)>} deps The dependency map.\n * @param {Object.<string>=} opt_urls The optional URL map.\n */\nspfNetScript.declare = function (deps, opt_urls) {\n  if (deps) {\n    for (var name in deps) {\n      spfNetScript.deps_[name] = deps[name]\n    }\n    if (opt_urls) {\n      for (var name in opt_urls) {\n        spfNetScript.url_[name] = opt_urls[name]\n      }\n    }\n  }\n}\n\n/**\n * Sets the path prefix or replacement map to use when resolving relative URLs.\n *\n * Note: The order in which replacements are made is not guaranteed.\n *\n * @param {string|Object.<string>} paths The paths.\n */\nspfNetScript.path = function (paths) {\n  var type = spfNetResource.Type.JS\n  spfNetResource.path(type, paths)\n}\n\n/**\n * Map of dependencies used for {@link #require}.\n * @type {!Object.<(string|Array.<string>)>}\n * @private\n */\nspfNetScript.deps_ = {}\n// When built for the bootloader, unconditionally set the map in state.\nif (SPF_BOOTLOADER) {\n  spfState.set(spfState.Key.SCRIPT_DEPS, spfNetScript.deps_)\n} else {\n  if (!spfState.has(spfState.Key.SCRIPT_DEPS)) {\n    spfState.set(spfState.Key.SCRIPT_DEPS, spfNetScript.deps_)\n  }\n  spfNetScript.deps_ = /** @type {!Object.<(string|Array.<string>)>} */ (\n      spfState.get(spfState.Key.SCRIPT_DEPS))\n}\n\n/**\n * Map of dependency names to URLs for {@link #require}, used for custom\n * resolution before URL canonicalization.\n * @type {!Object.<string>}\n * @private\n */\nspfNetScript.url_ = {}\n// When built for the bootloader, unconditionally set the map in state.\nif (SPF_BOOTLOADER) {\n  spfState.set(spfState.Key.SCRIPT_URL, spfNetScript.url_)\n} else {\n  if (!spfState.has(spfState.Key.SCRIPT_URL)) {\n    spfState.set(spfState.Key.SCRIPT_URL, spfNetScript.url_)\n  }\n  spfNetScript.url_ = /** @type {!Object.<string>} */ (\n      spfState.get(spfState.Key.SCRIPT_URL))\n}\n\nexport default spfNetScript\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/net/script.js","// Copyright 2014 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions for dynamically loading stylesheets.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// goog.provide('spfNetStyle');\n\nimport spfArray from '../array/array'\nimport spfNetResource from '../net/resource'\nimport spfString from '../string/string'\n\nlet spfNetStyle = {}\n\n/**\n * Loads a stylesheet asynchronously and defines a name to use for dependency\n * management and unloading.  See {@link #unload} to remove previously loaded\n * stylesheets.\n *\n * - Subsequent calls to load the same URL will not reload the stylesheet.  To\n *   reload a stylesheet, unload it first with {@link #unload}.  To\n *   unconditionally load a stylesheet, see {@link #get}.\n *\n * - A name must be specified to identify the same stylesheet at different URLs.\n *   (For example, \"main-A.css\" and \"main-B.css\" are both \"main\".)  When a name\n *   is specified, all other stylesheets with the same name will be unloaded.\n *   This allows switching between versions of the same stylesheet at different\n *   URLs.\n *\n * - A callback can be specified to execute once the stylesheet has loaded.  The\n *   callback will be executed each time, even if the stylesheet is not\n *   reloaded.  NOTE: Unlike scripts, this callback is best effort and is\n *   supported in the following browser versions: IE 6, Chrome 19, Firefox 9,\n *   Safari 6.\n *\n * @param {string} url URL of the stylesheet to load.\n * @param {string} name Name to identify the stylesheet.\n * @param {Function=} opt_fn Optional callback function to execute when the\n *     stylesheet is loaded.\n */\nspfNetStyle.load = function (url, name, opt_fn) {\n  var type = spfNetResource.Type.CSS\n  spfNetResource.load(type, url, name, opt_fn)\n}\n\n/**\n * Unloads a stylesheet identified by dependency name.  See {@link #load}.\n *\n * @param {string} name The dependency name.\n */\nspfNetStyle.unload = function (name) {\n  var type = spfNetResource.Type.CSS\n  spfNetResource.unload(type, name)\n}\n\n/**\n * Discovers existing stylesheets in the document and registers them as loaded.\n */\nspfNetStyle.discover = function () {\n  var type = spfNetResource.Type.CSS\n  spfNetResource.discover(type)\n}\n\n/**\n * Unconditionally loads a stylesheet by dynamically creating an element and\n * appending it to the document without regard for whether it has been loaded\n * before. A stylesheet directly loaded by this method cannot be unloaded by\n * name.  Compare to {@link #load}.\n *\n * @param {string} url URL of the stylesheet to load.\n * @param {Function=} opt_fn Function to execute when loaded.\n */\nspfNetStyle.get = function (url, opt_fn) {\n  // NOTE: Callback execution depends on onload support and is best effort.\n  // Chrome 19, Safari 6, Firefox 9, Opera and IE 5.5 support stylesheet onload.\n  var type = spfNetResource.Type.CSS\n  spfNetResource.create(type, url, opt_fn)\n}\n\n/**\n * Prefetchs one or more stylesheets; the stylesheets will be requested but not\n * loaded.  Use to prime the browser cache and avoid needing to request the\n * stylesheet when subsequently loaded.  See {@link #load}.\n *\n * @param {string|Array.<string>} urls One or more stylesheet URLs to prefetch.\n */\nspfNetStyle.prefetch = function (urls) {\n  var type = spfNetResource.Type.CSS\n  // Convert to an array if needed.\n  urls = spfArray.toArray(urls)\n  spfArray.each(urls, function (url) {\n    spfNetResource.prefetch(type, url)\n  })\n}\n\n/**\n * Evaluates style text and defines a name to use for management.\n *\n * - Subsequent calls to evaluate the same text will not re-evaluate the style.\n *   To unconditionally evalute a style, see {@link #exec}.\n *\n * @param {string} text The text of the style.\n * @param {string} name Name to identify the style.\n * @return {undefined}\n */\nspfNetStyle.eval = function (text, name) {\n  var type = spfNetResource.Type.CSS\n  spfNetResource.eval(type, text, name)\n}\n\n/**\n * Unconditionally evaluates style text.  See {@link #eval}.\n *\n * @param {string} text The text of the style.\n */\nspfNetStyle.exec = function (text) {\n  var type = spfNetResource.Type.CSS\n  spfNetResource.exec(type, text)\n}\n\n/**\n * Sets the path prefix or replacement map to use when resolving relative URLs.\n *\n * Note: The order in which replacements are made is not guaranteed.\n *\n * @param {string|Object.<string>} paths The paths.\n */\nspfNetStyle.path = function (paths) {\n  var type = spfNetResource.Type.CSS\n  spfNetResource.path(type, paths)\n}\n\nexport default spfNetStyle\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/net/style.js","// Copyright 2013 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Simple asynchronous queued task execution.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport {spfBase} from '../base'\nimport spfConfig from '../config'\nimport spfState from '../state'\nimport spfString from '../string/string'\nlet spfTasks = {}\n\n// goog.provide('spfTasks');\n\n// goog.require('spf');\n// goog.require('spfConfig');\n// goog.require('spfState');\n// goog.require('spfString');\n// goog.require('spfTracing');\n\n/**\n * Adds a task to a queue to be executed asynchronously.\n *\n * @param {string} key The key to identify the task queue.\n * @param {!Function} fn The function to execute for this task.\n * @param {number=} opt_delay The time in milliseconds to wait before executing\n *     the function; defaults to 0.\n * @return {number} The number of tasks in the queue afterwards.\n */\nspfTasks.add = function (key, fn, opt_delay) {\n  var queues = spfTasks.queues_\n  var queue = queues[key]\n  if (key && fn) {\n    if (!queue) {\n      queue = queues[key] = spfTasks.createQueue_()\n    }\n    var task = spfTasks.createTask_(fn, opt_delay || 0)\n    return queue.items.push(task)\n  }\n  return (queue && queue.items.length) || 0\n}\n\n/**\n * Runs queued tasks, if not already running.\n *\n * @param {string} key The key to identify the task queue.\n * @param {boolean=} opt_sync Whether to execute the queued tasks synchronously;\n *     defaults to false.\n */\nspfTasks.run = function (key, opt_sync) {\n  var queue = spfTasks.queues_[key]\n  if (queue) {\n    var active = !!queue.scheduledKey || !!queue.timeoutKey\n    var suspended = !(queue.semaphore > 0)\n    if (!suspended && (opt_sync || !active)) {\n      spfTasks.do_(key, opt_sync)\n    }\n  }\n}\n\n/**\n * Suspends execution of a running task queue.\n * See {@link #resume}.\n *\n * Queue execution is controlled by values similar to POSIX Semaphores.  Each\n * `suspend` decrements a value, and each `resume` increments it.\n * Queue execution only continues when the values are positive, so while\n * `suspend` may be called multiple times, it must be matched by an equal\n * number of `resume` calls.\n *\n * @param {string} key The key to identify the task queue.\n */\nspfTasks.suspend = function (key) {\n  var queue = spfTasks.queues_[key]\n  if (queue) {\n    queue.semaphore--\n  }\n}\n\n/**\n * Resumes execution of a running task queue.\n * See {@link #suspend}.\n *\n * Queue execution is controlled by values similar to POSIX Semaphores.  Each\n * `suspend` decrements a value, and each `resume` increments it.\n * Queue execution only continues when the values are positive, so while\n * `suspend` may be called multiple times, it much be matched by an equal\n * number of `resume` calls.\n *\n * @param {string} key The key to identify the task queue.\n * @param {boolean=} opt_sync Whether to execute the queued tasks synchronously;\n *     defaults to false.\n */\nspfTasks.resume = function (key, opt_sync) {\n  var queue = spfTasks.queues_[key]\n  if (queue) {\n    queue.semaphore++\n    spfTasks.run(key, opt_sync)\n  }\n}\n\n/**\n * Cancels execution of a running task queue.\n *\n * @param {string} key The key to identify the task queue.\n */\nspfTasks.cancel = function (key) {\n  var queue = spfTasks.queues_[key]\n  if (queue) {\n    spfTasks.clearAsyncTasks_(queue)\n    delete spfTasks.queues_[key]\n  }\n}\n\n/**\n * Cancels execution of all current task queues, optionally limited to\n * with a given key prefix and optionally skipping the given key.\n *\n * @param {string=} opt_keyPrefix The prefix of the tasks to be canceled.\n * @param {string=} opt_skipKey The key of the task queue that should not\n *     be canceled.\n */\nspfTasks.cancelAllExcept = function (opt_keyPrefix, opt_skipKey) {\n  var keyPrefix = opt_keyPrefix || ''\n  for (var key in spfTasks.queues_) {\n    if (opt_skipKey != key && spfString.startsWith(key, keyPrefix)) {\n      spfTasks.cancel(key)\n    }\n  }\n}\n\n/**\n * Gets a unique key for an object.  Mutates the object to store the key so\n * that multiple calls for the same object will return the same key.\n *\n * @param {Object} obj The object to get a unique key for.\n * @return {string} The unique key.\n */\nspfTasks.key = function (obj) {\n  var uid = parseInt(spfState.get(spfState.Key.TASKS_UID), 10) || 0\n  uid++\n  return obj['spf-key'] || (\n      obj['spf-key'] = '' + spfState.set(spfState.Key.TASKS_UID, uid))\n}\n\n/**\n * @param {string} key The key to identify the task queue.\n * @param {boolean=} opt_sync Whether to execute the queued tasks synchronously;\n *     defaults to false.\n * @private\n */\nspfTasks.do_ = function (key, opt_sync) {\n  var queue = spfTasks.queues_[key]\n  if (queue) {\n    spfTasks.clearAsyncTasks_(queue)\n    if (queue.semaphore > 0 && queue.items.length) {\n      var task = queue.items[0]\n      if (task) {\n        var next = spfBase.bind(spfTasks.do_, null, key, opt_sync)\n        var step = spfBase.bind(function (nextFn, taskFn) {\n          taskFn()\n          nextFn()\n        }, null, next)\n        if (opt_sync) {\n          queue.items.shift()\n          step(task.fn)\n        } else {\n          spfTasks.scheduleTask_(queue, task, step)\n        }\n      }\n    }\n  }\n}\n\n/**\n * Schedule a task for asynchronous execution.\n * @param {!spfTasks.Queue} queue The current queue being executed.\n * @param {!spfTasks.Task} task The task to be scheduled.\n * @param {!Function} step The task execution function.\n * @private\n */\nspfTasks.scheduleTask_ = function (queue, task, step) {\n  if (task.delay) {\n    // For a delay an empty step is run, and the task's functionality is saved\n    // for the next step.\n    var fn = spfBase.bind(step, null, spfBase.nullFunction)\n    queue.timeoutKey = setTimeout(fn, task.delay)\n    // Instead of removing the task from the queue, set it's delay to 0 so it\n    // will be processed traditionally on the next step.\n    task.delay = 0\n  } else {\n    queue.items.shift()\n    var fn = spfBase.bind(step, null, task.fn)\n    var scheduler = /** @type {spfBase.TaskScheduler} */ (\n        spfConfig.get('advanced-task-scheduler'))\n    var addTask = scheduler && scheduler['addTask']\n    if (addTask) {\n      queue.scheduledKey = addTask(fn)\n    } else {\n      queue.timeoutKey = setTimeout(fn, 0)\n    }\n  }\n}\n\n/**\n * Clear the current asynchronous tasks.\n * @param {!spfTasks.Queue} queue The queue.\n * @private\n */\nspfTasks.clearAsyncTasks_ = function (queue) {\n  if (queue.scheduledKey) {\n    var scheduler = /** @type {spfBase.TaskScheduler} */ (\n        spfConfig.get('advanced-task-scheduler'))\n    var cancelTask = scheduler && scheduler['cancelTask']\n    if (cancelTask) {\n      cancelTask(queue.scheduledKey)\n    }\n    queue.scheduledKey = 0\n  }\n  if (queue.timeoutKey) {\n    clearTimeout(queue.timeoutKey)\n    queue.timeoutKey = 0\n  }\n}\n\n/**\n * Type definition for a SPF task.\n * - fn: The function to execute.\n * - delay: The time in milliseconds to wait before executing the function.\n *\n * @typedef {{\n *   fn: !Function,\n *   delay: number\n * }}\n */\nspfTasks.Task\n\n/**\n * Type definition for a SPF task queue.\n * - items: The ordered list of tasks.\n * - scheduledKey: A key to track the current scheduled task.\n * - timeoutKey: A key to track the current task delayed by a timeout.\n * - semaphore: A POSIX Semaphore style value used to control suspending and\n *     resuming a running queue.\n *\n * @typedef {{\n *   items: !Array.<spfTasks.Task>,\n *   scheduledKey: number,\n *   timeoutKey: number,\n *   semaphore: number\n * }}\n */\nspfTasks.Queue\n\n/**\n * @return {spfTasks.Queue}\n * @private\n */\nspfTasks.createQueue_ = function () {\n  return {items: [], scheduledKey: 0, timeoutKey: 0, semaphore: 1}\n}\n\n/**\n * @param {!Function} fn The function to execute.\n * @param {number} delay The time in milliseconds to wait before executing\n *     the function.\n * @return {spfTasks.Task}\n * @private\n */\nspfTasks.createTask_ = function (fn, delay) {\n  return {fn: fn, delay: delay}\n}\n\n/**\n * @type {!Object.<string, spfTasks.Queue>}\n * @private\n */\nspfTasks.queues_ = {}\n\nexport default spfTasks\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/tasks/tasks.js","/**\n * @fileoverview Element dataset manipulation functions.\n * See {@link http://www.w3.org/TR/html5/Overview.html#dom-dataset}.\n *\n */\n\n// goog.provide('spfDomDataset');\n\nlet spfDomDataset = {}\n\n/**\n * Gets a custom data attribute from a node. The key should be in\n * camelCase format (e.g \"keyName\" for the \"data-key-name\" attribute).\n *\n * @param {Node} node DOM node to get the custom data attribute from.\n * @param {string} key Key for the custom data attribute.\n * @return {?string} The attribute value, if it exists.\n */\nspfDomDataset.get = function (node, key) {\n  if (node.dataset) {\n    return node.dataset[key]\n  } else {\n    return node.getAttribute('data-' + spf.string.toSelectorCase(key))\n  }\n}\n\n/**\n * Sets a custom data attribute on a node. The key should be in\n * camelCase format (e.g \"keyName\" for the \"data-key-name\" attribute).\n *\n * @param {Node} node DOM node to set the custom data attribute on.\n * @param {string} key Key for the custom data attribute.\n * @param {string} val Value for the custom data attribute.\n */\nspfDomDataset.set = function (node, key, val) {\n  if (node.dataset) {\n    node.dataset[key] = val\n  } else {\n    node.setAttribute('data-' + spf.string.toSelectorCase(key), val)\n  }\n}\n\nexport default spfDomDataset\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/dom/dataset.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions to handle pushstate-based navigation.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport {spfBase, SPF_DEBUG} from '../base'\nimport spfArray from '../array/array'\nimport spfCache from '../cache/cache'\nimport spfConfig from '../config'\nimport spfDebug from '../debug/debug'\nimport spfDom from '../dom/dom'\nimport spfDomClasslist from '../dom/classlist'\nimport spfDomDataset from '../dom/dataset'\nimport spfHistory from '../history/history'\nimport spfNavRequest from '../nav/request'\nimport spfNavResponse from '../nav/response'\nimport spfState from '../state'\nimport spfString from '../string/string'\nimport spfTasks from '../tasks/tasks'\nimport spfUrl from '../url/url'\n\nlet spfNav = {}\n// goog.provide('spfNav');\n\n/**\n * Initializes (enables) pushState navigation.\n */\nspfNav.init = function () {\n  // Initialize history management.\n  spfHistory.init(spfNav.handleHistory_, spfNav.dispatchError_)\n  // If already initialized, or running in an unsupported environment, return.\n  if (spfState.get(spfState.Key.NAV_INIT) || !document.addEventListener) {\n    return\n  }\n  // Set some basic state.\n  spfState.set(spfState.Key.NAV_INIT, true)\n  spfState.set(spfState.Key.NAV_INIT_TIME, spfBase.now())\n  spfState.set(spfState.Key.NAV_COUNTER, 0)\n  // Handle clicks for navigating when a spf-link element click happens.\n  document.addEventListener('click', spfNav.handleClick_, false)\n  spfState.set(spfState.Key.NAV_CLICK_LISTENER, spfNav.handleClick_)\n  // Handle mousedowns for prefetching when a spf-link element click starts.\n  if (spfConfig.get('experimental-prefetch-mousedown') &&\n      !spfNav.isTouchCapablePlatform_()) {\n    document.addEventListener('mousedown', spfNav.handleMouseDown_, false)\n    spfState.set(spfState.Key.NAV_MOUSEDOWN_LISTENER,\n                  spfNav.handleMouseDown_)\n  }\n  // Handle scrolls for preventing early scrolling during history changes.\n  document.addEventListener('scroll', spfNav.handleScroll_, false)\n  spfState.set(spfState.Key.NAV_SCROLL_LISTENER, spfNav.handleScroll_)\n}\n\n/**\n * Disposes (disables) pushState navigation.\n */\nspfNav.dispose = function () {\n  spfNav.cancel()\n  if (spfState.get(spfState.Key.NAV_INIT)) {\n    if (document.removeEventListener) {\n      var handleClick = /** @type {function(Event)} */ (\n          spfState.get(spfState.Key.NAV_CLICK_LISTENER))\n      document.removeEventListener('click', handleClick, false)\n      var handleMouseDown = /** @type {function(Event)} */ (\n          spfState.get(spfState.Key.NAV_MOUSEDOWN_LISTENER))\n      document.removeEventListener('mousedown', handleMouseDown, false)\n      var handleScroll = /** @type {function(Event)} */ (\n          spfState.get(spfState.Key.NAV_SCROLL_LISTENER))\n      document.removeEventListener('scroll', handleScroll, false)\n    }\n    spfState.set(spfState.Key.NAV_CLICK_LISTENER, null)\n    spfState.set(spfState.Key.NAV_MOUSEDOWN_LISTENER, null)\n    spfState.set(spfState.Key.NAV_SCROLL_LISTENER, null)\n    spfState.set(spfState.Key.NAV_SCROLL_TEMP_POSITION, null)\n    spfState.set(spfState.Key.NAV_SCROLL_TEMP_URL, null)\n    spfState.set(spfState.Key.NAV_INIT, false)\n    spfState.set(spfState.Key.NAV_INIT_TIME, null)\n    spfState.set(spfState.Key.NAV_COUNTER, null)\n  }\n  spfHistory.dispose()\n}\n\n/**\n * Walks up the DOM hierarchy, returning the first ancestor that has the\n * link class.\n *\n * @param {Node|EventTarget} element The DOM node to start with.\n * @return {Node} DOM node with the link class or null if not found.\n * @private\n */\nspfNav.getAncestorWithLinkClass_ = function (element) {\n  return spfDom.getAncestor(element, function (node) {\n    return spfDomClasslist.contains(node, /** @type {string} */ (\n        spfConfig.get('link-class')))\n  })\n}\n\n/**\n * Walks up the DOM hierarchy, returning the first ancestor that has the\n * nolink class.\n *\n * @param {Node|EventTarget} element The DOM node to start with.\n * @return {Node} DOM node with the nolink class or null if not found.\n * @private\n */\nspfNav.getAncestorWithNoLinkClass_ = function (element) {\n  return spfDom.getAncestor(element, function (node) {\n    return spfDomClasslist.contains(node, /** @type {string} */ (\n        spfConfig.get('nolink-class')))\n  })\n}\n\n/**\n * Walks up the DOM hierarchy, returning the first ancestor with a href.\n *\n * @param {Node|EventTarget} element The DOM node to start with.\n * @param {Node} parent The DOM node to end with.\n * @return {Node} DOM node with a href or null if not found.\n * @private\n */\nspfNav.getAncestorWithHref_ = function (element, parent) {\n  return spfDom.getAncestor(element, function (node) {\n    // Images in IE10 can have an href.\n    return node.href && node.tagName.toLowerCase() != 'img'\n  }, parent)\n}\n\n/**\n * Given a mouse event, try to get the corresponding navigation URL.\n *\n * @param {Event} evt The click event.\n * @return {?string} Navigation url of event if applicable.\n * @private\n */\nspfNav.getEventURL_ = function (evt) {\n  // Ignore clicks with modifier keys.\n  if (evt.metaKey || evt.altKey || evt.ctrlKey || evt.shiftKey) {\n    spfDebug.debug('    ignoring click with modifier key')\n    return null\n  }\n  // Ignore clicks with alternate buttons (left = 0, middle = 1, right = 2).\n  if (evt.button > 0) {\n    spfDebug.debug('    ignoring click with alternate button')\n    return null\n  }\n  // Ignore clicks on targets without the link class or not within\n  // a container with the link class.\n  var linkEl = spfNav.getAncestorWithLinkClass_(evt.target)\n  if (!linkEl) {\n    spfDebug.debug('    ignoring click without link class')\n    return null\n  }\n  // Ignore clicks on targets with the nolink class or within\n  // a container with the nolink class.\n  if (spfConfig.get('nolink-class')) {\n    var nolinkEl = spfNav.getAncestorWithNoLinkClass_(evt.target)\n    if (nolinkEl) {\n      spfDebug.debug('    ignoring click with nolink class')\n      return null\n    }\n  }\n  var target = spfNav.getAncestorWithHref_(evt.target, linkEl)\n  // Ignore clicks on targets without an href.\n  if (!target) {\n    spfDebug.debug('    ignoring click without href parent')\n    return null\n  }\n  return target.href\n}\n\n/**\n * Whether this URL is allowed for navigation, according to same-origin security\n * policy.\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @return {boolean}\n * @private\n */\nspfNav.isAllowed_ = function (url) {\n  // If the destination is not same-origin, cancel.\n  // TODO(nicksay): Add CORS origin whitelist.\n  var destination = spfUrl.origin(url)\n  if (destination != spfUrl.origin(window.location.href)) {\n    spfDebug.warn('destination not same-origin')\n    return false\n  }\n  return true\n}\n\n/**\n * Whether this URL is eligible for navigation, according to the configured\n * limits and lifetime.\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @return {boolean}\n * @private\n */\nspfNav.isEligible_ = function (url) {\n  // If navigation is requested but SPF is not initialized, cancel.\n  if (!spfState.get(spfState.Key.NAV_INIT)) {\n    spfDebug.warn('navigation not initialized')\n    return false\n  }\n  // If a session limit has been set and reached, cancel.\n  var count = parseInt(spfState.get(spfState.Key.NAV_COUNTER), 10) || 0\n  count++\n  var limit = parseInt(spfConfig.get('navigate-limit'), 10)\n  limit = isNaN(limit) ? Infinity : limit\n  if (count > limit) {\n    spfDebug.warn('navigation limit reached')\n    return false\n  }\n  // If a session lifetime has been set and reached, cancel.\n  var timestamp = parseInt(spfState.get(spfState.Key.NAV_INIT_TIME), 10)\n  timestamp--\n  var age = spfBase.now() - timestamp\n  var lifetime = parseInt(spfConfig.get('navigate-lifetime'), 10)\n  lifetime = isNaN(lifetime) ? Infinity : lifetime\n  if (age > lifetime) {\n    spfDebug.warn('navigation lifetime reached')\n    return false\n  }\n  return true\n}\n\n/**\n * Whether this URL should be handled for navigation (i.e. not same-page\n * hash-based navigation).\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @param {string=} opt_current The current page URL, without the SPF\n *     identifier.\n * @return {boolean}\n * @private\n */\nspfNav.isNavigable_ = function (url, opt_current) {\n  var current = opt_current || window.location.href\n  // Check for transitions between hash URLs.  If the destination\n  // contains a hash and the page is the same, navigation is not handled.\n  if (spfString.contains(url, '#')) {\n    var absoluteUrl = spfUrl.absolute(url)\n    var absoluteCurrent = spfUrl.absolute(current)\n    if (absoluteUrl == absoluteCurrent) {\n      spfDebug.debug('    not handling hash-based navigation')\n      return false\n    }\n  }\n  return true\n}\n\n/**\n * Handles page click events on SPF links, adds pushState history entries for\n * them, and navigates.\n *\n * @param {Event} evt The click event.\n * @private\n */\nspfNav.handleClick_ = function (evt) {\n  spfDebug.debug('nav.handleClick ', 'evt=', evt)\n  // Allow other click handlers to cancel navigation.\n  if (evt.defaultPrevented) {\n    return\n  }\n  var url = spfNav.getEventURL_(evt)\n  // Ignore clicks without a URL.\n  if (!url) {\n    return\n  }\n  url = spfUrl.appendPersistentParameters(url)\n  // Ignore clicks if the URL is not allowed (e.g. cross-domain).\n  if (!spfNav.isAllowed_(url)) {\n    return\n  }\n  // Ignore clicks if the URL is not eligible (e.g. limit reached).\n  if (!spfNav.isEligible_(url)) {\n    return\n  }\n  // Ignore clicks if the \"click\" event is canceled.\n  if (!spfNav.dispatchClick_(url, evt.target)) {\n    return\n  }\n\n  // Navigate to the URL.\n  var options = spfNav.createOptions_()\n  var info = new spfNav.Info()\n  spfNav.navigate_(url, options, info)\n  // Prevent the default browser navigation to avoid reloads.\n  evt.preventDefault()\n}\n\n/**\n * Handles page mousedown events on SPF links and prefetches them if possible.\n *\n * @param {Event} evt The mousedown event.\n * @private\n */\nspfNav.handleMouseDown_ = function (evt) {\n  spfDebug.debug('nav.handleMouseDown ', 'evt=', evt)\n  var url = spfNav.getEventURL_(evt)\n  // Ignore clicks without a URL.\n  if (!url) {\n    return\n  }\n  // Allow other mousedown handlers to run before issuing a prefetch request.\n  setTimeout(function () {\n    spfNav.prefetch(/** @type {string} */(url))\n  }, 0)\n}\n\n/**\n * Handles page scroll events to ensure history entry changes do not\n * prematurally scroll the page before content is updated.\n *\n * @param {Event} evt The scroll event.\n * @private\n */\nspfNav.handleScroll_ = function (evt) {\n  var position = spfNav.getScrollTempPosition_()\n  spfNav.clearScrollTempPosition_()\n  if (position) {\n    spfDebug.debug('    returning to saved scroll temp position', position)\n    window.scroll.apply(null, position)\n  }\n}\n\n/**\n * Handles when the active history entry changes.\n *\n * @param {string} url The URL the user is browsing to.\n * @param {Object=} opt_state An optional state object associated with the URL.\n * @private\n */\nspfNav.handleHistory_ = function (url, opt_state) {\n  spfDebug.debug('nav.handleHistory ', '(url=', url, 'state=', opt_state, ')')\n  var info = new spfNav.Info({\n    current: opt_state && opt_state['spf-current'],\n    history: true,\n    position: opt_state && opt_state['spf-position'],\n    referer: opt_state && opt_state['spf-referer'],\n    reverse: !!(opt_state && opt_state['spf-back'])\n  })\n  // If the reload-identifier is present, remove it to prevent confusing data.\n  var reloadId = /** @type {?string} */ (spfConfig.get('reload-identifier'))\n  if (reloadId) {\n    url = spfUrl.removeParameters(url, [reloadId])\n  }\n  // Reload if the URL is not allowed (e.g. cross-domain).\n  if (!spfNav.isAllowed_(url)) {\n    spfNav.reload(url, spfNav.ReloadReason.FORBIDDEN)\n    return\n  }\n  // Reload if the URL is not eligible (e.g. limit reached).\n  if (!spfNav.isEligible_(url)) {\n    spfNav.reload(url, spfNav.ReloadReason.INELIGIBLE)\n    return\n  }\n  // Ignore the change if the \"history\" event is canceled.\n  if (!spfNav.dispatchHistory_(url, info.referer, info.current)) {\n    return\n  }\n  // If navigating for this history change and a scroll position is set, ensure\n  // the browser doesn't scroll too early.  The browser default behavior is to\n  // scroll to the position when pushState was called just after a popState\n  // event is fired.  This is okay only if using history to move around a single\n  // page or if all content can be rendered synchronously during the popState\n  // event handling.  Since navigation content updates have at least one\n  // asynchronous break, avoid this by saving the current page position and\n  // scrolling immediately back to it when the browser scrolls early.\n  // The proper position will be set once content is updated.\n  if (info.position) {\n    spfNav.setScrollTempPosition_()\n  }\n  // Navigate to the URL.\n  // NOTE: The persistent parameters are not appended here because they should\n  // already be set on the URL if necessary.\n  var options = spfNav.createOptions_()\n  spfNav.navigate_(url, options, info)\n}\n\n/**\n * Navigates to a URL.\n *\n * A pushState history entry is added for the URL, and if successful, the\n * navigation is performed.  If not, the browser is reloaded to the URL.\n * During the navigation, first the content is requested.  If the reponse is\n * sucessfully parsed, it is processed.  If not, the browser is reloaded to\n * the URL.  Only a single navigation request can be in flight at once.  If a\n * second URL is navigated to while a first is still pending, the first will be\n * cancelled.\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @param {spfBase.RequestOptions=} opt_options Optional request options object.\n */\nspfNav.navigate = function (url, opt_options) {\n  spfDebug.debug('nav.navigate ', '(url=', url, 'options=', opt_options, ')')\n  // Ignore navigation to an empty URL.\n  if (!url) {\n    return\n  }\n  url = spfUrl.appendPersistentParameters(url)\n  // Reload if the URL is not allowed (e.g. cross-domain).\n  if (!spfNav.isAllowed_(url)) {\n    spfNav.reload(url, spfNav.ReloadReason.FORBIDDEN)\n    return\n  }\n  // Reload if the URL is not eligible (e.g. limit reached).\n  if (!spfNav.isEligible_(url)) {\n    spfNav.reload(url, spfNav.ReloadReason.INELIGIBLE)\n    return\n  }\n  // Navigate to the URL.\n  var options = spfNav.createOptions_(opt_options)\n  var info = new spfNav.Info()\n  spfNav.navigate_(url, options, info)\n}\n\n/**\n * Performs navigation to a URL.\n * See {@link #navigate}, {@link #handleClick}, and {@link #handleHistory}.\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @private.\n */\nspfNav.navigate_ = function (url, options, info) {\n  spfDebug.info('nav.navigate_ ', url, options, info)\n\n  // Abort previous navigation, if needed.\n  spfNav.cancel()\n\n  // If the URL is not navigable, attempt to scroll to support hash navigation.\n  if (!spfNav.isNavigable_(url, info.current)) {\n    spfDebug.debug('non-navigable, just scroll')\n    // Add a history entry beforehand to save current position, if needed.\n    if (!info.history) {\n      var handleError = spfBase.bind(spfNav.handleNavigateError_, null,\n                                 options)\n      spfNav.navigateAddHistory_(url, info.referer, handleError)\n    }\n    // Then attempt to scroll.\n    spfNav.navigateScroll_(url, info)\n    return\n  }\n\n  // Reload if the \"request\" event is canceled.\n  if (!spfNav.dispatchRequest_(url, info.referer, info.current, options)) {\n    spfNav.reload(url, spfNav.ReloadReason.REQUEST_CANCELED)\n    return\n  }\n\n  // Set the navigation counter.\n  var count = (parseInt(spfState.get(spfState.Key.NAV_COUNTER), 10) || 0) + 1\n  spfState.set(spfState.Key.NAV_COUNTER, count)\n\n  // Abort all ongoing prefetch requests, except for the navigation one if it\n  // exists.  This will reduce network contention for the navigation request\n  // by eliminating concurrent reqeuests that will not be used.\n  spfNav.cancelAllPrefetchesExcept(url)\n  // Cancel all preprocessing being done for completed single or ongoing\n  // multipart prefetch response, except for the navigation one if it exists.\n  // If the navigation one is a completed single response, the task will be\n  // canceled in spfNav.navigatePromotePrefetch_.  If it is an ongoing\n  // multipart response, allow it to continue processing until the completed.\n  var absoluteUrl = spfUrl.absolute(url)\n  var preprocessKey = spfNav.preprocessKey(absoluteUrl)\n  spfTasks.cancelAllExcept('preprocess', preprocessKey)\n\n  // Set the current nav request to be the prefetch, if it exists.\n  var prefetches = spfNav.prefetches_()\n  var prefetchXhr = prefetches[absoluteUrl]\n  spfState.set(spfState.Key.NAV_REQUEST, prefetchXhr)\n  // Make sure there is no current nav promotion set.\n  spfState.set(spfState.Key.NAV_PROMOTE, null)\n  spfState.set(spfState.Key.NAV_PROMOTE_TIME, null)\n\n  // Check the prefetch XHR.  If it is not done, promote the prefetch\n  // to navigate.  Otherwise, navigate immediately.\n  if (prefetchXhr && prefetchXhr.readyState != 4) {\n    // Begin the prefetch promotion process.\n    spfNav.navigatePromotePrefetch_(url, options, info)\n  } else {\n    spfNav.navigateSendRequest_(url, options, info)\n  }\n}\n\n/**\n * Promotes a prefetch request to a navigation after it completes.\n * See {@link navigate}.\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @private\n */\nspfNav.navigatePromotePrefetch_ = function (url, options, info) {\n  spfDebug.debug('nav.navigatePromotePrefetch_ ', url)\n  var preprocessKey = spfNav.preprocessKey(url)\n  var promoteKey = spfNav.promoteKey(url)\n  spfState.set(spfState.Key.NAV_PROMOTE, url)\n  spfState.set(spfState.Key.NAV_PROMOTE_TIME, spfBase.now())\n  spfTasks.cancel(preprocessKey)\n  spfTasks.run(promoteKey, true)\n\n  // After starting the promote tasks, check for new navigation that needs\n  // a history entry added.\n  if (!info.history) {\n    var handleError = spfBase.bind(spfNav.handleNavigateError_, null,\n                               options)\n    spfNav.navigateAddHistory_(url, info.referer, handleError)\n  }\n}\n\n/**\n * Send the navigation request.\n * See {@link navigate}.\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @private\n */\nspfNav.navigateSendRequest_ = function (url, options, info) {\n  var handleError = spfBase.bind(spfNav.handleNavigateError_, null,\n                             options)\n  var handlePart = spfBase.bind(spfNav.handleNavigatePart_, null,\n                            options, info)\n  var handleSuccess = spfBase.bind(spfNav.handleNavigateSuccess_, null,\n                               options, info)\n\n  // Before sending a new navigation request, clear previous resource timings\n  // to avoid (1) hitting buffer size limits or (2) accidentally getting timings\n  // for a previous request in Chrome, where the API is asynchronous and the\n  // latest values will not be available immediately.\n  // Only do this for navigations to avoid removing unrelated resource timings\n  // during prefetch or load calls.\n  // As an advanced option, allow timings to persist if desired.\n  if (!spfConfig.get('advanced-navigate-persist-timing')) {\n    spfNav.clearResourceTimings_()\n  }\n\n  info.type = 'navigate'\n  if (info.history) {\n    info.type += info.reverse ? '-back' : '-forward'\n  }\n\n  var xhr = spfNavRequest.send(url, {\n    method: options['method'],\n    headers: options['headers'],\n    onPart: handlePart,\n    onError: handleError,\n    onSuccess: handleSuccess,\n    postData: options['postData'],\n    type: info.type,\n    current: info.current,\n    referer: info.referer\n  })\n  spfState.set(spfState.Key.NAV_REQUEST, xhr)\n\n  // After the request has been sent, check for new navigation that needs\n  // a history entry added.  Do this after sending the XHR to have the\n  // correct referer for regular navigation (but not history navigation).\n  if (!info.history) {\n    spfNav.navigateAddHistory_(url, info.referer, handleError)\n  }\n}\n\n/**\n * Scrolls to a target specified by a URL hash, a position specified in the\n * navigation info object, or the top of the page if the window has not yet\n * been scrolled as part of this navigation.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNav.Info} info The navigation info object.\n * @private\n */\nspfNav.navigateScroll_ = function (url, info) {\n  // If a position is defined, scroll to it.\n  if (info.position) {\n    spfDebug.debug('    clearing scroll temp position')\n    spfNav.clearScrollTempPosition_()\n    spfDebug.debug('    scrolling to position', info.position)\n    window.scroll.apply(null, info.position)\n    info.scrolled = true\n    return\n  }\n  var result = spfString.partition(url, '#')\n  // If a non-empty hash is found, attempt to scroll the element into view.\n  // Otherwise, scroll to the top of the page.\n  if (result[2]) {\n    var el = document.getElementById(result[2])\n    if (el) {\n      spfDebug.debug('    clearing scroll temp position')\n      spfNav.clearScrollTempPosition_()\n      spfDebug.debug('    scrolling into view', result[2])\n      el.scrollIntoView()\n      info.scrolled = true\n    }\n  } else if (!info.scrolled) {\n    spfDebug.debug('    clearing scroll temp position')\n    spfNav.clearScrollTempPosition_()\n    spfDebug.debug('    scrolling to top')\n    window.scroll(0, 0)\n    info.scrolled = true\n  }\n}\n\n/**\n * Add the navigate state to the history.\n *\n * @param {string} url The URL to navigate to, without the SPF identifier.\n * @param {string} referer The Referrer URL, without the SPF identifier.\n * @param {function(string, Error)} handleError The error handler.\n * @private\n */\nspfNav.navigateAddHistory_ = function (url, referer, handleError) {\n  try {\n    // Before adding the new history entry, update the existing one with the\n    // current scroll position (and timestamp, always done automatically).\n    var position = [window.pageXOffset, window.pageYOffset]\n    var updateState = {'spf-position': position}\n    spfDebug.debug('    updating history to scroll position', position)\n    spfHistory.replace(null, updateState)\n    // Add the new history entry, unless the URL is the same as the current.\n    // (This can happen when clicking a hash-based target multiple times.)\n    if (spfUrl.absolute(url, true) != window.location.href) {\n      var newState = {'spf-referer': referer}\n      spfHistory.add(url, newState)\n    }\n  } catch (err) {\n    // Abort the navigation.\n    spfNav.cancel()\n    // An error is thrown if the state object is too large or if the\n    // URL is not in the same domain.\n    spfDebug.error('error caught, redirecting ',\n                    '(url=', url, 'err=', err, ')')\n    handleError(url, err)\n  }\n}\n\n/**\n * Handles a navigation error.\n * See {@link navigate}.\n *\n * @param {spfBase.RequestOptions} options Request options object.\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {Error} err The Error object.\n * @param {XMLHttpRequest=} opt_xhr The XMLHttpRequest for current error\n * @private\n */\nspfNav.handleNavigateError_ = function (options, url, err, opt_xhr) {\n  spfDebug.warn('navigate error', '(url=', url, ')')\n  spfState.set(spfState.Key.NAV_REQUEST, null)\n  // Ignore the error if the \"error\" event is canceled, but otherwise,\n  // reload the page.\n  if (!spfNav.dispatchError_(url, err, options, undefined, opt_xhr)) {\n    return\n  }\n  spfNav.reload(url, spfNav.ReloadReason.ERROR, err)\n}\n\n/**\n * Handles a navigation partial response.\n * See {@link navigate}.\n *\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse} partial The partial response object.\n * @private\n */\nspfNav.handleNavigatePart_ = function (options, info, url, partial) {\n  // Reload if the \"part process\" event is canceled.\n  if (!spfNav.dispatchPartProcess_(url, partial, options)) {\n    spfNav.reload(url, spfNav.ReloadReason.PART_PROCESS_CANCELED)\n    return\n  }\n\n  // Check for reload responses.\n  if (partial['reload']) {\n    spfNav.reload(url, spfNav.ReloadReason.RESPONSE_RECEIVED)\n    return\n  }\n\n  // Check for redirect responses.\n  if (partial['redirect']) {\n    spfNav.handleNavigateRedirect_(options, partial['redirect'])\n    return\n  }\n\n  try {\n    spfNavResponse.process(url, partial, info, function () {\n      spfNav.dispatchPartDone_(url, partial, options)\n    })\n  } catch (err) {\n    // If an exception is caught during processing, log, execute the error\n    // handler, and bail.\n    spfDebug.debug('    failed to process part', partial)\n    spfNav.handleNavigateError_(options, url, err)\n  }\n}\n\n/**\n * Handles a navigation complete response.\n * See {@link navigate}.\n *\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The response\n *     object, either a complete single or multipart response object.\n * @private\n */\nspfNav.handleNavigateSuccess_ = function (options, info, url, response) {\n  spfState.set(spfState.Key.NAV_REQUEST, null)\n\n  // If this is a navigation from a promotion, manually set the\n  // navigation start time.\n  if (spfState.get(spfState.Key.NAV_PROMOTE) == info.original) {\n    var timing = response['timing'] || {}\n    timing['navigationStart'] = spfState.get(spfState.Key.NAV_PROMOTE_TIME)\n    timing['spfPrefetched'] = true\n  }\n\n  // If a multipart response was received, all processing is already done,\n  // so don't fire the \"process\" event/callbacks.\n  var multipart = response['type'] == 'multipart'\n  if (!multipart) {\n    // Reload if the \"process\" event is canceled.\n    if (!spfNav.dispatchProcess_(url, response, options)) {\n      spfNav.reload(url, spfNav.ReloadReason.PROCESS_CANCELED)\n      return\n    }\n\n    // Check for reload responses.\n    if (response['reload']) {\n      spfNav.reload(url, spfNav.ReloadReason.RESPONSE_RECEIVED)\n      return\n    }\n\n    // Check for redirect responses.\n    if (response['redirect']) {\n      spfNav.handleNavigateRedirect_(options, response['redirect'])\n      return\n    }\n  }\n\n  // Process the requested response.\n  try {\n    // If a multipart response was received, all processing is already done,\n    // so an empty object is used to ensure events/callbacks are properly\n    // queued after existing ones from any ongoing part prcoessing.\n    var r = /** @type {spfBase.SingleResponse} */ (multipart ? {} : response)\n    spfNavResponse.process(url, r, info, function () {\n      // After processing is complete, save the name for future use.\n      var name = response['name'] || ''\n      if (multipart) {\n        var parts = response['parts']\n        spfArray.each(parts, function (part) {\n          name = part['name'] || name\n        })\n      }\n      spfDomDataset.set(document.body, 'spfName', name)\n      // If this navigation was from history, attempt to scroll to the previous\n      // position after all processing is complete.  This should not be done\n      // earlier because the prevous position might rely on page width/height\n      // that is changed during the processing.\n      // Fallback to scrolling to the top if neither a hash target nor a\n      // history position exists and the window was not previously scrolled\n      // during response processing.\n      spfNav.navigateScroll_(url, info)\n      spfNav.dispatchDone_(url, response, options)\n    })\n  } catch (err) {\n    // If an exception is caught during processing, log, execute the error\n    // handler and bail.\n    spfDebug.debug('    failed to process response', response)\n    spfNav.handleNavigateError_(options, url, err)\n  }\n}\n\n/**\n * Handles a redirect responses on navigation requests.\n *\n * @param {spfBase.RequestOptions} options Request options object.\n * @param {string} redirectUrl The new URL to be redirected to.\n * @private\n */\nspfNav.handleNavigateRedirect_ = function (options, redirectUrl) {\n  //\n  // TODO(nicksay): Figure out navigate callbacks + redirects.\n  //\n  // Replace the current history entry with the redirect,\n  // executing the callback to trigger the next navigation.\n  try {\n    // Persist the url hash to mirror browser redirects.\n    redirectUrl = redirectUrl + window.location.hash\n    spfHistory.replace(redirectUrl, null, true)\n  } catch (err) {\n    spfNav.cancel()\n    spfDebug.error('error caught, reloading ',\n                    '(url=', redirectUrl, 'err=', err, ')')\n    spfNav.handleNavigateError_(options, redirectUrl, err)\n  }\n}\n\n/**\n * Cancels the current navigation request, if any.\n */\nspfNav.cancel = function () {\n  var xhr = /** @type {XMLHttpRequest} */ (\n      spfState.get(spfState.Key.NAV_REQUEST))\n  if (xhr) {\n    spfDebug.warn('aborting previous navigate ',\n                   'xhr=', xhr)\n    xhr.abort()\n    spfState.set(spfState.Key.NAV_REQUEST, null)\n  }\n}\n\n/**\n * Executes an external callback and checks whether the callback was canceled\n * with an explicit return value of `false`.\n *\n * @param {Function|undefined} fn Callback function to be executed.\n * @param {...*} var_args Arguments to apply to the function.\n * @return {boolean} False if the callback was canceled by explicitly returning\n *     false to stop the operation; true otherwise.\n */\nspfNav.callback = function (fn, var_args) {\n  var val\n  if (fn) {\n    var args = Array.prototype.slice.call(arguments)\n    args[0] = fn\n    val = spfBase.execute.apply(null, args)\n    if (val instanceof Error) {\n      spfDebug.error('error in callback (url=', window.location.href,\n                      'err=', val, ')')\n    }\n  }\n  return (val !== false)\n}\n\n/**\n * Reloads the page with a URL, to be used when navigation fails or is disabled.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNav.ReloadReason} reason The reason code causing the reload.\n * @param {Error=} opt_err An optional error object used in the dispatched\n *    reason.\n */\nspfNav.reload = function (url, reason, opt_err) {\n  var err = opt_err ? opt_err.message : ''\n  spfDebug.warn('reloading (', 'url=', url, 'reason=', reason,\n                 'error=', err, ')')\n  spfNav.cancel()\n  spfNav.cancelAllPrefetchesExcept()\n  // Dispatch the reload event to notify the app that a reload is required.\n  var logReason = reason\n  if (err) {\n    logReason += ' Message: ' + err\n  }\n  spfNav.dispatchReload_(url, logReason)\n  var current = window.location.href\n  // If the url has already changed, clear its entry to prevent browser\n  // inconsistency with history management for 301 responses on reloads. Chrome\n  // will identify that the starting url was the same, and replace the current\n  // history state, whereas Firefox will set a new state with the post 301\n  // value.\n  if (spfConfig.get('experimental-remove-history') && current == url) {\n    spfHistory.removeCurrentEntry()\n  }\n  // Delay the reload until after the history state has had time to clear.\n  setTimeout(function () {\n    var reloadId = /** @type {?string} */ (spfConfig.get('reload-identifier'))\n    if (reloadId) {\n      var params = {}\n      params[reloadId] = encodeURIComponent(reason)\n      url = spfUrl.appendParameters(url, params)\n    }\n    window.location.href = url\n    // If the new url only differs by a hash then just assigning to\n    // `location.href` is not enough to trigger a reload.  If this is the case,\n    // explicitly calling `location.reload()` is required, but it can't be done\n    // every time because an immediate call to `location.reload()` will cancel\n    // the navgation started by the assignment to `location.href`.  The\n    // `isNavigable_` function checks for hash-based navgiation that won't\n    // trigger, so use it here to determine whether to call `location.reload()`.\n    if (!spfNav.isNavigable_(url, current)) {\n      window.location.reload()\n    }\n  }, 0)\n}\n\n/**\n * Loads a URL.\n *\n * Similar to {@link spfNav.navigate}, but intended for traditional content\n * updates, not page navigation.  Not subject to restrictions on the number of\n * simultaneous requests.\n *\n * @param {string} url The URL to load, without the SPF identifier.\n * @param {spfBase.RequestOptions=} opt_options Optional request options object.\n */\nspfNav.load = function (url, opt_options) {\n  url = spfUrl.appendPersistentParameters(url)\n  var options = spfNav.createOptions_(opt_options)\n  var info = new spfNav.Info()\n  spfNav.load_(url, options, info)\n}\n\n/**\n * Loads a URL.\n * See {@link #load}.\n *\n * @param {string} url The URL to load, without the SPF identifier.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @private\n */\nspfNav.load_ = function (url, options, info) {\n  spfDebug.info('nav.load ', url, options, info)\n\n  info.original = info.original || url\n\n  // Abort the load if the \"request\" callback is canceled.\n  // Note: pass \"true\" to only execute callbacks and not dispatch events.\n  if (!spfNav.dispatchRequest_(url, undefined, undefined, options, true)) {\n    return\n  }\n\n  var handleError = spfBase.bind(spfNav.handleLoadError_, null,\n                             false, options, info)\n  var handlePart = spfBase.bind(spfNav.handleLoadPart_, null,\n                            false, options, info)\n  var handleSuccess = spfBase.bind(spfNav.handleLoadSuccess_, null,\n                               false, options, info)\n\n  info.type = 'load'\n\n  spfNavRequest.send(url, {\n    method: options['method'],\n    headers: options['headers'],\n    onPart: handlePart,\n    onError: handleError,\n    onSuccess: handleSuccess,\n    postData: options['postData'],\n    type: info.type,\n    withCredentials: options['withCredentials']\n  })\n}\n\n/**\n * Prefetches a URL.\n *\n * Use to prime the SPF request cache with the content and the browser cache\n * with script and stylesheet URLs.  If the response is successfully parsed, it\n * is preprocessed to prefetch scripts and stylesheets as well.\n *\n * @param {string} url The URL to prefetch, without the SPF identifier.\n * @param {spfBase.RequestOptions=} opt_options Optional request options object.\n */\nspfNav.prefetch = function (url, opt_options) {\n  url = spfUrl.appendPersistentParameters(url)\n  var options = spfNav.createOptions_(opt_options)\n  var info = new spfNav.Info()\n  spfNav.prefetch_(url, options, info)\n}\n\n/**\n * Prefetches a URL.\n * See {@link #prefetch}.\n *\n * @param {string} url The URL to prefetch, without the SPF identifier.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @private\n */\nspfNav.prefetch_ = function (url, options, info) {\n  spfDebug.info('nav.prefetch ', url, options, info)\n  info.original = info.original || url\n\n  // Abort the prefetch if the \"request\" callback is canceled.\n  // Note: pass \"true\" to only execute callbacks and not dispatch events.\n  if (!spfNav.dispatchRequest_(url, undefined, undefined, options, true)) {\n    return\n  }\n\n  var handleError = spfBase.bind(spfNav.handleLoadError_, null,\n                             true, options, info)\n  var handlePart = spfBase.bind(spfNav.handleLoadPart_, null,\n                            true, options, info)\n  var handleSuccess = spfBase.bind(spfNav.handleLoadSuccess_, null,\n                               true, options, info)\n\n  info.type = 'prefetch'\n\n  var xhr = spfNavRequest.send(url, {\n    method: options['method'],\n    headers: options['headers'],\n    onPart: handlePart,\n    onError: handleError,\n    onSuccess: handleSuccess,\n    postData: options['postData'],\n    type: info.type,\n    current: info.current\n  })\n  spfNav.addPrefetch(url, xhr)\n}\n\n/**\n * Handles a load or prefetch error.\n * See {@link load} and {@link prefetch}.\n *\n * @param {boolean} isPrefetch True for prefetch; false for load.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {Error} err The Error object.\n * @private\n */\nspfNav.handleLoadError_ = function (isPrefetch, options, info, url, err) {\n  spfDebug.warn(isPrefetch ? 'prefetch' : 'load', 'error', '(url=', url, ')')\n\n  if (isPrefetch) {\n    spfNav.removePrefetch(url)\n  }\n\n  // If a prefetch has been promoted to a navigate, use the navigate error\n  // handler.  Otherwise, execute the \"error\" callback.\n  if (isPrefetch && spfState.get(spfState.Key.NAV_PROMOTE) == info.original) {\n    spfNav.handleNavigateError_(options, url, err)\n  } else {\n    // Note: pass \"true\" to only execute callbacks and not dispatch events.\n    spfNav.dispatchError_(url, err, options, true)\n  }\n}\n\n/**\n * Handles a load or prefetch partial response.\n * See {@link load} and {@link prefetch}.\n *\n * @param {boolean} isPrefetch True for prefetch; false for load.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse} partial The partial response object.\n * @private\n */\nspfNav.handleLoadPart_ = function (isPrefetch, options, info, url, partial) {\n  // Abort the load/prefetch if the \"part process\" callback is canceled.\n  // Note: pass \"true\" to only execute callbacks and not dispatch events.\n  if (!spfNav.dispatchPartProcess_(url, partial, options, true)) {\n    return\n  }\n\n  // Check for reload responses.\n  // For a load, abort; for a promoted prefetch, reload immediately; for a\n  // prefetch, ignore and the reload will be processed when a navigate occurs.\n  if (partial['reload']) {\n    if (!isPrefetch) {\n      return\n    }\n    if (spfState.get(spfState.Key.NAV_PROMOTE) == info.original) {\n      spfNav.reload(url, spfNav.ReloadReason.RESPONSE_RECEIVED)\n      return\n    }\n  }\n\n  // Check for redirect responses.\n  if (partial['redirect']) {\n    spfNav.handleLoadRedirect_(isPrefetch, options, info, partial['redirect'])\n    return\n  }\n\n  if (isPrefetch) {\n    // Add the navigate part function as a task to be invoked on\n    // prefetch promotion.\n    // TODO(nicksay): Honor history/reverse/position during promotion in\n    // reponse to a popState. (This is an edge case.)\n    var fn = spfBase.bind(spfNav.handleNavigatePart_, null,\n                      options, info, url, partial)\n    var promoteKey = spfNav.promoteKey(info.original)\n    spfTasks.add(promoteKey, fn)\n    // If the prefetch has been promoted, run the promotion task after\n    // adding it and do not perform any preprocessing.\n    if (spfState.get(spfState.Key.NAV_PROMOTE) == info.original) {\n      spfTasks.run(promoteKey, true)\n      return\n    }\n  }\n\n  var processFn = isPrefetch\n      ? spfNavResponse.preprocess\n      : spfNavResponse.process\n  processFn(url, partial, info, function () {\n    // Note: pass \"true\" to only execute callbacks and not dispatch events.\n    spfNav.dispatchPartDone_(url, partial, options, true)\n  })\n}\n\n/**\n * Handles a load or prefetch complete response.\n * See {@link load} and {@link prefetch}.\n *\n * @param {boolean} isPrefetch True for prefetch; false for load.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The response\n *     object, either a complete single or multipart response object.\n * @private\n */\nspfNav.handleLoadSuccess_ = function (isPrefetch, options, info, url,\n                                      response) {\n  // If a multipart response was received, all processing is already done,\n  // so don't execute the \"process\" callback.\n  var multipart = response['type'] == 'multipart'\n  if (!multipart) {\n    // Abort the load/prefetch if the \"process\" callback is canceled.\n    // Note: pass \"true\" to only execute callbacks and not dispatch events.\n    if (!spfNav.dispatchProcess_(url, response, options, true)) {\n      spfNav.reload(url, spfNav.ReloadReason.PROCESS_CANCELED)\n      return\n    }\n\n    // Check for reload responses.\n    // For a load, abort; for a promoted prefetch, reload immediately; for a\n    // prefetch, ignore and the reload will be processed when a navigate occurs.\n    if (response['reload']) {\n      if (!isPrefetch) {\n        return\n      }\n      if (spfState.get(spfState.Key.NAV_PROMOTE) == info.original) {\n        spfNav.reload(url, spfNav.ReloadReason.RESPONSE_RECEIVED)\n        return\n      }\n    }\n\n    // Check for redirect responses.\n    if (response['redirect']) {\n      spfNav.handleLoadRedirect_(isPrefetch, options, info,\n                                  response['redirect'])\n      return\n    }\n  }\n\n  var promoteKey = spfNav.promoteKey(info.original)\n  if (isPrefetch) {\n    // Remove the prefetch xhr from the set of currently active\n    // prefetches upon successful prefetch.\n    spfNav.removePrefetch(url)\n    // If the prefetch has been promoted, run the promotion task after\n    // adding it and do not perform any preprocessing. If it has not\n    // been promoted, remove the task queues becuase a subsequent\n    // request will hit the cache.\n    if (spfState.get(spfState.Key.NAV_PROMOTE) == info.original) {\n      // TODO(nicksay): Honor history/reverse/position during promotion in\n      // reponse to a popState. (This is an edge case.)\n      var fn = spfBase.bind(spfNav.handleNavigateSuccess_, null,\n                        options, info, url, response)\n      spfTasks.add(promoteKey, fn)\n      spfTasks.run(promoteKey, true)\n      return\n    } else {\n      spfTasks.cancel(promoteKey)\n    }\n  }\n\n  // Process the requested response.\n  var processFn = isPrefetch\n      ? spfNavResponse.preprocess\n      : spfNavResponse.process\n  try {\n    // If a multipart response was received, all processing is already done,\n    // so an empty object is used to ensure the callback is properly\n    // queued after existing ones from any ongoing part prcoessing.\n    var r = /** @type {spfBase.SingleResponse} */ (multipart ? {} : response)\n    processFn(url, r, info, function () {\n      // Note: pass \"true\" to only execute callbacks and not dispatch events.\n      spfNav.dispatchDone_(url, response, options, true)\n    })\n  } catch (err) {\n    // If an exception is caught during processing, log, execute the error\n    // handler and bail.\n    spfDebug.debug('    failed to process response', response)\n    spfNav.handleLoadError_(isPrefetch, options, info, url, err)\n  }\n}\n\n/**\n * Handles a redirect response on load requests.\n *\n * @param {boolean} isPrefetch True for prefetch; false for load.\n * @param {spfBase.RequestOptions} options The request options object.\n * @param {spfNav.Info} info The navigation info object.\n * @param {string} redirectUrl The new URL to be redirected to.\n * @private\n */\nspfNav.handleLoadRedirect_ = function (isPrefetch, options, info, redirectUrl) {\n  var redirectFn = isPrefetch ? spfNav.prefetch_ : spfNav.load_\n  // Note that POST is not propagated with redirects.\n  // Only copy callback keys to into a new object to enforce this.\n  var keys = [\n    spfNav.Callback.ERROR,\n    spfNav.Callback.REQUEST,\n    spfNav.Callback.PART_PROCESS,\n    spfNav.Callback.PART_DONE,\n    spfNav.Callback.PROCESS,\n    spfNav.Callback.DONE\n  ]\n  var redirectOpts = /** @type {spfBase.RequestOptions} */ ({})\n  spfArray.each(keys, function (key) {\n    redirectOpts[key] = options[key]\n  })\n  redirectFn(redirectUrl, redirectOpts, info)\n}\n\n/**\n * Process a SPF response on the current page outside of a navigation flow.\n *\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The SPF response\n *     object to process.\n * @param {function((spfBase.SingleResponse|spfBase.MultipartResponse))=} opt_callback\n *     Function to execute when processing is done; the argument is\n *     the `response`.\n */\nspfNav.process = function (response, opt_callback) {\n  var url = window.location.href\n  var multipart = response['type'] == 'multipart'\n  var done = function (index, max, _, resp) {\n    if (index == max && opt_callback) {\n      opt_callback(resp)\n    }\n  }\n  if (multipart) {\n    var parts = response['parts']\n    var max = parts.length - 1\n    spfArray.each(parts, function (part, index) {\n      var fn = spfBase.bind(done, null, index, max)\n      spfNavResponse.process(url, part, null, fn)\n    })\n  } else {\n    response = /** @type {spfBase.SingleResponse} */ (response)\n    var fn = spfBase.bind(done, null, 0, 0)\n    spfNavResponse.process(url, response, null, fn)\n  }\n}\n\n/**\n * Dispatches the \"error\" event with the following custom event detail:\n *   url: The current URL.\n *   err: The Error object.\n *\n * If a local \"onError\" callback is provided, it is executed first with the\n * same detail object.  If the callback is canceled, the event is not fired.\n *\n * @param {string} url The history URL.\n * @param {Error} err The Error object.\n * @param {?spfBase.RequestOptions=} opt_options Optional request options object.\n * @param {boolean=} opt_noEvents Whether to skip the event and only execute the\n *     callback; for use with load and prefetch requests.\n * @param {XMLHttpRequest=} opt_xhr The XMLHttpRequest for current error\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchError_ = function (url, err, opt_options, opt_noEvents,\n                                  opt_xhr) {\n  var detail = {'url': url, 'err': err, 'xhr': opt_xhr}\n  var options = opt_options || /** @type {spfBase.RequestOptions} */ ({})\n  var fn = options[spfNav.Callback.ERROR]\n  var proceed = spfNav.callback(fn, detail)\n  if (proceed && !opt_noEvents) {\n    proceed = spfBase.dispatch(spfBase.EventName.ERROR, detail)\n  }\n  return proceed\n}\n\n/**\n * Dispatches the \"reload\" event with the following custom event detail:\n *   url: The current URL.\n *   reason: The reason code and text explaining the reload.\n *\n * @param {string} url The target URL which is being reloaded.\n * @param {string} reason The reason code causing the reload.\n * @private\n */\nspfNav.dispatchReload_ = function (url, reason) {\n  var detail = {'url': url, 'reason': reason}\n  spfBase.dispatch(spfBase.EventName.RELOAD, detail)\n}\n\n/**\n * Dispatches the \"click\" event with the following custom event detail:\n *   url: The click URL, without the SPF identifier.\n *   target: The click target.\n *\n * @param {string} url The click URL, without the SPF identifier.\n * @param {EventTarget} target The click target.\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchClick_ = function (url, target) {\n  var detail = {'url': url, 'target': target}\n  return spfBase.dispatch(spfBase.EventName.CLICK, detail)\n}\n\n/**\n * Dispatches the \"history\" event with the following custom event detail:\n *   url: The click URL, without the SPF identifier.\n *   referer: The referring page URL, without the SPF identifier.\n *   previous: The previously visible page URL, without the SPF identifier.\n *\n * @param {string} url The click URL, without the SPF identifier.\n * @param {string=} opt_referer The referer URL.\n * @param {string=} opt_previous The previously visible URL.\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchHistory_ = function (url, opt_referer, opt_previous) {\n  var detail = {'url': url, 'referer': opt_referer, 'previous': opt_previous}\n  return spfBase.dispatch(spfBase.EventName.HISTORY, detail)\n}\n\n/**\n * Dispatches the \"request\" event with the follow custom event detail:\n *   url: The URL to request, without the SPF identifier.\n *   referer: The referring page URL, without the SPF identifier.\n *   previous: The previously visible page URL, without the SPF identifier.\n *\n * If a local \"onRequest\" callback is provided, it is executed first with the\n * same detail object.  If the callback is canceled, the event is not fired.\n *\n * @param {string} url The URL to request, without the SPF identifier.\n * @param {string|undefined} referer The referer URL.\n * @param {string|undefined} previous The previously visible URL.\n * @param {?spfBase.RequestOptions=} opt_options Optional request options object.\n * @param {boolean=} opt_noEvents Whether to skip the event and only execute the\n *     callback; for use with load and prefetch requests.\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchRequest_ = function (url, referer, previous, opt_options,\n                                    opt_noEvents) {\n  var detail = {'url': url, 'referer': referer, 'previous': previous}\n  var options = opt_options || /** @type {spfBase.RequestOptions} */ ({})\n  var fn = options[spfNav.Callback.REQUEST]\n  var proceed = spfNav.callback(fn, detail)\n  if (proceed && !opt_noEvents) {\n    proceed = spfBase.dispatch(spfBase.EventName.REQUEST, detail)\n  }\n  return proceed\n}\n\n/**\n * Dispatches the \"part process\" event with the follow custom event detail:\n *   url: The requested URL, without the SPF identifier.\n *   part: The partial response object, a part of a multipart response.\n *\n * If a local \"onPartProcess\" callback is provided, it is executed first with\n * the same detail object.  If the callback is canceled, the event is not fired.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse} partial The partial response object,\n *     part of a multipart response object.\n * @param {?spfBase.RequestOptions=} opt_options Optional request options object.\n * @param {boolean=} opt_noEvents Whether to skip the event and only execute the\n *     callback; for use with load and prefetch requests.\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchPartProcess_ = function (url, partial, opt_options,\n                                        opt_noEvents) {\n  var detail = {'url': url, 'part': partial}\n  var options = opt_options || /** @type {spfBase.RequestOptions} */ ({})\n  var fn = options[spfNav.Callback.PART_PROCESS]\n  var proceed = spfNav.callback(fn, detail)\n  if (proceed && !opt_noEvents) {\n    proceed = spfBase.dispatch(spfBase.EventName.PART_PROCESS, detail)\n  }\n  return proceed\n}\n\n/**\n * Dispatches the \"part done\" event with the follow custom event detail:\n *   url: The requested URL, without the SPF identifier.\n *   part: The partial response object, a part of a multipart response.\n *\n * If a local \"onPartDone\" callback is provided, it is executed first with the\n * same detail object.  If the callback is canceled, the event is not fired.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse} partial The partial response object,\n *     part of a multipart response object.\n * @param {?spfBase.RequestOptions=} opt_options Optional request options object.\n * @param {boolean=} opt_noEvents Whether to skip the event and only execute the\n *     callback; for use with load and prefetch requests.\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchPartDone_ = function (url, partial, opt_options, opt_noEvents) {\n  var detail = {'url': url, 'part': partial}\n  var options = opt_options || /** @type {spfBase.RequestOptions} */ ({})\n  var fn = options[spfNav.Callback.PART_DONE]\n  var proceed = spfNav.callback(fn, detail)\n  if (proceed && !opt_noEvents) {\n    proceed = spfBase.dispatch(spfBase.EventName.PART_DONE, detail)\n  }\n  return proceed\n}\n\n/**\n * Dispatches the \"process\" event with the follow custom event detail:\n *   url: The requested URL, without the SPF identifier.\n *   response: The response object, either a single or multipart response.\n *\n * If a local \"onProcess\" callback is provided, it is executed first with the\n * same detail object.  If the callback is canceled, the event is not fired.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The response\n *     object, either a complete single or multipart response object.\n * @param {?spfBase.RequestOptions=} opt_options Optional request options object.\n * @param {boolean=} opt_noEvents Whether to skip the event and only execute the\n *     callback; for use with load and prefetch requests.\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchProcess_ = function (url, response, opt_options, opt_noEvents) {\n  var detail = {'url': url, 'response': response}\n  var options = opt_options || /** @type {spfBase.RequestOptions} */ ({})\n  var fn = options[spfNav.Callback.PROCESS]\n  var proceed = spfNav.callback(fn, detail)\n  if (proceed && !opt_noEvents) {\n    proceed = spfBase.dispatch(spfBase.EventName.PROCESS, detail)\n  }\n  return proceed\n}\n\n/**\n * Dispatches the \"done\" event with the follow custom event detail:\n *   url: The requested URL, without the SPF identifier.\n *   response: The response object, either a single or multipart response.\n *\n * If a local \"onDone\" callback is provided, it is executed first with the\n * same detail object.  If the callback is canceled, the event is not fired.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The response\n *     object, either a complete single or multipart response object.\n * @param {?spfBase.RequestOptions=} opt_options Optional request options object.\n * @param {boolean=} opt_noEvents Whether to skip the event and only execute the\n *     callback; for use with load and prefetch requests.\n * @return {boolean} False if the event was canceled.\n * @private\n */\nspfNav.dispatchDone_ = function (url, response, opt_options, opt_noEvents) {\n  var detail = {'url': url, 'response': response}\n  var options = opt_options || /** @type {spfBase.RequestOptions} */ ({})\n  var fn = options[spfNav.Callback.DONE]\n  var proceed = spfNav.callback(fn, detail)\n  if (proceed && !opt_noEvents) {\n    proceed = spfBase.dispatch(spfBase.EventName.DONE, detail)\n  }\n  return proceed\n}\n\n/**\n * Generate the promote key given a url.\n *\n * @param {string} url The url of the request.\n * @return {string} The promote key.\n */\nspfNav.promoteKey = function (url) {\n  return 'promote ' + spfUrl.absolute(url)\n}\n\n/**\n * Generate the preprocess key given a url.\n *\n * @param {string} url The url of the request.\n * @return {string} The preprocess key.\n */\nspfNav.preprocessKey = function (url) {\n  return 'preprocess ' + spfUrl.absolute(url)\n}\n\n/**\n * Add a prefetch request to the set of ongoing prefetches.\n *\n * @param {string} url The url of the prefetch request.\n * @param {XMLHttpRequest} xhr The prefetch request object.\n */\nspfNav.addPrefetch = function (url, xhr) {\n  spfDebug.debug('nav.addPrefetch ', url, xhr)\n  var absoluteUrl = spfUrl.absolute(url)\n  var prefetches = spfNav.prefetches_()\n  prefetches[absoluteUrl] = xhr\n}\n\n/**\n * Cancels a single prefetch request and removes it from the set.\n *\n * @param {string} url The url of the prefetch to be aborted.\n */\nspfNav.removePrefetch = function (url) {\n  spfDebug.debug('nav.removePrefetch ', url)\n  var absoluteUrl = spfUrl.absolute(url)\n  var prefetches = spfNav.prefetches_()\n  var prefetchXhr = prefetches[absoluteUrl]\n  if (prefetchXhr) {\n    prefetchXhr.abort()\n  }\n  delete prefetches[absoluteUrl]\n}\n\n/**\n * Cancels all ongoing prefetch requests, optionally skipping the given url.\n *\n * @param {string=} opt_skipUrl A url of the request that should not\n *     be canceled.\n */\nspfNav.cancelAllPrefetchesExcept = function (opt_skipUrl) {\n  spfDebug.debug('nav.cancelAllPrefetchesExcept', opt_skipUrl)\n  var prefetches = spfNav.prefetches_()\n  var absoluteUrl = opt_skipUrl && spfUrl.absolute(opt_skipUrl)\n  for (var key in prefetches) {\n    if (absoluteUrl != key) {\n      spfNav.removePrefetch(key)\n    }\n  }\n}\n\n/**\n * Clears all resource timings for the page.\n *\n * @private\n */\nspfNav.clearResourceTimings_ = (function () {\n  var clearResourceTimings = window.performance && (\n      window.performance.clearResourceTimings ||\n      window.performance['webkitClearResourceTimings'] ||\n      window.performance['mozClearResourceTimings'] ||\n      window.performance['msClearResourceTimings'] ||\n      window.performance['oClearResourceTimings'])\n  if (clearResourceTimings) {\n    return spfBase.bind(clearResourceTimings, window.performance)\n  }\n  return spfBase.nullFunction\n})()\n\n/**\n * @param {!Object.<string, XMLHttpRequest>=} opt_reqs\n *     Optional set of requests to overwrite the current value.\n * @return {!Object.<string, XMLHttpRequest>} Current map\n *     of requests.\n * @private\n */\nspfNav.prefetches_ = function (opt_reqs) {\n  if (opt_reqs || !spfState.has(spfState.Key.NAV_PREFETCHES)) {\n    return /** @type {!Object.<string, XMLHttpRequest>} */ (\n        spfState.set(spfState.Key.NAV_PREFETCHES, (opt_reqs || {})))\n  }\n  return /** @type {!Object.<string, XMLHttpRequest>} */ (\n      spfState.get(spfState.Key.NAV_PREFETCHES))\n}\n\n/**\n * @return {Array.<number>} The saved scroll position.\n * @private\n */\nspfNav.getScrollTempPosition_ = function () {\n  var position = /** @type {?Array.<number>} */ (\n      spfState.get(spfState.Key.NAV_SCROLL_TEMP_POSITION)) || null\n  var url = /** @type {?string} */ (\n      spfState.get(spfState.Key.NAV_SCROLL_TEMP_URL)) || ''\n  if (position && url == window.location.href) {\n    return position\n  }\n  return null\n}\n\n/**\n * @private\n */\nspfNav.setScrollTempPosition_ = function () {\n  var position = [window.pageXOffset, window.pageYOffset]\n  spfDebug.debug('    saving scroll temp position', position)\n  spfState.set(spfState.Key.NAV_SCROLL_TEMP_POSITION, position)\n  spfState.set(spfState.Key.NAV_SCROLL_TEMP_URL, window.location.href)\n}\n\n/**\n * @private\n */\nspfNav.clearScrollTempPosition_ = function () {\n  spfState.set(spfState.Key.NAV_SCROLL_TEMP_POSITION, null)\n  spfState.set(spfState.Key.NAV_SCROLL_TEMP_URL, null)\n}\n\n/**\n * Detects touch-capable platforms.\n *\n * @return {boolean} True if this is a touch capable platform.\n * @private\n */\nspfNav.isTouchCapablePlatform_ = function () {\n  return ('ontouchstart' in window || window.navigator['maxTouchPoints'] > 0 ||\n      window.navigator['msMaxTouchPoints'] > 0)\n}\n\n/**\n * @param {spfBase.RequestOptions=} opt_options The request options object.\n * @return {spfBase.RequestOptions}\n * @private\n */\nspfNav.createOptions_ = function (opt_options) {\n  var options = opt_options || /** @type {spfBase.RequestOptions} */ ({})\n  return options\n}\n\n/**\n * Type definition for an object literal argument to {@link spfNav.Info}.\n *\n * @typedef {{\n *   current: (string|undefined),\n *   history: (boolean|undefined),\n *   original: (string|undefined),\n *   position: (Array.<number>|undefined),\n *   referer: (string|undefined),\n *   reverse: (boolean|undefined),\n *   scrolled: (boolean|undefined),\n *   type: (string|undefined)\n * }}\n * @private\n */\nspfNav.Info_\n\n/**\n * Data to track information about an SPF navigation.\n *\n * @param {(spfNav.Info|spfNav.Info_)=} opt_info A navigation info object.\n * @constructor\n * @struct\n */\nspfNav.Info = function (opt_info) {\n  opt_info = opt_info || /** @type {spfNav.Info_} */ ({})\n  /**\n   * The current page URL. This differs from `referer` in that is always\n   * represents the current visible page regardless of history state.\n   * @type {string}\n   */\n  // The current URL will have already changed for history events, so for this\n  // case, the opt_info.current value from the history state should be used.\n  this.current = (opt_info.history && opt_info.current)\n                     ? opt_info.current : window.location.href\n  /**\n   * Whether this navigation is part of a history change. True when navigation\n   * is in response to a popState event.\n   * @type {boolean}\n   */\n  this.history = !!opt_info.history\n  /**\n   * The original request URL. This may differ than the regular URL for\n   * redirect responses.\n   * @type {string}\n   */\n  this.original = opt_info.original || ''\n  /**\n   * The window position to scroll to during navigation, in [x, y] format.\n   * Should be defined when navigation is in response to a popState event and a\n   * value exists in the history state object.\n   * @type {Array.<number>}\n   */\n  this.position = opt_info.position || null\n  /**\n   * The referring page URL.\n   * @type {string}\n   */\n  // The referer is stored in the history entry state object to allow the\n  // correct value to be sent to the server during back/forward.\n  // Compare against \"undefined\" to allow empty referer values in history.\n  this.referer = (opt_info.referer != undefined)\n                     ? opt_info.referer : window.location.href\n  /**\n   * Whether this navigation is going \"backwards\". True when navigation\n   * is in response to a popState event and the \"back\" button is clicked.\n   * @type {boolean}\n   */\n  this.reverse = !!opt_info.reverse\n  /**\n   * Whether the window has been scrolled to `position` or to the top during\n   * this navigation request.\n   * @type {boolean}\n   */\n  this.scrolled = !!opt_info.scrolled\n  /**\n   * The type of request, one of the following: \"navigate\", \"navigate-back\",\n   * \"navigate-forward\", \"load\", \"prefetch\".  If not yet determined (i.e. before\n   * the request is sent), it will be an empty string.\n   * @type {string}\n   */\n  this.type = opt_info.type || ''\n}\n\n/**\n * @enum {string}\n */\nspfNav.Callback = {\n  ERROR: 'onError',\n  REQUEST: 'onRequest',\n  PART_PROCESS: 'onPartProcess',\n  PART_DONE: 'onPartDone',\n  PROCESS: 'onProcess',\n  DONE: 'onDone'\n}\n\n/**\n * @enum {string}\n */\nspfNav.ReloadReason = {\n  INELIGIBLE: (!SPF_DEBUG) ? '1'\n      : '1: Navigation not initialized or limit reached.',\n  REQUEST_CANCELED: (!SPF_DEBUG) ? '2'\n      : '2: Navigation canceled by the request event.',\n  PART_PROCESS_CANCELED: (!SPF_DEBUG) ? '3'\n      : '3: Navigation canceled by the partprocess event.',\n  PROCESS_CANCELED: (!SPF_DEBUG) ? '4'\n      : '4: Navigation canceled by the process event.',\n  RESPONSE_RECEIVED: (!SPF_DEBUG) ? '5'\n      : '5: Reload response received.',\n  FORBIDDEN: (!SPF_DEBUG) ? '9'\n      : '9: Destination forbidden by same-origin security.',\n  ERROR: (!SPF_DEBUG) ? '10'\n      : '10: An uncaught error occurred processing.'\n}\n\nexport default spfNav\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/nav/nav.js","// Copyright 2013 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Navigation-related response functions.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport {spfBase} from '../base'\nimport spfState from '../state'\nimport spfArray from '../array/array'\nimport spfConfig from '../config'\nimport spfDebug from '../debug/debug'\nimport spfDom from '../dom/dom'\nimport spfDomClasslist from '../dom/classlist'\nimport spfDomDataset from '../dom/dataset'\nimport spfHistory from '../history/history'\nimport spfNetConnect from '../net/connect'\nimport spfNetScript from '../net/script'\nimport spfNetStyle from '../net/style'\nimport spfString from '../string/string'\nimport spfTasks from '../tasks/tasks'\nimport spfUrl from '../url/url'\n\nlet spfNavResponse = {}\n// goog.provide('spfNavResponse');\n\n/**\n * Parses text for an SPF response.  If `opt_multipart` is true, attempts\n * to parse the text for one or more (in)complete multipart SPF responses.\n *\n * @param {string} text Text to parse.\n * @param {boolean=} opt_multipart Whether to attempt to parse the text for\n *     one or more multipart SPF response sections.\n * @param {boolean=} opt_lastDitch Whether to parse the text as the final\n *     one, potentially handling malformed but valid responses.  Requires\n *     `opt_multipart` to be true.\n * @throws {Error} If the `text` contains invalid JSON, or when\n *     `opt_multipart` is true, if a section of a multipart response\n *     contains invalid JSON.\n * @return {{parts: Array.<spfBase.SingleResponse>, extra: string}}\n */\nspfNavResponse.parse = function (text, opt_multipart, opt_lastDitch) {\n  if (opt_multipart) {\n    var beginToken = spfNavResponse.Token.BEGIN\n    var delimToken = spfNavResponse.Token.DELIMITER\n    var endToken = spfNavResponse.Token.END\n    var lastDitchHalfToken = '\\r\\n'\n    var parts = []\n    var chunk\n    var start = 0\n    // With a last-ditch effort, append the token CRLF chars to the text, which\n    // might allow parsing the final section of a response that ends with a\n    // closing bracket but not the CRLF required of a well-formed END token.\n    // As a side-effect, this will also successfully parse a response section\n    // that ends with a comma (because the CRLF will create a well-formed\n    // DELIMITER token).  If the last character is not a comma or closing\n    // bracket, this last-ditch effort will have no effect.\n    if (opt_lastDitch) {\n      text += lastDitchHalfToken\n    }\n    var finish = text.indexOf(beginToken, start)\n    if (finish > -1) {\n      start = finish + beginToken.length\n    }\n    while ((finish = text.indexOf(delimToken, start)) > -1) {\n      chunk = spfString.trim(text.substring(start, finish))\n      start = finish + delimToken.length\n      if (chunk) {\n        parts.push(JSON.parse(chunk))\n      }\n    }\n    finish = text.indexOf(endToken, start)\n    if (finish > -1) {\n      chunk = spfString.trim(text.substring(start, finish))\n      start = finish + endToken.length\n      if (chunk) {\n        parts.push(JSON.parse(chunk))\n      }\n    }\n    var extra = ''\n    if (text.length > start) {\n      extra = text.substring(start)\n      if (opt_lastDitch && spfString.endsWith(extra, lastDitchHalfToken)) {\n        extra = extra.substring(0, extra.length - lastDitchHalfToken.length)\n      }\n    }\n    parts = spfNavResponse.extract(parts)\n    return {\n      parts: /** @type {Array.<spfBase.SingleResponse>} */(parts),\n      extra: extra\n    }\n  } else {\n    var response = JSON.parse(text)\n    var parts = spfNavResponse.extract(spfArray.toArray(response))\n    return {\n      parts: /** @type {Array.<spfBase.SingleResponse>} */(parts),\n      extra: ''\n    }\n  }\n}\n\n/**\n * Processes a SPF response.\n *\n * @param {string} url The URL of the response being processed.\n * @param {spfBase.SingleResponse} response The SPF response object to process.\n * @param {spfBase.nav.Info=} opt_info The navigation info object.\n * @param {function(string, spfBase.SingleResponse)=} opt_callback Function to\n *     execute when processing is done; the first argument is `url`,\n *     the second argument is `response`.\n */\nspfNavResponse.process = function (url, response, opt_info, opt_callback) {\n  spfDebug.info('nav.response.process ', response, opt_info)\n\n  var isNavigate = opt_info && spfString.startsWith(opt_info.type, 'navigate')\n  var isReverse = opt_info && opt_info.reverse\n  var hasPosition = opt_info && !!opt_info.position\n  var hasScrolled = opt_info && opt_info.scrolled\n\n  var name = response['name'] || ''\n\n  // Convert the URL to absolute, to be used for finding the task queue.\n  var key = 'process ' + spfUrl.absolute(url)\n  var sync = !spfConfig.get('experimental-process-async')\n\n  // NOTE: when adding tasks to a queue, use bind to avoid name/scope errors.\n  var fn\n  var num = 0\n\n  // Initialize the timing object if needed.\n  if (!response['timing']) {\n    response['timing'] = {}\n  }\n\n  // Update title (immediate).\n  if (response['title']) {\n    document.title = response['title']\n  }\n\n  // Add the new history state (immediate), if needed.\n  // Only navigation requests should process URL changes.\n  if (isNavigate && response['url']) {\n    var fullUrl = spfUrl.absolute(response['url'])\n    // Update the history state if the url doesn't match.\n    if (fullUrl != spfNavResponse.getCurrentUrl_()) {\n      spfDebug.debug('  update history with response url')\n      // Add the URL to the history stack, including hash.\n      spfHistory.replace(response['url'] + window.location.hash)\n    }\n  }\n\n  // Install head scripts and styles (single task), if needed.\n  if (response['head']) {\n    fn = spfBase.bind(function (head, timing) {\n      // Extract scripts and styles from the fragment.\n      var extracted = spfNavResponse.extract_(head)\n      // Install links.\n      spfNavResponse.installLinks_(extracted)\n      // Install styles.\n      spfNavResponse.installStyles_(extracted)\n      spfDebug.debug('    head css')\n      // Install scripts.\n      // Suspend main queue to allow JS execution to occur sequentially.\n      // TODO(nicksay): Consider using a sub-queue for JS execution.\n      spfTasks.suspend(key)\n      spfNavResponse.installScripts_(extracted, function () {\n        timing['spfProcessHead'] = spfBase.now()\n        spfDebug.debug('    head js')\n        // Resume main queue after JS.\n        spfTasks.resume(key, sync)\n        spfDebug.debug('  process task done: head')\n      })\n    }, null, response['head'], response['timing'])\n    num = spfTasks.add(key, fn)\n    spfDebug.debug('  process task queued: head', num)\n  }\n\n  // Update attributes (single task), if needed.\n  if (response['attr']) {\n    fn = spfBase.bind(function (attrs, timing) {\n      for (var id in attrs) {\n        var el = document.getElementById(id)\n        if (el) {\n          spfDom.setAttributes(el, attrs[id])\n          spfDebug.debug('    attr set', id)\n        }\n      }\n      timing['spfProcessAttr'] = spfBase.now()\n      spfDebug.debug('  process task done: attr')\n    }, null, response['attr'], response['timing'])\n    num = spfTasks.add(key, fn)\n    spfDebug.debug('  process task queued: attr', num)\n  }\n\n  // Update content (one task per fragment or three tasks if animated).\n  var fragments = response['body'] || {}\n  var numBeforeFragments = num\n  for (var id in fragments) {\n    fn = spfBase.bind(function (id, body, timing) {\n      var el = document.getElementById(id)\n      if (el) {\n        // Scroll to the top before the first content update, if needed.\n        // Only non-history navigation requests scroll to the top immediately.\n        // Other history navigation requests handle scrolling after all\n        // processing is done to avoid jumping to the top and back down to the\n        // saved position afterwards.\n        if (isNavigate && !hasPosition && !hasScrolled) {\n          spfState.set(spfState.Key.NAV_SCROLL_TEMP_POSITION, null)\n          spfState.set(spfState.Key.NAV_SCROLL_TEMP_URL, null)\n          spfDebug.debug('    scrolling to top')\n          window.scroll(0, 0)\n          hasScrolled = true\n          if (opt_info) {\n            opt_info.scrolled = true\n          }\n        }\n        // Extract scripts and styles from the fragment.\n        var extracted = spfNavResponse.extract_(body)\n        // Install styles.\n        spfNavResponse.installStyles_(extracted)\n        // Set up scripts to be installed after the html is updated.\n        var installScripts = function () {\n          // Install scripts.\n          // Suspend main queue to allow JS execution to occur sequentially.\n          // TODO(nicksay): Consider using a sub-queue for JS execution.\n          spfTasks.suspend(key)\n          spfNavResponse.installScripts_(extracted, function () {\n            // Resume main queue after JS.\n            spfTasks.resume(key, sync)\n            spfDebug.debug('  process task done: body', id)\n          })\n        }\n\n        var animationClass = /** @type {string} */ (\n            spfConfig.get('animation-class'))\n        var noAnimation = (!spfNavResponse.CAN_ANIMATE_ ||\n                           !spfDomClasslist.contains(el, animationClass))\n        if (noAnimation) {\n          var htmlHandler = /** @type {Function} */(\n              spfConfig.get('experimental-html-handler'))\n          if (htmlHandler) {\n            // Suspend main queue for the experimental HTML handler.\n            spfTasks.suspend(key)\n            htmlHandler(extracted['html'], el, function () {\n              installScripts()\n              // Resume main queue after the experimental HTML handler.\n              spfTasks.resume(key, sync)\n            })\n          } else {\n            el.innerHTML = extracted['html']\n            installScripts()\n          }\n        } else {\n          var animation = new spfNavResponse.Animation_(\n              el,\n              extracted['html'],\n              animationClass,\n              name,\n              parseInt(spfConfig.get('animation-duration'), 10),\n              !!isReverse)\n          // Suspend main queue while the animation is running.\n          spfTasks.suspend(key)\n          // Finish a previous animation on this sub-queue, if needed.\n          spfTasks.run(animation.key, true)\n          // Animation task 1: insert new, delay = 0.\n          spfTasks.add(\n              animation.key,\n              spfBase.bind(spfNavResponse.prepareAnimation_, null, animation),\n              0)\n          spfDebug.debug('  process queued prepare animation', id)\n          // Animation task 2: switch, delay = 17ms = 1 frame @ 60fps.\n          spfTasks.add(\n              animation.key,\n              spfBase.bind(spfNavResponse.runAnimation_, null, animation),\n              17)\n          spfDebug.debug('  process queued run animation', id)\n          // Animation task 3: remove old, delay = config.\n          spfTasks.add(\n              animation.key,\n              spfBase.bind(spfNavResponse.completeAnimation_, null, animation),\n              animation.duration)\n          spfDebug.debug('  process queued complete animation', id)\n          // Resume main queue after animation is done.\n          spfTasks.add(\n              animation.key,\n              spfBase.bind(function () {\n                installScripts()\n                spfTasks.resume(key, sync)\n              }, null),\n              0)\n          spfTasks.run(animation.key)\n        }\n      }\n    }, null, id, fragments[id], response['timing'])\n    num = spfTasks.add(key, fn)\n    spfDebug.debug('  process task queued: body', id, num)\n  }\n  var numAfterFragments = num\n  var numFragments = numAfterFragments - numBeforeFragments\n\n  // Install foot scripts and styles (single task), if needed.\n  if (response['foot']) {\n    fn = spfBase.bind(function (foot, timing, numFragments) {\n      // Use the page scripts task as a signal that the content is updated,\n      // only recording the content completion time if fragments were processed.\n      if (numFragments) {\n        timing['spfProcessBody'] = spfBase.now()\n      }\n      // Extract scripts and styles from the fragment.\n      var extracted = spfNavResponse.extract_(foot)\n      // Install styles.\n      spfNavResponse.installStyles_(extracted)\n      spfDebug.debug('    foot css')\n      // Install scripts.\n      // Suspend main queue to allow JS execution to occur sequentially.\n      // TODO(nicksay): Consider using a sub-queue for JS execution.\n      spfTasks.suspend(key)\n      spfNavResponse.installScripts_(extracted, function () {\n        timing['spfProcessFoot'] = spfBase.now()\n        spfDebug.debug('    foot js')\n        spfTasks.resume(key, sync)  // Resume main queue after JS.\n        spfDebug.debug('  process task done: foot')\n      })\n    }, null, response['foot'], response['timing'],\n        numFragments)\n    num = spfTasks.add(key, fn)\n    spfDebug.debug('  process task queued: foot', num)\n  } else if (numFragments) {\n    // If a page scripts task is unnecessary and fragments were processed,\n    // add a task to record the completion time.  Doing this only if page\n    // scripts won't be installed prevents unnecessary task execution and\n    // potential delays.\n    fn = spfBase.bind(function (timing) {\n      timing['spfProcessBody'] = spfBase.now()\n      spfDebug.debug('  process task done: timing-for-body')\n    }, null, response['timing'])\n    num = spfTasks.add(key, fn)\n    spfDebug.debug('  process task queued: timing-for-body', num)\n  }\n\n  // Execute callback.\n  if (opt_callback) {\n    num = spfTasks.add(key, spfBase.bind(opt_callback, null, url, response))\n    spfDebug.debug('  process task queued: callback', num)\n  }\n\n  spfDebug.debug('  process run', key, sync)\n  spfTasks.run(key, sync)\n}\n\n/**\n * Preprocesses a SPF response.\n\n * Similar to {@link #process} but instead of page content being updated,\n * script and stylesheet URLs are prefetched.\n *\n * @param {string} url The URL of the response being preprocessed.\n * @param {spfBase.SingleResponse} response The SPF response object to preprocess.\n * @param {spfBase.nav.Info=} opt_info The navigation info object.\n * @param {function(string, spfBase.SingleResponse)=} opt_callback Function to\n *     execute when preprocessing is done; the first argument is `url`,\n *     the second argument is `response`.\n */\nspfNavResponse.preprocess = function (url, response, opt_info, opt_callback) {\n  spfDebug.info('nav.response.preprocess ', response)\n  // Convert the URL to absolute, to be used for finding the task queue.\n  var key = 'preprocess ' + spfUrl.absolute(url)\n\n  // NOTE: when adding tasks to a queue, use bind to avoid name/scope errors.\n  var fn\n\n  // Preinstall page styles (single task), if needed.\n  if (response['head']) {\n    fn = spfBase.bind(function (head) {\n      var extracted = spfNavResponse.extract_(head)\n      spfNavResponse.preinstallLinks_(extracted)\n      spfNavResponse.preinstallStyles_(extracted)\n      spfNavResponse.preinstallScripts_(extracted)\n      spfDebug.debug('  preprocess task done: head')\n    }, null, response['head'])\n    spfTasks.add(key, fn)\n    spfDebug.debug('  preprocess task queued: head')\n  }\n\n  // Preinstall fragment scripts and styles (one task per fragment).\n  var fragments = response['body'] || {}\n  for (var id in fragments) {\n    if (fragments[id]) {\n      fn = spfBase.bind(function (id, body) {\n        var extracted = spfNavResponse.extract_(body)\n        spfNavResponse.preinstallStyles_(extracted)\n        spfNavResponse.preinstallScripts_(extracted)\n        spfDebug.debug('    body js', id)\n        spfDebug.debug('  preprocess task done: body', id)\n      }, null, id, fragments[id])\n      spfTasks.add(key, fn)\n      spfDebug.debug('  preprocess task queued: body', id)\n    }\n  }\n\n  // Preinstall page scripts (single task).\n  if (response['foot']) {\n    fn = spfBase.bind(function (foot) {\n      var extracted = spfNavResponse.extract_(foot)\n      spfNavResponse.preinstallStyles_(extracted)\n      spfNavResponse.preinstallScripts_(extracted)\n      spfDebug.debug('  preprocess task done: foot')\n    }, null, response['foot'])\n    spfTasks.add(key, fn)\n    spfDebug.debug('  preprocess task queued: foot')\n  }\n\n  // Execute callback.\n  if (opt_callback) {\n    spfTasks.add(key, spfBase.bind(opt_callback, null, url, response))\n    spfDebug.debug('  preprocess task queued: callback')\n  }\n\n  // The preprocessing queue is always run async.\n  spfTasks.run(key)\n}\n\n/**\n * @param {spfNavResponse.Animation_} data The animation data.\n * @private\n */\nspfNavResponse.prepareAnimation_ = function (data) {\n  // Add the start class to put elements in their beginning states.\n  spfDomClasslist.add(data.element, data.dirClass)\n  spfDomClasslist.add(data.element, data.fromClass)\n  spfDomClasslist.add(data.element, data.toClass)\n  spfDomClasslist.add(data.element, data.startClass)\n  spfDomClasslist.add(data.element, data.startClassDeprecated)\n  // Pack the existing content into a temporary container.\n  data.oldEl = document.createElement('div')\n  data.oldEl.className = data.oldClass\n  spfDom.packElement(data.element, data.oldEl)\n  // Place the new content into a temporary container as a sibling.\n  data.newEl = document.createElement('div')\n  data.newEl.className = data.newClass\n  data.newEl.innerHTML = data.html\n  if (data.reverse) {\n    spfDom.insertSiblingBefore(data.newEl, data.oldEl)\n  } else {\n    spfDom.insertSiblingAfter(data.newEl, data.oldEl)\n  }\n  spfDebug.debug('  process done prepare animation', data.element.id)\n}\n\n/**\n * @param {spfNavResponse.Animation_} data The animation data.\n * @private\n */\nspfNavResponse.runAnimation_ = function (data) {\n  spfDomClasslist.remove(data.element, data.startClass)\n  spfDomClasslist.remove(data.element, data.startClassDeprecated)\n  spfDomClasslist.add(data.element, data.endClass)\n  spfDomClasslist.add(data.element, data.endClassDeprecated)\n  spfDebug.debug('  process done run animation', data.element.id)\n}\n\n/**\n * @param {spfNavResponse.Animation_} data The animation data.\n * @private\n */\nspfNavResponse.completeAnimation_ = function (data) {\n  // Remove the old content.\n  data.element.removeChild(data.oldEl)\n  // Unpack the new content from the temporary container.\n  spfDom.unpackElement(data.newEl)\n  // Remove the end class to put elements back in normal state.\n  spfDomClasslist.remove(data.element, data.endClass)\n  spfDomClasslist.remove(data.element, data.endClassDeprecated)\n  spfDomClasslist.remove(data.element, data.fromClass)\n  spfDomClasslist.remove(data.element, data.toClass)\n  spfDomClasslist.remove(data.element, data.dirClass)\n  spfDebug.debug('  process done complete animation', data.element.id)\n}\n\n/**\n * Extracts all resources from HTML in a SPF response.\n *\n * @param {T} response The SPF response object to extract.\n * @return {T} The response, updated to have resources extracted from HTML\n *     strings.  This does not create a new object and modifies the passed\n *     response in-place.\n * @template T\n */\nspfNavResponse.extract = function (response) {\n  spfDebug.debug('spfNavResponse.extract', response)\n  var parts = spfArray.toArray(response)\n  spfArray.each(parts, function (part) {\n    if (part) {\n      if (part['head']) {\n        part['head'] = spfNavResponse.extract_(part['head'])\n      }\n      if (part['body']) {\n        for (var id in part['body']) {\n          part['body'][id] = spfNavResponse.extract_(part['body'][id])\n        }\n      }\n      if (part['foot']) {\n        part['foot'] = spfNavResponse.extract_(part['foot'])\n      }\n    }\n  })\n  return response\n}\n\n/**\n * Extracts resources from an HTML string:\n *   - JS: <script> and <script src>\n *   - CSS: <style> and <link rel=stylesheet>\n *\n * @param {spfBase.ResponseFragment|spfNavResponse.Extraction_} frag The response\n *     fragment (either a HTML string to parse or a pre-parsed object), or a\n *     previous extraction result.\n * @return {!spfNavResponse.Extraction_}\n * @private\n */\nspfNavResponse.extract_ = function (frag) {\n  var result = new spfNavResponse.Extraction_()\n  if (!frag) {\n    return result\n  }\n\n  // If the fragment isn't a string, it's a pre-parsed object.  Use the\n  // provided values to populate the result instead.\n  if (!spfString.isString(frag)) {\n    // Add the parsed scripts to the result.\n    if (frag['scripts']) {\n      spfArray.each(frag['scripts'], function (script) {\n        result['scripts'].push({url: script['url'] || '',\n          text: script['text'] || '',\n          name: script['name'] || '',\n          async: script['async'] || false})\n      })\n    }\n    // Add the parsed styles to the result.\n    if (frag['styles']) {\n      spfArray.each(frag['styles'], function (style) {\n        result['styles'].push({url: style['url'] || '',\n          text: style['text'] || '',\n          name: style['name'] || ''})\n      })\n    }\n    // Add the parsed links to the result.\n    if (frag['links']) {\n      spfArray.each(frag['links'], function (link) {\n        if (link['rel'] == 'spf-preconnect') {\n          result['links'].push({url: link['url'] || '',\n            rel: link['rel'] || ''})\n        }\n      })\n    }\n    result['html'] = frag['html'] || ''\n    return result\n  }\n\n  // Re-assure the compiler that the fragment is a string at this point.\n  frag = /** @type {string} */ (frag)\n\n  // Parse scripts and styles and add them to the result.\n  frag = frag.replace(spfNavResponse.ElementRegEx.SCRIPT_STYLE,\n      function (full, tag, attr, text) {\n        // A script tag can be either an inline or external style.\n        // Parse the name, src, and async attributes.\n        if (tag == 'script') {\n          var name = attr.match(spfNavResponse.AttributeRegEx.NAME)\n          name = name ? name[1] : ''\n          var url = attr.match(spfNavResponse.AttributeRegEx.SRC)\n          url = url ? url[1] : ''\n          var async = spfNavResponse.AttributeRegEx.ASYNC.test(attr)\n          var type = spfNavResponse.AttributeRegEx.TYPE.exec(attr)\n          var inject = !type || spfString.contains(type[1], '/javascript') ||\n              spfString.contains(type[1], '/x-javascript') ||\n              spfString.contains(type[1], '/ecmascript')\n          if (inject) {\n            result['scripts'].push(\n                {url: url, text: text, name: name, async: async})\n            return ''\n          } else {\n            return full\n          }\n        }\n        // A style tag is an inline style.  Parse the name attribute.\n        if (tag == 'style') {\n          var name = attr.match(spfNavResponse.AttributeRegEx.NAME)\n          name = name ? name[1] : ''\n          var type = spfNavResponse.AttributeRegEx.TYPE.exec(attr)\n          var inject = !type || spfString.contains(type[1], 'text/css')\n          if (inject) {\n            result['styles'].push({url: '', text: text, name: name})\n            return ''\n          } else {\n            return full\n          }\n        }\n        // An unexpected tag was matched.  Do nothing.\n        return full\n      })\n\n  // Parse links and add them to the result.\n  frag = frag.replace(spfNavResponse.ElementRegEx.LINK,\n      function (full, attr) {\n        var rel = attr.match(spfNavResponse.AttributeRegEx.REL)\n        rel = rel ? rel[1] : ''\n        // A rel=stylesheet tag is an external style.\n        // Parse the name and href attributes.\n        if (rel == 'stylesheet') {\n          var name = attr.match(spfNavResponse.AttributeRegEx.NAME)\n          name = name ? name[1] : ''\n          var url = attr.match(spfNavResponse.AttributeRegEx.HREF)\n          url = url ? url[1] : ''\n          result['styles'].push({url: url, text: '', name: name})\n          return ''\n        }\n        // A rel=spf-preconnect tag indicates early connection.\n        // Parse the href attribute.\n        if (rel == 'spf-preconnect') {\n          var url = attr.match(spfNavResponse.AttributeRegEx.HREF)\n          url = url ? url[1] : ''\n          result['links'].push({url: url, rel: rel})\n          return ''\n        }\n        // An unknown link was matched.  Do nothing.\n        return full\n      })\n\n  // The result html is what's left after parsing.\n  result['html'] = frag\n\n  return result\n}\n\n/**\n * Installs scripts that have been extracted from an HTML string.\n * See {@link spfNetScript.load}, {@link spfNetScript.eval}, and\n * {@link #extract_}.\n *\n * @param {!spfNavResponse.Extraction_} result The extraction result.\n * @param {Function=} opt_callback Callback function to execute after\n *     all scripts are loaded.\n * @private\n */\nspfNavResponse.installScripts_ = function (result, opt_callback) {\n  if (result['scripts'].length <= 0) {\n    opt_callback && opt_callback()\n    return\n  }\n  // Load or evaluate the scripts in order or asynchronously.\n  var index = -1\n  var next = function () {\n    index++\n    if (index < result['scripts'].length) {\n      var item = result['scripts'][index]\n      var fn = function () {}\n      if (item.url) {\n        if (item.name) {\n          fn = spfBase.bind(spfNetScript.load, null, item.url, item.name)\n        } else {\n          fn = spfBase.bind(spfNetScript.get, null, item.url)\n        }\n      } else if (item.text) {\n        if (item.name) {\n          fn = spfBase.bind(spfNetScript.eval, null, item.text, item.name)\n        } else {\n          fn = spfBase.bind(spfNetScript.exec, null, item.text)\n        }\n      }\n      if (item.url && !item.async) {\n        fn(next)\n      } else {\n        fn()\n        next()\n      }\n    } else {\n      opt_callback && opt_callback()\n    }\n  }\n  next()\n}\n\n/**\n * Prefetches scripts that have been extracted from an HTML string.\n * See {@link spfNetScript.prefetch} and {@link #extract_}.\n *\n * @param {!spfNavResponse.Extraction_} result The extraction result.\n * @private\n */\nspfNavResponse.preinstallScripts_ = function (result) {\n  if (result['scripts'].length <= 0) {\n    return\n  }\n  // Prefetch the scripts.\n  var urls = spfArray.map(result['scripts'], function (item) {\n    return item.url\n  })\n  spfNetScript.prefetch(urls)\n}\n\n/**\n * Installs styles that have been extracted from an HTML string.\n * See {@link spfNetStyle.load}, {@link spfNetStyle.eval}, and\n * {@link #extract_}.\n *\n * @param {!spfNavResponse.Extraction_} result The extraction result.\n * @private\n */\nspfNavResponse.installStyles_ = function (result) {\n  if (result['styles'].length <= 0) {\n    return\n  }\n  // Install the styles.\n  spfArray.each(result['styles'], function (item) {\n    if (item.url) {\n      if (item.name) {\n        spfNetStyle.load(item.url, item.name)\n      } else {\n        spfNetStyle.get(item.url)\n      }\n    } else if (item.text) {\n      if (item.name) {\n        spfNetStyle.eval(item.text, item.name)\n      } else {\n        spfNetStyle.exec(item.text)\n      }\n    }\n  })\n}\n\n/**\n * Prefetches styles that have been extracted from an HTML string.\n * See {@link spfNetStyle.prefetch} and {@link #extract_}.\n *\n * @param {!spfNavResponse.Extraction_} result The extraction result.\n * @private\n */\nspfNavResponse.preinstallStyles_ = function (result) {\n  if (result['styles'].length <= 0) {\n    return\n  }\n  // Prefetch the styles.\n  var urls = spfArray.map(result['styles'], function (item) {\n    return item.url\n  })\n  spfNetStyle.prefetch(urls)\n}\n\n/**\n * Installs links (i.e. DNS) that have extracted from an HTML string.\n * See {@link spfNetConnect.preconnect} and {@link #extract_}.\n *\n * @param {!spfNavResponse.Extraction_} result The extraction result.\n * @private\n */\nspfNavResponse.installLinks_ = function (result) {\n  // Currently, only preconnect links are supported.\n  spfNavResponse.preinstallLinks_(result)\n}\n\n/**\n * Prefetches links (i.e. DNS) that have been extracted from an HTML string.\n * See {@link spfNetConnect.preconnect} and {@link #extract_}.\n *\n * @param {!spfNavResponse.Extraction_} result The extraction result.\n * @private\n */\nspfNavResponse.preinstallLinks_ = function (result) {\n  if (result['links'].length <= 0) {\n    return\n  }\n  // Preconnect.\n  var urls = spfArray.map(result['links'], function (item) {\n    return item.rel == 'spf-preconnect' ? item.url : ''\n  })\n  spfNetConnect.preconnect(urls)\n}\n\n/**\n * Provides the current (absolute) URL from the window.\n * @return {string} Get the current window's URL.\n * @private\n */\nspfNavResponse.getCurrentUrl_ = function () {\n  return spfUrl.absolute(window.location.href)\n}\n\n/**\n * A container for holding data during an animated content update.\n * See {@link #process}.\n *\n * @param {!Element} el The element being updated.\n * @param {string} html The new content for the element.\n * @param {string} cls The animation class name.\n * @param {string} name The page name.\n * @param {number} duration The animation duration.\n * @param {boolean} reverse Whether this is a \"back\" animation.\n * @constructor\n * @struct\n * @private\n */\nspfNavResponse.Animation_ = function (el, html, cls, name, duration, reverse) {\n  /** @type {!Element} */\n  this.element = el\n  /** @type {string} */\n  this.html = html\n  /** @type {number} */\n  this.duration = duration\n  /** @type {boolean} */\n  this.reverse = reverse\n\n  var prevName = spfDomDataset.get(document.body, 'spfName') || ''\n\n  /** @type {string} */\n  this.key = spfTasks.key(el)\n  /** @type {string} */\n  this.fromClass = prevName && (cls + '-from-' + prevName)\n  /** @type {string} */\n  this.toClass = name && (cls + '-to-' + name)\n  /** @type {Element} */\n  this.oldEl = null\n  /** @type {string} */\n  this.oldClass = cls + '-old'\n  /** @type {Element} */\n  this.newEl = null\n  /** @type {string} */\n  this.newClass = cls + '-new'\n  /** @type {string} */\n  this.dirClass = cls + (reverse ? '-reverse' : '-forward')\n  /** @type {string} */\n  this.startClass = cls + '-start'\n  /** @type {string} */\n  this.startClassDeprecated = this.dirClass + '-start'\n  /** @type {string} */\n  this.endClass = cls + '-end'\n  /** @type {string} */\n  this.endClassDeprecated = this.dirClass + '-end'\n}\n\n/**\n * A container for holding the results from parsing and extracting resources\n * from an HTML string.  See {@link #extract_}.\n *\n * Note: This container should be accessed as a dict (obj['foo']) not as a\n * struct (obj.foo) to ensure consistency when accessing parsed responses\n * cached by previous versions of SPF.\n *\n * @constructor\n * @dict\n * @private\n */\n// TODO(nicksay): Consider a shared interface for spfNavResponse.Extraction_\n// and spfBase.ResponseFragment.\nspfNavResponse.Extraction_ = function () {\n  /** @type {string} */\n  this['html'] = ''\n  /** @type {!Array.<{url:string, text:string, name:string, async:boolean}>} */\n  this['scripts'] = []\n  /** @type {!Array.<{url:string, text:string, name:string}>} */\n  this['styles'] = []\n  /** @type {!Array.<{url:string, rel:string}>} */\n  this['links'] = []\n}\n\n/**\n * Whether the browser supports animation via CSS Transitions.\n * @private {boolean}\n */\nspfNavResponse.CAN_ANIMATE_ = (function () {\n  var testEl = document.createElement('div')\n  if ('transition' in testEl.style) {\n    return true\n  }\n  var prefixes = ['webkit', 'Moz', 'Ms', 'O', 'Khtml']\n  return spfArray.some(prefixes, function (prefix) {\n    return prefix + 'Transition' in testEl.style\n  })\n})()\n\n/**\n * Regular expressions used to extract resource elements in HTML strings.\n *\n * @enum {RegExp}\n */\nspfNavResponse.ElementRegEx = {\n  LINK: /\\x3clink([\\s\\S]*?)\\x3e/ig,\n  SCRIPT_STYLE: /\\x3c(script|style)([\\s\\S]*?)\\x3e([\\s\\S]*?)\\x3c\\/\\1\\x3e/ig\n}\n\n/**\n * Regular expressions used to extract attributes in HTML strings.\n * @enum {RegExp}\n */\nspfNavResponse.AttributeRegEx = {\n  ASYNC: /(?:\\s|^)async(?:\\s|=|$)/i,\n  HREF: /(?:\\s|^)href\\s*=\\s*[\"']?([^\\s\"']+)/i,\n  NAME: /(?:\\s|^)name\\s*=\\s*[\"']?([^\\s\"']+)/i,\n  REL: /(?:\\s|^)rel\\s*=\\s*[\"']?([^\\s\"']+)/i,\n  SRC: /(?:\\s|^)src\\s*=\\s*[\"']?([^\\s\"']+)/i,\n  TYPE: /(?:\\s|^)type\\s*=\\s*[\"']([^\"']+)[\"']/i\n}\n\n/**\n * Tokens used when parsing multipart responses.\n * @enum {string}\n */\nspfNavResponse.Token = {\n  BEGIN: '[\\r\\n',\n  DELIMITER: ',\\r\\n',\n  END: ']\\r\\n'\n}\n\nexport default spfNavResponse\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/nav/response.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Simple publish/subscribe instance used as a \"dispatch\"\n * for centralized notifications.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport {spfBase, SPF_BOOTLOADER} from '../base'\nimport spfArray from '../array/array'\nimport spfState from '../state'\n\nlet spfPubsub = {}\n// goog.provide('spfPubsub');\n\n// goog.require('spf');\n// goog.require('spfArray');\n// goog.require('spfState');\n\n/**\n * Subscribes a function to a topic.  The function is invoked in the global\n * scope.  Subscribing the same function to the same topic multiple\n * times will result in multiple function invocations while publishing.\n *\n * @param {string} topic Topic to subscribe to. Passing an empty string does\n *     nothing.\n * @param {Function|undefined} fn Function to be invoked when a message is\n *     published to the given topic. Passing `null` or `undefined`\n *     does nothing.\n */\nspfPubsub.subscribe = function (topic, fn) {\n  if (topic && fn) {\n    if (!(topic in spfPubsub.subscriptions)) {\n      spfPubsub.subscriptions[topic] = []\n    }\n    spfPubsub.subscriptions[topic].push(fn)\n  }\n}\n\n/**\n * Unsubscribes a function from a topic. Only deletes the first match found.\n *\n * @param {string} topic Topic to unsubscribe from. Passing an empty string does\n *     nothing.\n * @param {Function|undefined} fn Function to unsubscribe. Passing `null`\n *     or `undefined` does nothing.\n */\nspfPubsub.unsubscribe = function (topic, fn) {\n  if (topic in spfPubsub.subscriptions && fn) {\n    spfArray.every(spfPubsub.subscriptions[topic], function (subFn, i, arr) {\n      if (subFn == fn) {\n        arr[i] = null\n        return false\n      }\n      return true\n    })\n  }\n}\n\n/**\n * Publishes a topic.  Calls functions subscribed to the topic in\n * the order in which they were added.  If any of the functions throws an\n * uncaught error, publishing is aborted.\n *\n * @param {string} topic Topic to publish. Passing an empty string does\n *     nothing.\n */\nspfPubsub.publish = function (topic) {\n  spfPubsub.publish_(topic)\n}\n\n/**\n * Simulaneously publishes and clears a topic.  Calls functions subscribed to\n * topic in the order in which they were added, unsubscribing each beforehand.\n * If any of the functions throws an uncaught error, publishing is aborted.\n * See {#publish} and {#clear}.\n *\n * @param {string} topic Topic to publish. Passing an empty string does\n *     nothing.\n */\nspfPubsub.flush = function (topic) {\n  spfPubsub.publish_(topic, true)\n}\n\n/**\n * See {@link #publish} or {@link #flush}.\n *\n * @param {string} topic Topic to publish.\n * @param {boolean=} opt_unsub Whether to unsubscribe functions beforehand.\n * @private\n */\nspfPubsub.publish_ = function (topic, opt_unsub) {\n  if (topic in spfPubsub.subscriptions) {\n    spfArray.each(spfPubsub.subscriptions[topic], function (subFn, i, arr) {\n      if (opt_unsub) {\n        arr[i] = null\n      }\n      if (subFn) {\n        subFn()\n      }\n    })\n  }\n}\n\n/**\n * Renames a topic.  All functions subscribed to the old topic will then\n * be subscribed to the new topic instead.\n *\n * @param {string} oldTopic The old name for the topic. Passing an empty string\n *     does nothing.\n * @param {string} newTopic The new name for the topic. Passing an empty string\n *     does nothing.\n */\nspfPubsub.rename = function (oldTopic, newTopic) {\n  if (oldTopic && newTopic && oldTopic in spfPubsub.subscriptions) {\n    var existing = spfPubsub.subscriptions[newTopic] || []\n    spfPubsub.subscriptions[newTopic] =\n        existing.concat(spfPubsub.subscriptions[oldTopic])\n    spfPubsub.clear(oldTopic)\n  }\n}\n\n/**\n * Clears the subscription list for a topic.\n *\n * @param {string} topic Topic to clear.\n */\nspfPubsub.clear = function (topic) {\n  delete spfPubsub.subscriptions[topic]\n}\n\n/**\n * Map of subscriptions.\n * @type {!Object.<Array>}\n */\nspfPubsub.subscriptions = {}\n\n// Automatic initialization for spfPubsub.subscriptions.\n// When built for the bootloader, unconditionally set in state.\nif (SPF_BOOTLOADER) {\n  spfState.set(spfState.Key.PUBSUB_SUBS, spfPubsub.subscriptions)\n} else {\n  if (!spfState.has(spfState.Key.PUBSUB_SUBS)) {\n    spfState.set(spfState.Key.PUBSUB_SUBS, spfPubsub.subscriptions)\n  }\n  spfPubsub.subscriptions = /** @type {!Object.<Array>} */ (\n      spfState.get(spfState.Key.PUBSUB_SUBS))\n}\n\nexport default spfPubsub\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/pubsub/pubsub.js","(function () {\n  var slice = [].slice\n\n  this.ActionCable = {\n    INTERNAL: {\n      'message_types': {\n        'welcome': 'welcome',\n        'ping': 'ping',\n        'confirmation': 'confirm_subscription',\n        'rejection': 'reject_subscription'\n      },\n      'default_mount_path': '/cable',\n      'protocols': ['actioncable-v1-json', 'actioncable-unsupported']\n    },\n    createConsumer: function (url) {\n      var ref\n      if (url == null) {\n        url = (ref = this.getConfig('url')) != null ? ref : this.INTERNAL.default_mount_path\n      }\n      return new ActionCable.Consumer(this.createWebSocketURL(url))\n    },\n    getConfig: function (name) {\n      var element\n      element = document.head.querySelector(\"meta[name='action-cable-\" + name + \"']\")\n      return element != null ? element.getAttribute('content') : void 0\n    },\n    createWebSocketURL: function (url) {\n      var a\n      if (url && !/^wss?:/i.test(url)) {\n        a = document.createElement('a')\n        a.href = url\n        a.href = a.href\n        a.protocol = a.protocol.replace('http', 'ws')\n        return a.href\n      } else {\n        return url\n      }\n    },\n    startDebugging: function () {\n      return this.debugging = true\n    },\n    stopDebugging: function () {\n      return this.debugging = null\n    },\n    log: function () {\n      var messages\n      messages = arguments.length >= 1 ? slice.call(arguments, 0) : []\n      if (this.debugging) {\n        messages.push(Date.now())\n        return console.log.apply(console, ['[ActionCable]'].concat(slice.call(messages)))\n      }\n    }\n  }\n\n  if (typeof window !== 'undefined' && window !== null) {\n    window.ActionCable = this.ActionCable\n  }\n\n  if (typeof module !== 'undefined' && module !== null) {\n    module.exports = this.ActionCable\n  }\n}).call(window);\n(function () {\n  var bind = function (fn, me) { return function () { return fn.apply(me, arguments) } }\n\n  ActionCable.ConnectionMonitor = (function () {\n    var clamp, now, secondsSince\n\n    ConnectionMonitor.pollInterval = {\n      min: 3,\n      max: 30\n    }\n\n    ConnectionMonitor.staleThreshold = 6\n\n    function ConnectionMonitor (connection) {\n      this.connection = connection\n      this.visibilityDidChange = bind(this.visibilityDidChange, this)\n      this.reconnectAttempts = 0\n    }\n\n    ConnectionMonitor.prototype.start = function () {\n      if (!this.isRunning()) {\n        this.startedAt = now()\n        delete this.stoppedAt\n        this.startPolling()\n        document.addEventListener('visibilitychange', this.visibilityDidChange)\n        return ActionCable.log('ConnectionMonitor started. pollInterval = ' + (this.getPollInterval()) + ' ms')\n      }\n    }\n\n    ConnectionMonitor.prototype.stop = function () {\n      if (this.isRunning()) {\n        this.stoppedAt = now()\n        this.stopPolling()\n        document.removeEventListener('visibilitychange', this.visibilityDidChange)\n        return ActionCable.log('ConnectionMonitor stopped')\n      }\n    }\n\n    ConnectionMonitor.prototype.isRunning = function () {\n      return (this.startedAt != null) && (this.stoppedAt == null)\n    }\n\n    ConnectionMonitor.prototype.recordPing = function () {\n      return this.pingedAt = now()\n    }\n\n    ConnectionMonitor.prototype.recordConnect = function () {\n      this.reconnectAttempts = 0\n      this.recordPing()\n      delete this.disconnectedAt\n      return ActionCable.log('ConnectionMonitor recorded connect')\n    }\n\n    ConnectionMonitor.prototype.recordDisconnect = function () {\n      this.disconnectedAt = now()\n      return ActionCable.log('ConnectionMonitor recorded disconnect')\n    }\n\n    ConnectionMonitor.prototype.startPolling = function () {\n      this.stopPolling()\n      return this.poll()\n    }\n\n    ConnectionMonitor.prototype.stopPolling = function () {\n      return clearTimeout(this.pollTimeout)\n    }\n\n    ConnectionMonitor.prototype.poll = function () {\n      return this.pollTimeout = setTimeout((function (_this) {\n        return function () {\n          _this.reconnectIfStale()\n          return _this.poll()\n        }\n      })(this), this.getPollInterval())\n    }\n\n    ConnectionMonitor.prototype.getPollInterval = function () {\n      var interval, max, min, ref\n      ref = this.constructor.pollInterval, min = ref.min, max = ref.max\n      interval = 5 * Math.log(this.reconnectAttempts + 1)\n      return Math.round(clamp(interval, min, max) * 1000)\n    }\n\n    ConnectionMonitor.prototype.reconnectIfStale = function () {\n      if (this.connectionIsStale()) {\n        ActionCable.log('ConnectionMonitor detected stale connection. reconnectAttempts = ' + this.reconnectAttempts + ', pollInterval = ' + (this.getPollInterval()) + ' ms, time disconnected = ' + (secondsSince(this.disconnectedAt)) + ' s, stale threshold = ' + this.constructor.staleThreshold + ' s')\n        this.reconnectAttempts++\n        if (this.disconnectedRecently()) {\n          return ActionCable.log('ConnectionMonitor skipping reopening recent disconnect')\n        } else {\n          ActionCable.log('ConnectionMonitor reopening')\n          return this.connection.reopen()\n        }\n      }\n    }\n\n    ConnectionMonitor.prototype.connectionIsStale = function () {\n      var ref\n      return secondsSince((ref = this.pingedAt) != null ? ref : this.startedAt) > this.constructor.staleThreshold\n    }\n\n    ConnectionMonitor.prototype.disconnectedRecently = function () {\n      return this.disconnectedAt && secondsSince(this.disconnectedAt) < this.constructor.staleThreshold\n    }\n\n    ConnectionMonitor.prototype.visibilityDidChange = function () {\n      if (document.visibilityState === 'visible') {\n        return setTimeout((function (_this) {\n          return function () {\n            if (_this.connectionIsStale() || !_this.connection.isOpen()) {\n              ActionCable.log('ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = ' + document.visibilityState)\n              return _this.connection.reopen()\n            }\n          }\n        })(this), 200)\n      }\n    }\n\n    now = function () {\n      return new Date().getTime()\n    }\n\n    secondsSince = function (time) {\n      return (now() - time) / 1000\n    }\n\n    clamp = function (number, min, max) {\n      return Math.max(min, Math.min(max, number))\n    }\n\n    return ConnectionMonitor\n  })()\n}).call(window);\n(function () {\n  var i, message_types, protocols, ref, supportedProtocols, unsupportedProtocol,\n    slice = [].slice,\n    bind = function (fn, me) { return function () { return fn.apply(me, arguments) } },\n    indexOf = [].indexOf || function (item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i } return -1 }\n\n  ref = ActionCable.INTERNAL, message_types = ref.message_types, protocols = ref.protocols\n\n  supportedProtocols = protocols.length >= 2 ? slice.call(protocols, 0, i = protocols.length - 1) : (i = 0, []), unsupportedProtocol = protocols[i++]\n\n  ActionCable.Connection = (function () {\n    Connection.reopenDelay = 500\n\n    function Connection (consumer) {\n      this.consumer = consumer\n      this.open = bind(this.open, this)\n      this.subscriptions = this.consumer.subscriptions\n      this.monitor = new ActionCable.ConnectionMonitor(this)\n      this.disconnected = true\n    }\n\n    Connection.prototype.send = function (data) {\n      if (this.isOpen()) {\n        this.webSocket.send(JSON.stringify(data))\n        return true\n      } else {\n        return false\n      }\n    }\n\n    Connection.prototype.open = function () {\n      if (this.isActive()) {\n        ActionCable.log('Attempted to open WebSocket, but existing socket is ' + (this.getState()))\n        throw new Error('Existing connection must be closed before opening')\n      } else {\n        ActionCable.log('Opening WebSocket, current state is ' + (this.getState()) + ', subprotocols: ' + protocols)\n        if (this.webSocket != null) {\n          this.uninstallEventHandlers()\n        }\n        this.webSocket = new WebSocket(this.consumer.url, protocols)\n        this.installEventHandlers()\n        this.monitor.start()\n        return true\n      }\n    }\n\n    Connection.prototype.close = function (arg) {\n      var allowReconnect, ref1\n      allowReconnect = (arg != null ? arg : {\n        allowReconnect: true\n      }).allowReconnect\n      if (!allowReconnect) {\n        this.monitor.stop()\n      }\n      if (this.isActive()) {\n        return (ref1 = this.webSocket) != null ? ref1.close() : void 0\n      }\n    }\n\n    Connection.prototype.reopen = function () {\n      var error, error1\n      ActionCable.log('Reopening WebSocket, current state is ' + (this.getState()))\n      if (this.isActive()) {\n        try {\n          return this.close()\n        } catch (error1) {\n          error = error1\n          return ActionCable.log('Failed to reopen WebSocket', error)\n        } finally {\n          ActionCable.log('Reopening WebSocket in ' + this.constructor.reopenDelay + 'ms')\n          setTimeout(this.open, this.constructor.reopenDelay)\n        }\n      } else {\n        return this.open()\n      }\n    }\n\n    Connection.prototype.getProtocol = function () {\n      var ref1\n      return (ref1 = this.webSocket) != null ? ref1.protocol : void 0\n    }\n\n    Connection.prototype.isOpen = function () {\n      return this.isState('open')\n    }\n\n    Connection.prototype.isActive = function () {\n      return this.isState('open', 'connecting')\n    }\n\n    Connection.prototype.isProtocolSupported = function () {\n      var ref1\n      return ref1 = this.getProtocol(), indexOf.call(supportedProtocols, ref1) >= 0\n    }\n\n    Connection.prototype.isState = function () {\n      var ref1, states\n      states = arguments.length >= 1 ? slice.call(arguments, 0) : []\n      return ref1 = this.getState(), indexOf.call(states, ref1) >= 0\n    }\n\n    Connection.prototype.getState = function () {\n      var ref1, state, value\n      for (state in WebSocket) {\n        value = WebSocket[state]\n        if (value === ((ref1 = this.webSocket) != null ? ref1.readyState : void 0)) {\n          return state.toLowerCase()\n        }\n      }\n      return null\n    }\n\n    Connection.prototype.installEventHandlers = function () {\n      var eventName, handler\n      for (eventName in this.events) {\n        handler = this.events[eventName].bind(this)\n        this.webSocket['on' + eventName] = handler\n      }\n    }\n\n    Connection.prototype.uninstallEventHandlers = function () {\n      var eventName\n      for (eventName in this.events) {\n        this.webSocket['on' + eventName] = function () {}\n      }\n    }\n\n    Connection.prototype.events = {\n      message: function (event) {\n        var identifier, message, ref1, type\n        if (!this.isProtocolSupported()) {\n          return\n        }\n        ref1 = JSON.parse(event.data), identifier = ref1.identifier, message = ref1.message, type = ref1.type\n        switch (type) {\n          case message_types.welcome:\n            this.monitor.recordConnect()\n            return this.subscriptions.reload()\n          case message_types.ping:\n            return this.monitor.recordPing()\n          case message_types.confirmation:\n            return this.subscriptions.notify(identifier, 'connected')\n          case message_types.rejection:\n            return this.subscriptions.reject(identifier)\n          default:\n            return this.subscriptions.notify(identifier, 'received', message)\n        }\n      },\n      open: function () {\n        ActionCable.log(\"WebSocket onopen event, using '\" + (this.getProtocol()) + \"' subprotocol\")\n        this.disconnected = false\n        if (!this.isProtocolSupported()) {\n          ActionCable.log('Protocol is unsupported. Stopping monitor and disconnecting.')\n          return this.close({\n            allowReconnect: false\n          })\n        }\n      },\n      close: function (event) {\n        ActionCable.log('WebSocket onclose event')\n        if (this.disconnected) {\n          return\n        }\n        this.disconnected = true\n        this.monitor.recordDisconnect()\n        return this.subscriptions.notifyAll('disconnected', {\n          willAttemptReconnect: this.monitor.isRunning()\n        })\n      },\n      error: function () {\n        return ActionCable.log('WebSocket onerror event')\n      }\n    }\n\n    return Connection\n  })()\n}).call(window);\n(function () {\n  var slice = [].slice\n\n  ActionCable.Subscriptions = (function () {\n    function Subscriptions (consumer) {\n      this.consumer = consumer\n      this.subscriptions = []\n    }\n\n    Subscriptions.prototype.create = function (channelName, mixin) {\n      var channel, params, subscription\n      channel = channelName\n      params = typeof channel === 'object' ? channel : {\n        channel: channel\n      }\n      subscription = new ActionCable.Subscription(this.consumer, params, mixin)\n      return this.add(subscription)\n    }\n\n    Subscriptions.prototype.add = function (subscription) {\n      this.subscriptions.push(subscription)\n      this.consumer.ensureActiveConnection()\n      this.notify(subscription, 'initialized')\n      this.sendCommand(subscription, 'subscribe')\n      return subscription\n    }\n\n    Subscriptions.prototype.remove = function (subscription) {\n      this.forget(subscription)\n      if (!this.findAll(subscription.identifier).length) {\n        this.sendCommand(subscription, 'unsubscribe')\n      }\n      return subscription\n    }\n\n    Subscriptions.prototype.reject = function (identifier) {\n      var i, len, ref, results, subscription\n      ref = this.findAll(identifier)\n      results = []\n      for (i = 0, len = ref.length; i < len; i++) {\n        subscription = ref[i]\n        this.forget(subscription)\n        this.notify(subscription, 'rejected')\n        results.push(subscription)\n      }\n      return results\n    }\n\n    Subscriptions.prototype.forget = function (subscription) {\n      var s\n      this.subscriptions = (function () {\n        var i, len, ref, results\n        ref = this.subscriptions\n        results = []\n        for (i = 0, len = ref.length; i < len; i++) {\n          s = ref[i]\n          if (s !== subscription) {\n            results.push(s)\n          }\n        }\n        return results\n      }.call(this))\n      return subscription\n    }\n\n    Subscriptions.prototype.findAll = function (identifier) {\n      var i, len, ref, results, s\n      ref = this.subscriptions\n      results = []\n      for (i = 0, len = ref.length; i < len; i++) {\n        s = ref[i]\n        if (s.identifier === identifier) {\n          results.push(s)\n        }\n      }\n      return results\n    }\n\n    Subscriptions.prototype.reload = function () {\n      var i, len, ref, results, subscription\n      ref = this.subscriptions\n      results = []\n      for (i = 0, len = ref.length; i < len; i++) {\n        subscription = ref[i]\n        results.push(this.sendCommand(subscription, 'subscribe'))\n      }\n      return results\n    }\n\n    Subscriptions.prototype.notifyAll = function () {\n      var args, callbackName, i, len, ref, results, subscription\n      callbackName = arguments[0], args = arguments.length >= 2 ? slice.call(arguments, 1) : []\n      ref = this.subscriptions\n      results = []\n      for (i = 0, len = ref.length; i < len; i++) {\n        subscription = ref[i]\n        results.push(this.notify.apply(this, [subscription, callbackName].concat(slice.call(args))))\n      }\n      return results\n    }\n\n    Subscriptions.prototype.notify = function () {\n      var args, callbackName, i, len, results, subscription, subscriptions\n      subscription = arguments[0], callbackName = arguments[1], args = arguments.length >= 3 ? slice.call(arguments, 2) : []\n      if (typeof subscription === 'string') {\n        subscriptions = this.findAll(subscription)\n      } else {\n        subscriptions = [subscription]\n      }\n      results = []\n      for (i = 0, len = subscriptions.length; i < len; i++) {\n        subscription = subscriptions[i]\n        results.push(typeof subscription[callbackName] === 'function' ? subscription[callbackName].apply(subscription, args) : void 0)\n      }\n      return results\n    }\n\n    Subscriptions.prototype.sendCommand = function (subscription, command) {\n      var identifier\n      identifier = subscription.identifier\n      return this.consumer.send({\n        command: command,\n        identifier: identifier\n      })\n    }\n\n    return Subscriptions\n  })()\n}).call(window);\n(function () {\n  ActionCable.Subscription = (function () {\n    var extend\n\n    function Subscription (consumer, params, mixin) {\n      this.consumer = consumer\n      if (params == null) {\n        params = {}\n      }\n      this.identifier = JSON.stringify(params)\n      extend(this, mixin)\n    }\n\n    Subscription.prototype.perform = function (action, data) {\n      if (data == null) {\n        data = {}\n      }\n      data.action = action\n      return this.send(data)\n    }\n\n    Subscription.prototype.send = function (data) {\n      return this.consumer.send({\n        command: 'message',\n        identifier: this.identifier,\n        data: JSON.stringify(data)\n      })\n    }\n\n    Subscription.prototype.unsubscribe = function () {\n      return this.consumer.subscriptions.remove(this)\n    }\n\n    extend = function (object, properties) {\n      var key, value\n      if (properties != null) {\n        for (key in properties) {\n          value = properties[key]\n          object[key] = value\n        }\n      }\n      return object\n    }\n\n    return Subscription\n  })()\n}).call(window);\n(function () {\n  ActionCable.Consumer = (function () {\n    function Consumer (url) {\n      this.url = url\n      this.subscriptions = new ActionCable.Subscriptions(this)\n      this.connection = new ActionCable.Connection(this)\n    }\n\n    Consumer.prototype.send = function (data) {\n      return this.connection.send(data)\n    }\n\n    Consumer.prototype.connect = function () {\n      return this.connection.open()\n    }\n\n    Consumer.prototype.disconnect = function () {\n      return this.connection.close({\n        allowReconnect: false\n      })\n    }\n\n    Consumer.prototype.ensureActiveConnection = function () {\n      if (!this.connection.isActive()) {\n        return this.connection.open()\n      }\n    }\n\n    return Consumer\n  })()\n}).call(window)\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/common/ActionCable.js","export default class LoadingBar {\n  constructor (options) {\n  \toptions = options || {}\n    this.height = options.height\n    this.width = options.width\n    this.type = options.type || 'normal'\n    this.percent = options.percent || 0\n    this.show = false\n    this.timer = null\n    this.loadingEle = null\n  }\n\n  init (options) {\n  \tlet container = document.getElementById('loadingBar-container')\n  \tlet bar = document.createElement('div')\n  \tbar.id = 'loadingBar'\n  \tbar.className = 'app-loading-bar'\n\n  \tlet inner = document.createElement('span')\n  \tinner.className = 'app-loading-bar-inner app-loading-bar-inner-color-primary'\n\n  \tthis.loadingEle = inner\n  \tbar.appendChild(inner)\n\n  \tcontainer.appendChild(bar)\n  }\n\n  start () {\n  \tif (this.timer) return\n  \tthis.percent = 0\n  \tthis.init()\n  \tthis.timer = setInterval(() => {\n    this.percent += Math.floor(Math.random() * 3 + 5)\n    if (this.percent > 95) {\n        \tclearInterval(this.timer)\n    }\n    this.update({\n      percent: this.percent,\n      type: 'normal',\n      show: true\n    })\n  }, 200)\n  }\n\n  update (options) {\n  \tthis.percent = options.percent\n  \tthis.type = options.type\n  \tthis.show = options.show\n  \tif (this.type === 'error') this.loadingEle.style.backgroundColor = 'red'\n  \tthis.loadingEle.style.width = this.percent + '%'\n  }\n\n  finish () {\n  \tthis.update({\n  \t\tpercent: 100,\n  \t\ttype: 'normal',\n  \t\tshow: true\n  \t})\n  }\n\n  error () {\n  \tthis.update({\n  \t\tpercent: 100,\n  \t\ttype: 'error',\n  \t\tshow: true\n  \t})\n  }\n\n  destroy () {\n  \tclearInterval(this.timer)\n  \tlet loadingBarEle = document.getElementById('loadingBar')\n  \tloadingBarEle.parentElement.removeChild(loadingBarEle)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/common/loadingBar.js","import {handleMethod} from '../common/handleMethod'\n\nexport function dataLinks () {\n  document.addEventListener('click', processDataLink, false)\n}\nfunction processDataLink (ev) {\n  let e = window.e || ev\n\n  if (e.target.tagName !== 'A') return\n\n  if (e.target.dataset.method === 'delete') {\n    e.preventDefault()\n    if (e.target.getAttribute('href') === '/logout') {\n      if (A.destroy[A.gc.currentName]) A.destroy[A.gc.currentName].apply(null)\n    };\n    handleMethod(e.target)\n  }\n  if (e.target.dataset.method === 'PATCH') {\n    e.preventDefault()\n    handleMethod(e.target)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/modules/dataLinks.js","let hmInstance\nlet fd, fa\n\nexport function processFormSubmit (ev) {\n  let e = window.e || ev\n  let tt = e.target\n\n  if (tt.tagName === 'INPUT' &&\n      tt.classList.contains('c-form-submit') &&\n      tt.getAttribute('type') === 'submit' &&\n      tt.getAttribute('name') === 'commit') {\n    e.preventDefault()\n    let f = tt.closest('form')\n    let fa = f.action\n    let fm = f.method\n    let fd = new FormData(f)\n    window.A.spf.load(fa, {\n      method: fm,\n      postData: fd,\n      onProcess: function (evt) {\n        // exitProcessPostLink();\n        if (A.fnpuLoad[A.gc.currentName] &&\n            A.fnpuLoad[A.gc.currentName]['process'] &&\n            (typeof A.fnpuLoad[A.gc.currentName]['process'] === 'function')) {\n          A.fnpuLoad[A.gc.currentName]['process'].apply(null)\n        }\n      },\n      onDone: function (evt) {\n        // processPostLink();\n        if (A.fnpuLoad[A.gc.currentName] &&\n            A.fnpuLoad[A.gc.currentName]['done'] &&\n            (typeof A.fnpuLoad[A.gc.currentName]['done'] === 'function')) {\n          A.fnpuLoad[A.gc.currentName]['done'].apply(null)\n        }\n        if (evt.response &&\n            evt.response.status === 'success' &&\n            evt.response.url) window.A.spf.navigate(evt.response.url)\n      }\n    })\n  };\n}\nexport function formSubmit () {\n  document.addEventListener('click', processFormSubmit, false)\n}\nfunction exitProcessPostLink () {\n  document.removeEventListener('click', processDataLink, false)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/modules/formSubmit.js","import {handleMethod} from '../common/handleMethod2'\n\nlet hmInstance\nlet fd, fa\n\nexport function processDataLink (ev) {\n  let e = window.e || ev\n\n  if (e.target.tagName !== 'A') return\n\n  if (e.target.dataset.method === 'fnpu_delete') {\n    e.preventDefault()\n    hmInstance = handleMethod(e.target, 'delete')\n    fa = e.target.getAttribute('href')\n    fd = new FormData(hmInstance)\n    window.A.spf.load(fa, {\n      method: 'POST',\n      postData: fd,\n      onProcess: function (evt) {\n        // exitProcessPostLink();\n        if (A.fnpuLoad[A.gc.currentName] &&\n\t\t        A.fnpuLoad[A.gc.currentName]['process'] &&\n\t\t        (typeof A.fnpuLoad[A.gc.currentName]['process'] === 'function')) {\n        \tA.fnpuLoad[A.gc.currentName]['process'].apply(null)\n        }\n      },\n      onDone: function (evt) {\n        // processPostLink();\n        if (A.fnpuLoad[A.gc.currentName] &&\n\t\t        A.fnpuLoad[A.gc.currentName]['done'] &&\n\t\t        (typeof A.fnpuLoad[A.gc.currentName]['done'] === 'function')) {\n        \tA.fnpuLoad[A.gc.currentName]['done'].apply(null)\n        }\n      }\n    })\n  }\n}\nexport function processPostLink () {\n  document.addEventListener('click', processDataLink, false)\n}\nfunction exitProcessPostLink () {\n  document.removeEventListener('click', processDataLink, false)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/modules/postHandler.js","import {spfBase} from './base'\nimport spfMain from './main'\nimport spfConfig from './config'\nimport spfCache from './cache/cache'\nimport spfDebug from './debug/debug'\nimport spfHistory from './history/history'\nimport spfNav from './nav/nav'\nimport spfNetStyle from './net/style'\nimport spfNetScript from './net/script'\n\nlet spfEntry = {}\n// Create the API by exporting aliased functions.\n// Core API functions are available on the top-level namespace.\n// Extra API functions are available on second-level namespaces.\n/** @private {!Object} */\nspfEntry.api_ = {\n  'init': spfMain.init,\n  'dispose': spfMain.dispose,\n  'navigate': spfNav.navigate,\n  'load': spfNav.load,\n  'prefetch': spfNav.prefetch,\n  'process': spfNav.process\n}\n/** @private {!Object} */\nspfEntry.extra_ = {\n  'cache': {\n    // Cache API.\n    // * Remove one entry.\n    'remove': spfCache.remove,\n    // * Clear all entries.\n    'clear': spfCache.clear\n  },\n  'script': {\n    // The bootloader API.\n    // * Load scripts.\n    'load': spfNetScript.load,\n    'get': spfNetScript.get,\n    // * Wait until ready.\n    'ready': spfNetScript.ready,\n    'done': spfNetScript.done,\n    // * Load in depedency order.\n    'require': spfNetScript.require,\n    // * Set dependencies and paths.\n    'declare': spfNetScript.declare,\n    'path': spfNetScript.path,\n    // Extended script loading API.\n    // * Unload scripts.\n    'unload': spfNetScript.unload,\n    // * Ignore ready.\n    'ignore': spfNetScript.ignore,\n    // * Unload in depedency order.\n    'unrequire': spfNetScript.unrequire,\n    // * Prefetch.\n    'prefetch': spfNetScript.prefetch\n  },\n  'style': {\n    // Style loading API.\n    // * Load styles.\n    'load': spfNetStyle.load,\n    'get': spfNetStyle.get,\n    // * Unload styles.\n    'unload': spfNetStyle.unload,\n    // * Set paths.\n    'path': spfNetStyle.path,\n    // * Prefetch.\n    'prefetch': spfNetStyle.prefetch\n  }\n}\n// For a production/debug build, isolate access to the API.\n// For a development build, mixin the API to the existing namespace.\nlet spfEs = {}\n\nfor (var fn1 in spfEntry.api_) {\n  spfEs[fn1] = spfEntry.api_[fn1]\n}\n// Use two-stage exporting to allow aliasing the intermediate namespaces\n// created by the bootloader (e.g. s = spf.script; s.load(...)).\nfor (var ns in spfEntry.extra_) {\n  for (var fn2 in spfEntry.extra_[ns]) {\n    spfEs[ns] = spfEs[ns] || {}\n    spfEs[ns][fn2] = spfEntry.extra_[ns][fn2]\n  }\n}\n\nexport default spfEs\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/entry.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app/stylesheet/globalA.scss\n// module id = 55\n// module chunks = 0","import {rorParams as RPs} from '../common/csrf'\n/**\n * [handleMethod description]\n * @param  {HTMLElement} link [description]\n * @return {[type]}      [description]\n * Handles \"data-method\" on links such as:\n * <a href=\"/users/5\" data-method=\"delete\" rel=\"nofollow\" data-confirm=\"Are you sure?\">Delete</a>\n */\nexport function handleMethod (link, obj = {}) {\n  var href = link.getAttribute('href'),\n    method = link.dataset.method,\n    target = link.getAttribute('target'),\n    csrfToken = RPs.csrfToken(),\n    csrfParam = RPs.csrfParam()\n  var paramsObj = {\n    href: href,\n    method: method,\n    target: target,\n    csrfToken: csrfToken,\n    csrfParam: csrfParam\n  }\n  var formEle = createForm(paramsObj, obj)\n  appendFormToDom(formEle)\n  submitForm(formEle)\n}\nfunction createForm (params, obj) {\n  var f = document.createElement('form')\n  f.style.display = 'none'\n  f.setAttribute('method', 'post')\n  f.setAttribute('action', params.href)\n  if (params.target) {\n    f.setAttribute('target', params.target)\n  };\n\n  var i = document.createElement('input')\n  i.setAttribute('type', 'hidden')\n  i.setAttribute('name', '_method')\n  i.setAttribute('value', params.method)\n\n  var s\n  if (params.csrfParam !== undefined &&\n      params.csrfToken !== undefined &&\n      !RPs.isCrossDomain(params.href)) {\n    s = document.createElement('input')\n    s.setAttribute('type', 'hidden')\n    s.setAttribute('name', params.csrfParam)\n    s.setAttribute('value', params.csrfToken)\n  }\n  f.appendChild(i)\n\n  // for (let key in obj.data) {\n  //   if (obj.data.hasOwnProperty(key)) {\n  //     let t = document.createElement('input');\n  //     t.setAttribute('type','hidden');\n  //     t.setAttribute('name','' + obj.ns + '[' + key + ']');\n  //     t.setAttribute('value',obj.data[key]);\n  //     f.appendChild(t);\n  //   }\n  // }\n\n  if (s) {\n    f.appendChild(s)\n  };\n  return f\n}\n\nfunction appendFormToDom (form) {\n  document.body.appendChild(form)\n}\nfunction submitForm (form) {\n  form.submit()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/common/handleMethod.js","import styles from '../../../stylesheet/globalA.scss'\n\nimport {ActionCable} from '../common/ActionCable'\n\nimport spfEs from '../spf/entry'\nimport {dataLinks} from '../modules/dataLinks'\nimport {formSubmit} from '../modules/formSubmit'\n\nimport {processPostLink} from '../modules/postHandler'\n\nimport LoadingBar from '../common/loadingBar'\n\nlet A = window.A || {}\nwindow.A = A\nA.spf = spfEs\nlet app = window.A.app || {}\n\ndataLinks()\nformSubmit()\nprocessPostLink()\n\n/**\n * Initialize the app.\n */\napp.init = function () {\n  app.start_ = +new Date()\n  if (window.addEventListener) {\n    window.addEventListener('spfclick', app.onClick)\n    window.addEventListener('spfhistory', app.onHistory)\n    window.addEventListener('spfrequest', app.onRequest)\n    window.addEventListener('spfpartprocess', app.onPartProcess)\n    window.addEventListener('spfpartdone', app.onPartDone)\n    window.addEventListener('spfprocess', app.onProcess)\n    window.addEventListener('spfdone', app.onDone)\n    window.addEventListener('spferror', app.onError)\n\n    window.addEventListener('spfjsbeforeunload', app.onScriptBeforeUnload)\n    window.addEventListener('spfjsunload', app.onScriptUnload)\n    window.addEventListener('spfcssbeforeunload', app.onStyleBeforeUnload)\n    window.addEventListener('spfcssunload', app.onStyleUnload)\n  }\n  app.enabled = A.spf.init()\n}\n\n/**\n * Dispose the demo app.\n */\napp.dispose = function () {\n  app.start_ = 0\n  app.enabled = false\n  if (window.removeEventListener) {\n    window.removeEventListener('spfclick', app.onClick)\n    window.removeEventListener('spfhistory', app.onHistory)\n    window.removeEventListener('spfrequest', app.onRequest)\n    window.removeEventListener('spfpartprocess', app.onPartProcess)\n    window.removeEventListener('spfpartdone', app.onPartDone)\n    window.removeEventListener('spfprocess', app.onProcess)\n    window.removeEventListener('spfdone', app.onDone)\n    window.removeEventListener('spferror', app.onError)\n\n    window.removeEventListener('spfjsbeforeunload', app.onScriptBeforeUnload)\n    window.removeEventListener('spfjsunload', app.onScriptUnload)\n    window.removeEventListener('spfcssbeforeunload', app.onStyleBeforeUnload)\n    window.removeEventListener('spfcssunload', app.onStyleUnload)\n  }\n}\n\n/**\n * Simple central logging function for the demo app.\n * @param {string} msg Message to log.\n */\napp.log = function (msg) {\n  if (window.console) {\n    // window.console.log('[app] ' + msg);\n  }\n}\n\n/**\n * Event handler for when a navigate click occurs.\n * @param {CustomEvent} evt The event.\n */\napp.onClick = function (evt) {\n  app.log('globalA--navigate click ' + evt.detail.url)\n}\n\n/**\n * Event handler for when a navigate history change occurs.\n * @param {CustomEvent} evt The event.\n */\napp.onHistory = function (evt) {\n  app.log('globalA--navigate history ' + evt.detail.url)\n}\n\n/**\n * Event handler for when navigate requests are going to be sent.\n * @param {CustomEvent} evt The event.\n */\napp.onRequest = function (evt) {\n  if (!app.ins) {\n    app.ins = new LoadingBar()\n    app.ins.start()\n  }\n  app.log('globalA--navigate request ' + evt.detail.url)\n  // If debug logging is enabled, reset the relative times when each new\n  // request is sent.\n  if (A.spf.debug) {\n    A.spf.debug.reset()\n  }\n}\n\n/**\n * Event handler for when parts of navigate responses are going to be processed.\n * @param {CustomEvent} evt The event.\n */\napp.onPartProcess = function (evt) {\n  app.log('globalA--navigate part process ' + evt.detail.url)\n}\n\n/**\n * Event handler for when parts of navigate responses are done being processed.\n * @param {CustomEvent} evt The event.\n */\napp.onPartDone = function (evt) {\n  app.log('globalA--navigate part done ' + evt.detail.url)\n}\n\n/**\n * Event handler for when navigate responses are going to be processed.\n * @param {CustomEvent} evt The event.\n */\napp.onProcess = function (evt) {\n  if (A.detach[A.gc.currentName]) A.detach[A.gc.currentName].apply(null)\n  if (A.destroy[A.gc.currentName]) A.destroy[A.gc.currentName].apply(null)\n  app.destroy(A.gc.currentName)\n  A.gc.currentName = evt.detail.response.name\n  app.log('globalA--navigate process ' + evt.detail.url)\n}\n\n/**\n * Event handler for when navigate responses are done being processed.\n * @param {CustomEvent} evt The event.\n */\napp.onDone = function (evt) {\n  if (app.ins) {\n    app.ins.finish()\n    setTimeout(() => { app.ins.destroy(); app.ins = null }, 100)\n  }\n  if (A.init[A.gc.currentName]) A.init[A.gc.currentName].apply(null)\n}\n\n/**\n * Event handler for navigate errors.\n * @param {CustomEvent} evt The event.\n */\napp.onError = function (evt) {\n  if (app.ins) {\n    app.ins.error()\n    setTimeout(() => { app.ins.destroy(); app.ins = null }, 1000)\n  }\n  app.log('globalA--navigate error ' + evt.detail.url)\n}\n\n/**\n * Event handler for script before unload.\n * @param {CustomEvent} evt The event.\n */\napp.onScriptBeforeUnload = function (evt) {\n  var name = evt.detail.name\n  app.log('globalA--script before unload ' + name)\n}\n\n/**\n * Event handler for script unload.\n * @param {CustomEvent} evt The event.\n */\napp.onScriptUnload = function (evt) {\n  var name = evt.detail.name\n  var urls = evt.detail.urls\n  app.log('globalA--script unload ' + name + ' ' + urls)\n}\n\n/**\n * Event handler for style before unload.\n * @param {CustomEvent} evt The event.\n */\napp.onStyleBeforeUnload = function (evt) {\n  var name = evt.detail.name\n  app.log('globalA--style before unload ' + name)\n}\n\n/**\n * Event handler for style unload.\n * @param {CustomEvent} evt The event.\n */\napp.onStyleUnload = function (evt) {\n  var name = evt.detail.name\n  var urls = evt.detail.urls\n  app.log('globalA--style unload ' + name + ' ' + urls)\n}\n\n/**\n * [destroy entry]\n * @param  {[type]} name [description]\n * @return {[type]}      [description]\n */\napp.destroy = function (name) {\n  A.spf.style.unload(name)\n  // A.spf.script.unload(name);\n}\n\n/**\n * Whether SPF is enabled for the demo app.\n * @type {boolean}\n  */\napp.enabled = false\n\n/**\n * The timestamp of when the demo app started.\n * @type {number}\n * @private\n */\napp.start_ = 0\n\n/**\n * The timer counting since last page load.\n * @type {number}\n * @private\n */\napp.timer_ = 0\n\nA.app = app\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/entries/globalA.js","/**\n * @fileoverview Fast asynchronous function execution.\n *\n * This package provides functions to defer execution on the main thread\n * without using setTimeout, though setTimeout is used as a fallback in browsers\n * that do not support other methods.  Using these methods is advantageous when\n * one wants to schedule a callback faster than the setTimeout clamped minimum\n * allows (e.g. when doing `setTimeout(fn, 0)`)  The clamped minimum for\n * setTimeout is often 10ms, though when WebKit browsers are in a background\n * tab, setTimeout calls deprioritized to execute with a 1s delay.  In these\n * cases, this package provides an alternative.\n *\n */\n\nimport {spfBase, SPF_BOOTLOADER} from '../base'\nimport spfState from '../state'\nimport spfString from '../string/string'\n\n// goog.provide('spfAsync');\n\nlet spfAsync = {}\n\n/**\n * Defers execution of a function to the next slot on the main thread.\n *\n * @param {!Function} fn The function to defer.\n */\nspfAsync.defer = function (fn) {\n  var uid = spfBase.uid()\n  spfAsync.defers_[uid] = fn\n  if (spfAsync.POSTMESSAGE_SUPPORTED_) {\n    window.postMessage(spfAsync.PREFIX_ + uid, '*')\n  } else {\n    window.setTimeout(spfBase.bind(spfAsync.run_, null, uid), 0)\n  }\n}\n\n/**\n * Handles a message event and triggers execution function.\n *\n * @param {Event} evt The click event.\n * @private\n */\nspfAsync.handleMessage_ = function (evt) {\n  if (evt.data && spfString.isString(evt.data) &&\n      spfString.startsWith(evt.data, spfAsync.PREFIX_)) {\n    var uid = evt.data.substring(spfAsync.PREFIX_.length)\n    spfAsync.run_(uid)\n  }\n}\n\n/**\n * Executes a previously deferred function.\n *\n * @param {string|number} uid The UID associated with the function.\n * @private\n */\nspfAsync.run_ = function (uid) {\n  var fn = spfAsync.defers_[uid]\n  if (fn) {\n    delete spfAsync.defers_[uid]\n    fn()\n  }\n}\n\n/**\n * Adds a function as a listener for message events.\n *\n * @param {!Function} fn The function to add as a listener.\n * @private\n */\nspfAsync.addListener_ = function (fn) {\n  if (window.addEventListener) {\n    window.addEventListener('message', fn, false)\n  } else if (window.attachEvent) {\n    window.attachEvent('onmessage', fn)\n  }\n}\n\n/**\n * Removes a function as a listener for message events.\n *\n * @param {!Function} fn The function to remove as a listener.\n * @private\n */\nspfAsync.removeListener_ = function (fn) {\n  if (window.removeEventListener) {\n    window.removeEventListener('message', fn, false)\n  } else if (window.detachEvent) {\n    window.detachEvent('onmessage', fn)\n  }\n}\n\n/**\n * Whether the browser supports asynchronous postMessage calls.\n *\n * @private {boolean}\n */\nspfAsync.POSTMESSAGE_SUPPORTED_ = (function () {\n  if (!window.postMessage) {\n    return false\n  }\n  // Use postMessage where available.  But, ensure that postMessage is\n  // asynchronous; the implementation in IE8 is synchronous, which defeats\n  // the purpose.  To detect this, use a temporary \"onmessage\" listener.\n  var supported = true\n  var listener = function () { supported = false }\n  // Add the listener, dispatch a message event, and remove the listener.\n  spfAsync.addListener_(listener)\n  window.postMessage('', '*')\n  spfAsync.removeListener_(listener)\n  // Return the status.  If the postMessage implementation is correctly\n  // asynchronous, then the value of the `supported` variable will be\n  // true, but if the postMessage implementation is synchronous, the\n  // temporary listener will have executed and set the `supported`\n  // variable to false.\n  return supported\n})()\n\n/**\n * The prefix to use for message event data to avoid conflicts.\n *\n * @private {string}\n */\nspfAsync.PREFIX_ = 'spf:'\n\n/**\n * Map of deferred function calls.\n * @private {!Object.<!Function>}\n */\nspfAsync.defers_ = {}\n\n// Automatic initialization for spfAsync.defers_.\n// When built for the bootloader, unconditionally set in state.\nif (SPF_BOOTLOADER) {\n  spfState.set(spfState.Key.ASYNC_DEFERS, spfAsync.defers_)\n} else {\n  if (!spfState.has(spfState.Key.ASYNC_DEFERS)) {\n    spfState.set(spfState.Key.ASYNC_DEFERS, spfAsync.defers_)\n  }\n  spfAsync.defers_ = /** @type {!Object.<!Function>} */ (\n      spfState.get(spfState.Key.ASYNC_DEFERS))\n}\n\n// Automatic initialization for spfState.Key.ASYNC_LISTENER.\n// When built for the bootloader, unconditionally set in state.\nif (SPF_BOOTLOADER) {\n  if (spfAsync.POSTMESSAGE_SUPPORTED_) {\n    spfAsync.addListener_(spfAsync.handleMessage_)\n    spfState.set(spfState.Key.ASYNC_LISTENER, spfAsync.handleMessage_)\n  }\n} else {\n  if (spfAsync.POSTMESSAGE_SUPPORTED_) {\n    if (spfState.has(spfState.Key.ASYNC_LISTENER)) {\n      spfAsync.removeListener_(/** @type {function(Event)} */ (\n          spfState.get(spfState.Key.ASYNC_LISTENER)))\n    }\n    spfAsync.addListener_(spfAsync.handleMessage_)\n    spfState.set(spfState.Key.ASYNC_LISTENER, spfAsync.handleMessage_)\n  }\n}\n\nexport default spfAsync\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/async/async.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview The primary SPF entry point.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport {spfBase} from './base'\nimport spfConfig from './config'\nimport spfDebug from './debug/debug'\nimport spfHistory from './history/history'\nimport spfNav from './nav/nav'\nimport spfNetStyle from './net/style'\nimport spfNetScript from './net/script'\n\nlet spfMain = {}\n\n/**\n * Initializes SPF.\n *\n * @param {Object=} opt_config Optional global configuration object.\n * @return {boolean} Whether SPF was successfully initialized.  If the HTML5\n *     history modification API is not supported, returns false.\n */\nspfMain.init = function (opt_config) {\n  var enable = spfMain.canInit_()\n  spfDebug.info('main.init ', 'enable=', enable)\n  spfConfig.init(opt_config)\n  if (enable) {\n    spfNav.init()\n  }\n  // Signal that the API is ready with custom event.  Only supported in IE 9+.\n  spfBase.dispatch(spfBase.EventName.READY)\n\n  return enable\n}\n\n/**\n * Checks to see if SPF can be initialized.\n *\n * @return {boolean}\n * @private\n */\nspfMain.canInit_ = function () {\n  return !!(typeof window.history.pushState === 'function' ||\n      spfHistory.getIframe().contentWindow.history.pushState)\n}\n\n/**\n * Disposes SPF.\n */\nspfMain.dispose = function () {\n  var enable = !!(typeof History !== 'undefined' && History.prototype.pushState)\n  if (enable) {\n    spfNav.dispose()\n  }\n  spfConfig.clear()\n}\n\n/**\n * Discovers existing script and style elements in the document and registers\n * them as loaded, once during initial code execution and again when the\n * document is ready to catch any resources in the page after SPF is included.\n * @private\n */\nspfMain.discover_ = function () {\n  spfNetScript.discover()\n  spfNetStyle.discover()\n  if (document.readyState == 'complete') {\n    // Since IE 8+ is supported for common library functions such as script\n    // and style loading, use both standard and legacy event handlers to\n    // discover existing resources.\n    if (document.removeEventListener) {\n      document.removeEventListener(\n          'DOMContentLoaded', spfMain.discover_, false)\n    } else if (document.detachEvent) {\n      document.detachEvent(\n          'onreadystatechange', spfMain.discover_)\n    }\n  }\n}\nif (document.addEventListener) {\n  document.addEventListener(\n      'DOMContentLoaded', spfMain.discover_, false)\n} else if (document.attachEvent) {\n  document.attachEvent(\n        'onreadystatechange', spfMain.discover_)\n}\nspfMain.discover_()\n\nexport default spfMain\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/main.js","// Copyright 2013 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Navigation-related request functions.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport {spfBase} from '../base'\nimport spfArray from '../array/array'\nimport spfAsync from '../async/async'\nimport spfCache from '../cache/cache'\nimport spfConfig from '../config'\nimport spfDebug from '../debug/debug'\nimport spfNavResponse from '../nav/response'\nimport spfNetXhr from '../net/xhr'\nimport spfString from '../string/string'\nimport spfUrl from '../url/url'\n\nlet spfNavRequest = {}\n// goog.provide('spfNavRequest');\n\n/**\n * Type definition for the configuration options for an SPF request.\n * - method: optional method with which to send the request; defaults to \"GET\".\n * - headers: optional map of headers to send with the request.\n * - onPart: optional callback to execute with the parts of a multipart\n *       response.  The first argumet is the requested URL; the second argument\n *       is the partial response object.  If valid\n *       \"X-SPF-Response-Type: multipart\" and \"Transfer-Encoding: chunked\"\n *       headers are sent, then this callback be executed on-the-fly as chunks\n *       are received.\n * - onError: optional callback to execute if the request fails. The first\n *       argument is the requested URL; the second argument is the Error that\n *       occurred. If the type of request is \"navigate\", the second argument\n *       might be false if the request was canceled in response to the global\n *       \"navigate-received\" callback. The third argument is the XMLHttpRequest\n *       object for error\n * - onSuccess: optional callback to execute if the request succeeds.  The first\n *       argument is the requested URL; the second is the response object.  The\n *       response object will be either a complete single response object or\n *       a complete multipart response object.\n * - postData: optional data to send with the request.  Only used if the method\n *       is set to \"POST\".\n * - current: optional current page URL, without the SPF identifier.\n * - referer: optional referrer URL, without the SPF identifier.\n * - type: optional type of request (e.g. \"navigate\", \"load\", etc), used to\n *       alter the URL identifier and XHR header and used to determine whether\n *       the global \"navigation received\" callback is executed; defaults to\n *       \"request\".\n * - withCredentials: optional flag to send credentials if true.\n *\n * @typedef {{\n *   method: (string|undefined),\n *   headers: (Object.<string>|undefined),\n *   onPart: (function(string, spfBase.SingleResponse)|undefined),\n *   onError: (function(string,\n *                   (Error|boolean),\n *                   (XMLHttpRequest|null|undefined))|undefined),\n *   onSuccess: (function(string,\n *                   (spfBase.SingleResponse|spfBase.MultipartResponse))|undefined),\n *   postData: spfNetXhr.PostData,\n *   current: (string|null|undefined),\n *   referer: (string|null|undefined),\n *   type: (string|undefined),\n *   withCredentials: (boolean|undefined)\n * }}\n */\nspfNavRequest.Options\n\n/**\n * Requests a URL using the SPF protocol and parses the response.  If\n * successful, the URL and response object are passed to the optional\n * `onSuccess` callback.  If not, the URL is passed to the optional\n * `onError` callback.  If chunked response are being used, the\n * URL and each partial response object will be passed to the optional\n * `onPart` callback as they are received.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNavRequest.Options=} opt_options Configuration options.\n * @return {XMLHttpRequest} The XHR of the current request.\n */\nspfNavRequest.send = function (url, opt_options) {\n  spfDebug.debug('nav.request.send ', url, opt_options)\n  var options = opt_options || /** @type {spfNavRequest.Options} */ ({})\n  options.method = ((options.method || 'GET') + '').toUpperCase()\n  options.type = options.type || 'request'\n  // Add the SPF identifier, to be used for sending the request.\n  var requestUrl = spfUrl.absolute(spfUrl.identify(url, options.type))\n  spfDebug.debug('    request url ', requestUrl)\n  // Record a the time before sending the request or loading from cache.\n  // The startTime is consistent with W3C PerformanceResourceTiming for XHRs.\n  var timing = {}\n  // Keep actual absolute SPF request url info.\n  timing['spfUrl'] = requestUrl\n  timing['startTime'] = spfBase.now()\n  // Try to find a cached response for the request before sending a new XHR.\n  // Record fetchStart time before loading from cache. If no cached response\n  // is found, this value will be replaced with the one provided by the XHR.\n  timing['fetchStart'] = timing['startTime']\n  var cacheKey = spfNavRequest.getCacheKey_(url, options.current, null,\n                                              options.type, false)\n  // Use the absolute URL without identifier to allow cached responses\n  // from prefetching to apply to navigation.\n  var cached = spfNavRequest.getCacheObject_(cacheKey, options.current)\n  timing['spfPrefetched'] = !!cached && cached.type == 'prefetch'\n  timing['spfCached'] = !!cached\n  if (cached) {\n    var response = /** @type {spfBase.SingleResponse|spfBase.MultipartResponse} */ (\n        cached.response)\n    // To ensure a similar execution pattern as an XHR, ensure the\n    // cache response is returned asynchronously.\n    var handleCache = spfBase.bind(spfNavRequest.handleResponseFromCache_, null,\n                               url, options, timing, cached.key, response)\n    // When WebKit browsers are in a background tab, setTimeout calls are\n    // deprioritized to execute with a 1s delay.  Avoid this by using\n    // postMessage to schedule execution; see spfAsync.delay for details.\n    spfAsync.defer(handleCache)\n    // Return null because no XHR is made.\n    return null\n  } else {\n    spfDebug.debug('    sending XHR')\n    var headers = {}\n    // Set headers provided by global config first.\n    var configHeaders = /** @type {Object.<string>} */ (\n      spfConfig.get('request-headers'))\n    if (configHeaders) {\n      for (var key in configHeaders) {\n        var value = configHeaders[key]\n        // Treat undefined and null values as equivalent to an empty string.\n        // Note that undefined == null.\n        headers[key] = (value == null) ? '' : value\n      }\n    }\n    // Set headers provided by options second, to allow overrides.\n    if (options.headers) {\n      for (var key in options.headers) {\n        var value = options.headers[key]\n        // Treat undefined and null values as equivalent to an empty string.\n        // Note that undefined == null.\n        headers[key] = (value == null) ? '' : value\n      }\n    }\n    // Allow empty referrer values in history.\n    // Note that undefined == null.\n    if (options.referer != null) {\n      headers['X-SPF-Referer'] = options.referer\n    }\n    if (options.current != null) {\n      headers['X-SPF-Previous'] = options.current\n    }\n    // As an advanced option, allow request identification via a header.  This\n    // will allow removal of the default identification via URL:\n    //     GET /path\n    //     Accept: application/json\n    //     X-SPF-Request: navigate\n    // instead of:\n    //     GET /path?spf=navigate\n    // But, it comes with 2 extra restrictions:\n    // (1) The server MUST return a `Vary` header on some value that is\n    // different between SPF requests and default browser requests to avoid\n    // caching problems.  The best way to manage this is usually via the\n    // `Accept` header.  Since JSON is used for transport of SPF responses,\n    // a request that sends a value of `application/json` will work and will\n    // be different than standard requests.  A list of defaults used by\n    // various browser can be found at\n    // https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation.\n    // For the quest shown above, the response should then include:\n    //      Vary: Accept\n    // (2) The server MUST use SPF-based redirection, as custom headers (i.e.\n    // the `X-SPF-Request` header) are typically not propgated by browsers\n    // during 30X HTTP redirection.\n    var headerId = /** @type {?string} */ (\n        spfConfig.get('advanced-header-identifier'))\n    if (headerId) {\n      headers['X-SPF-Request'] = headerId.replace('__type__', options.type)\n      headers['Accept'] = 'application/json'\n    }\n    var chunking = new spfNavRequest.Chunking_()\n    var handleHeaders = spfBase.bind(spfNavRequest.handleHeadersFromXHR_, null,\n                                 url, chunking)\n    var handleChunk = spfBase.bind(spfNavRequest.handleChunkFromXHR_, null,\n                               url, options, timing, chunking)\n    var handleComplete = spfBase.bind(spfNavRequest.handleCompleteFromXHR_, null,\n                                  url, options, timing, chunking)\n    var xhrOpts = {\n      headers: headers,\n      timeoutMs: /** @type {number} */ (spfConfig.get('request-timeout')),\n      onHeaders: handleHeaders,\n      onChunk: handleChunk,\n      onDone: handleComplete,\n      onTimeout: handleComplete\n    }\n\n    if (options.withCredentials) {\n      xhrOpts.withCredentials = options.withCredentials\n    }\n\n    // As an advanced option, allow XHR requests to enforce JSON responses.\n    // This can make response parsing more efficient by reducing contention on\n    // the main thread (especially for very large responses), but as a\n    // side-effect, it removes the ability to parse chunked multipart responses\n    // on-the-fly.\n    if (spfConfig.get('advanced-response-type-json')) {\n      xhrOpts.responseType = 'json'\n    }\n    var xhr\n    if (options.method == 'POST') {\n      xhr = spfNetXhr.post(requestUrl, options.postData, xhrOpts)\n    } else {\n      xhr = spfNetXhr.get(requestUrl, xhrOpts)\n    }\n    // Return the XHR being made.\n    return xhr\n  }\n}\n\n/**\n * Handles a cached response.\n * See {@link #send}.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNavRequest.Options} options Configuration options\n * @param {Object} timing Timing data.\n * @param {string} cacheKey The cache key.\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The cached SPF\n *     response object.\n * @private\n */\nspfNavRequest.handleResponseFromCache_ = function (url, options, timing,\n                                                    cacheKey, response) {\n  spfDebug.debug('nav.request.handleResponseFromCache_ ', url, response)\n  var updateCache = false\n  // Record the timing information.\n  // Record responseStart and responseEnd times after loading from cache.\n  timing['responseStart'] = timing['responseEnd'] = spfBase.now()\n  // Also record navigationStart for navigate requests, consistent with\n  // W3C PerformanceTiming for page loads.\n  if (options.type && spfString.startsWith(options.type, 'navigate')) {\n    timing['navigationStart'] = timing['startTime']\n    // If this cached response was a navigate and a unified cache is not being\n    // used, then it was from prefetch-based caching and is only eligible to\n    // be used once.\n    if (!spfConfig.get('cache-unified')) {\n      spfCache.remove(cacheKey)\n      // Ensure the response will be stored in the history-based caching.\n      updateCache = true\n    }\n  }\n  if (options.onPart && response['type'] == 'multipart') {\n    var parts = response['parts']\n    spfArray.each(parts, function (part) {\n      if (!part['timing']) {\n        part['timing'] = {}\n      }\n      part['timing']['spfCached'] = !!timing['spfCached']\n      part['timing']['spfPrefetched'] = !!timing['spfPrefetched']\n      options.onPart(url, part)\n    })\n  }\n  spfNavRequest.done_(url, options, timing, response, updateCache)\n}\n\n/**\n * Handles received headers from an XHR.\n * See {@link #send}.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNavRequest.Chunking_} chunking Chunking data.\n * @param {XMLHttpRequest} xhr The XHR of the current request.\n * @private\n */\nspfNavRequest.handleHeadersFromXHR_ = function (url, chunking, xhr) {\n  spfDebug.debug('nav.request.handleHeadersFromXHR_ ', url, xhr)\n  var responseType = xhr.getResponseHeader('X-SPF-Response-Type') || ''\n  var multipart = spfString.contains(responseType.toLowerCase(), 'multipart')\n  spfDebug.debug('    response is', (multipart ? '' : 'non-') + 'multipart')\n  chunking.multipart = multipart\n}\n\n/**\n * Handles a request chunk from an XHR as it arrives.\n * See {@link #send}.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNavRequest.Options} options Configuration options\n * @param {Object} timing Timing data.\n * @param {spfNavRequest.Chunking_} chunking Chunking data.\n * @param {XMLHttpRequest} xhr The XHR of the current request.\n * @param {string} chunk The current request chunk.\n * @param {boolean=} opt_lastDitch Whether to parse the chunk as the final\n *     one, potentially handling malformed but valid responses.\n * @private\n */\nspfNavRequest.handleChunkFromXHR_ = function (url, options, timing, chunking,\n                                               xhr, chunk, opt_lastDitch) {\n  spfDebug.debug('nav.request.handleChunkFromXHR_ ',\n                  url, {'extra': chunking.extra, 'chunk': chunk})\n  // Processing chunks as they arrive requires multipart responses.\n  if (!chunking.multipart) {\n    spfDebug.debug('    skipping non-multipart response')\n    return\n  }\n  var text = chunking.extra + chunk\n  var parsed\n  try {\n    parsed = spfNavResponse.parse(text, true, opt_lastDitch)\n  } catch (err) {\n    spfDebug.debug('    JSON parse failed', text)\n    xhr.abort()\n    if (options.onError) {\n      options.onError(url, err, xhr)\n    }\n    return\n  }\n  if (options.onPart) {\n    spfArray.each(parsed.parts, function (part) {\n      spfDebug.debug('    parsed part', part)\n      if (!part['timing']) {\n        part['timing'] = {}\n      }\n      part['timing']['spfCached'] = !!timing['spfCached']\n      part['timing']['spfPrefetched'] = !!timing['spfPrefetched']\n      options.onPart(url, part)\n    })\n  }\n  chunking.complete = chunking.complete.concat(parsed.parts)\n  chunking.extra = parsed.extra\n}\n\n/**\n * Handles a request from an XHR.  Called for both chunked and regular requests.\n * See {@link #send}.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNavRequest.Options} options Configuration options\n * @param {Object} timing Timing data.\n * @param {spfNavRequest.Chunking_} chunking Chunking data.\n * @param {XMLHttpRequest} xhr The XHR of the current request.\n * @private\n */\nspfNavRequest.handleCompleteFromXHR_ = function (url, options, timing,\n                                                  chunking, xhr) {\n  if (xhr.responseType == 'json') {\n    spfDebug.debug('nav.request.handleCompleteFromXHR_ ', url, xhr.response)\n  } else {\n    spfDebug.debug('nav.request.handleCompleteFromXHR_ ', url,\n                    {'extra': chunking.extra, 'complete': xhr.responseText})\n  }\n\n  // Record the timing information from the XHR.\n  if (xhr['timing']) {\n    for (var t in xhr['timing']) {\n      timing[t] = xhr['timing'][t]\n    }\n  }\n\n  // Record timings from Resource Timing API.\n  if (xhr['resourceTiming']) {\n    if (options.type == 'load') {\n      // Record relative timings.\n      for (var key in xhr['resourceTiming']) {\n        timing[key] = xhr['resourceTiming'][key]\n      }\n    } else if (window.performance && window.performance.timing) {\n      // Normalize relative Resource Timing values as\n      // Navigation Timing absolute values using navigationStart as base.\n      var navigationStart = window.performance.timing.navigationStart\n\n      // Use resource timing data (RT) only if RT.startTime is later than\n      // the one provided by SPF when request was initiated.\n      // This is specifically affecting Chrome 40+. See http://crbug.com/375388\n      var startTime = navigationStart + xhr['resourceTiming']['startTime']\n      if (startTime >= timing['startTime']) {\n        for (var metric in xhr['resourceTiming']) {\n          var value = xhr['resourceTiming'][metric]\n          if (value !== undefined && (spfString.endsWith(metric, 'Start') ||\n              spfString.endsWith(metric, 'End') || metric == 'startTime')) {\n            timing[metric] = navigationStart + Math.round(value)\n          }\n        }\n      }\n    }\n  }\n\n  // Also record navigationStart for all requests but load type, consistent with\n  // W3C PerformanceTiming for page loads.\n  if (options.type != 'load') {\n    timing['navigationStart'] = timing['startTime']\n  }\n\n  if (chunking.complete.length) {\n    // If a multipart response was parsed on-the-fly via chunking, it should be\n    // done.  However, check to see if there is any extra content, which could\n    // occur if the server failed to end a reponse with a token.\n    chunking.extra = spfString.trim(chunking.extra)\n    if (chunking.extra) {\n      // If extra content exists, parse it as a last-ditch effort.\n      spfNavRequest.handleChunkFromXHR_(url, options, timing, chunking,\n                                          xhr, '', true)\n    }\n  }\n\n  var parts\n  if (xhr.responseType == 'json') {\n    // If using the JSON `responseType`, parsing is complete and no chunking\n    // has been handled on-the-fly.\n    if (!xhr.response) {\n      spfDebug.debug('    JSON parse failed')\n      if (options.onError) {\n        options.onError(url, new Error('JSON response parsing failed'), xhr)\n      }\n      return\n    }\n    parts = spfNavResponse.extract(spfArray.toArray(xhr.response))\n  } else {\n    // Otherwise, parsing may need to be done.  Always attempt a full parse with\n    // error handling. A multipart response parsed on-the-fly via chunking may\n    // be invalid JSON if the response is truncated early.  (If truncated just\n    // after a token, the chunking.extra value will be empty and no additional\n    // chunk parsing will be done, but the overall response will stil be\n    // invalid.)\n    try {\n      var parsed = spfNavResponse.parse(xhr.responseText)\n      parts = parsed.parts\n    } catch (err) {\n      spfDebug.debug('    JSON parse failed')\n      if (options.onError) {\n        options.onError(url, err, xhr)\n      }\n      return\n    }\n  }\n\n  if (options.onPart && parts.length > 1) {\n    // Only execute callbacks for parts that have not already been processed.\n    // In case there is an edge case where some parts were parsed on-the-fly\n    // but the entire response needed a full parse here, start iteration where\n    // the chunk processing left off.  This is mostly a safety measure and\n    // the number of chunks processed here should be 0.\n    for (var i = chunking.complete.length; i < parts.length; i++) {\n      spfDebug.debug('    parsed part', parts[i])\n      var part = parts[i]\n      if (!part['timing']) {\n        part['timing'] = {}\n      }\n      part['timing']['spfCached'] = !!timing['spfCached']\n      part['timing']['spfPrefetched'] = !!timing['spfPrefetched']\n      options.onPart(url, part)\n    }\n  }\n  var response\n  if (parts.length > 1) {\n    var cacheType\n    spfArray.each(parts, function (part) {\n      if (part['cacheType']) {\n        cacheType = part['cacheType']\n      }\n    })\n    response = /** @type {spfBase.MultipartResponse} */ ({\n      'parts': parts,\n      'type': 'multipart'\n    })\n    if (cacheType) {\n      response['cacheType'] = cacheType\n    }\n  } else if (parts.length == 1) {\n    response = /** @type {spfBase.SingleResponse} */(parts[0])\n  } else {\n    response = /** @type {spfBase.SingleResponse} */({})\n  }\n  spfNavRequest.done_(url, options, timing, response, true)\n}\n\n/**\n * Finishes a request.\n * See {@link #send}.\n *\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {spfNavRequest.Options} options Configuration options.\n * @param {Object} timing Timing data.\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The received SPF\n *   response object.\n * @param {boolean} cache Whether to store the response in the cache.\n * @private\n */\nspfNavRequest.done_ = function (url, options, timing, response, cache) {\n  spfDebug.debug('nav.request.done_', url, options, timing, response, cache)\n  if (cache && options.method != 'POST') {\n    // Cache the response for future requests.\n    var cacheKey = spfNavRequest.getCacheKey_(url, options.current,\n                                                response['cacheType'],\n                                                options.type, true)\n    if (cacheKey) {\n      response['cacheKey'] = cacheKey\n      spfNavRequest.setCacheObject_(cacheKey, response, options.type || '')\n    }\n  }\n  // Set the timing for the response (avoid caching stale timing values).\n  response['timing'] = timing\n  if (options.onSuccess) {\n    options.onSuccess(url, response)\n  }\n}\n\n/**\n * @param {string} url The requested URL, without the SPF identifier.\n * @param {string|null|undefined} opt_current The current page's URL. Some\n *     responses are only cacheable for limited origin URLs.\n * @param {string|null|undefined} opt_cacheType The type of cache used for\n *     this request (e.g. \"global\", \"path\", \"url\").\n * @param {string=} opt_requestType Type of request (e.g. \"navigate\", \"load\",\n *     etc).\n * @param {boolean=} opt_set Whether getting or setting the cache.\n * @return {string} The cache key for the URL.\n * @private\n */\nspfNavRequest.getCacheKey_ = function (url, opt_current, opt_cacheType,\n                                      opt_requestType, opt_set) {\n  // Use the absolute URL without identifier to ensure consistent caching.\n  var absoluteUrl = spfUrl.absolute(url)\n  var cacheKey\n  if (spfConfig.get('cache-unified')) {\n    // If using a unified cache, the key is just the URL to allow cached\n    // responses from prefetching to apply to navigation, etc.  This also\n    // means that load requests are cached unless they are sent via POST.\n    cacheKey = absoluteUrl\n  } else {\n    // Otherwise, caching is split between history and prefetching by using\n    // a key prefix.  Regular non-history navigation is only eligible for\n    // prefetch-based caching.\n    if (opt_requestType == 'navigate-back' ||\n        opt_requestType == 'navigate-forward') {\n      // For back/forward, get and set to history cache.\n      cacheKey = 'history ' + absoluteUrl\n    } else if (opt_requestType == 'navigate') {\n      // For navigation, get from prefetch cache, but set to history cache.\n      cacheKey = (opt_set ? 'history ' : 'prefetch ') + absoluteUrl\n    } else if (opt_requestType == 'prefetch') {\n      // For prefetching, never get, only set to prefetch cache.\n      cacheKey = opt_set ? ('prefetch ' + absoluteUrl) : ''\n    }\n  }\n\n  if (opt_current && opt_cacheType == 'url') {\n    cacheKey += ' previous ' + opt_current\n  } else if (opt_current && opt_cacheType == 'path') {\n    cacheKey += ' previous ' + spfUrl.path(opt_current)\n  }\n\n  return cacheKey || ''\n}\n\n/**\n * Get an object from cache if available.\n *\n * @param {string} cacheKey The base cache key for the requested URL.\n * @param {string|null|undefined} opt_current The current page's URL. Some\n *     responses are only cacheable for limited origin URLs.\n * @return {Object.<string, *>} The response object if found in the cache.\n * @private\n */\nspfNavRequest.getCacheObject_ = function (cacheKey, opt_current) {\n  var keys = []\n  if (opt_current) {\n    keys.push(cacheKey + ' previous ' + opt_current)\n    keys.push(cacheKey + ' previous ' + spfUrl.path(opt_current))\n  }\n  keys.push(cacheKey)\n\n  var cacheValue = null\n\n  // Find the first cached object and break loop early when found.\n  spfArray.some(keys, function (key) {\n    var obj = spfCache.get(key)\n    if (obj) {\n      cacheValue = {\n        key: key,\n        response: obj['response'],\n        type: obj['type']\n      }\n    }\n    return !!obj\n  })\n\n  return cacheValue\n}\n\n/**\n * Set a response object into cache with the given key.\n *\n * @param {string} cacheKey The base cache key for the requested URL.\n * @param {spfBase.SingleResponse|spfBase.MultipartResponse} response The received SPF\n *     response object.\n * @param {string} type The type of request this cache entry was set with.\n * @private\n */\nspfNavRequest.setCacheObject_ = function (cacheKey, response, type) {\n  var cacheValue = {\n    'response': response,\n    'type': type\n  }\n  spfCache.set(cacheKey, cacheValue,  /** @type {number} */ (\n      spfConfig.get('cache-lifetime')))\n}\n\n/**\n * Container for holding data to track chunking for an SPF request.\n *\n * @constructor\n * @struct\n * @private\n */\nspfNavRequest.Chunking_ = function () {\n  /**\n   * Whether the request is multipart.\n   * @type {boolean}\n   */\n  this.multipart = false\n  /**\n   * Any extra text from a previous chunk that was not successfully\n   * parsed on its own, usually due to an incomplete part split across\n   * chunk boundaries; combined with the text of a current chunk to complete.\n   * @type {string}\n   */\n  this.extra = ''\n  /**\n   * Complete parts that have been successfully parsed.\n   * @type {!Array}\n   */\n  this.complete = []\n}\n\nexport default spfNavRequest\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/nav/request.js","// Copyright 2014 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Functions for handling connections (i.e. pre-resolving DNS\n * and establishing the TCP AND TLS handshake).\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\nimport spfArray from '../array/array'\nimport spfNetResource from '../net/resource'\n\nlet spfNetConnect = {}\n// goog.provide('spfNetConnect');\n\n/**\n * Preconnects to a URL.\n * Use to both resolve DNS and establish connections before requests are made.\n *\n * @param {string|Array.<string>} urls One or more URLs to preconnect.\n */\nspfNetConnect.preconnect = function (urls) {\n  // Use an <img> tag to handle the preconnect in a compatible manner.\n  var type = spfNetResource.Type.IMG\n  // Convert to an array if needed.\n  urls = spfArray.toArray(urls)\n  spfArray.each(urls, function (url) {\n    // When preconnecting, always fetch the image and make the request.\n    // This is necessary to consistenly establish connections to repeat\n    // URLs when the keep-alive time is shorter than the interval between\n    // attempts.\n    spfNetResource.prefetch(type, url, true)  // Force repeat fetching.\n  })\n}\n\nexport default spfNetConnect\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/net/connect.js","// Copyright 2012 Google Inc. All rights reserved.\n//\n// Use of this source code is governed by The MIT License.\n// See the LICENSE file for details.\n\n/**\n * @fileoverview Streamlined XMLHttpRequest handling functions.\n *\n * @author nicksay@google.com (Alex Nicksay)\n */\n\n// goog.provide('spfNetXhr');\n\nimport {spfBase} from '../base'\nlet spfNetXhr = {}\n\n// goog.require('spf');\n\n/**\n * Type definition for the configuration options for an XMLHttpRequest.\n * - headers: map of header key/value pairs.\n * - onChunk: optional callback to execute as chunks of the XHR response\n *      are received.  Only called if a valid \"Transfer-Encoding: chunked\"\n *      header is received.  Each execution of the callback will pass the\n *      current chunk in addition to the XHR object.\n * - onDone: optional callback to execute once the XHR response has been\n *      been completely received .\n * - onHeaders: optional callback to execute once the XHR response headers\n *      have been received.\n * - onTimeout: optional callback to execute if the XHR times out.  Only called\n *      if a timeout is configured.\n * - responseType: type to create from the XHR response.\n * - timeoutMs: number of milliseconds after which the request will be timed\n *      out by the client. Default is to allow the browser to handle timeouts.\n * - withCredentials: optional flag to send credentials if true.\n *\n * @typedef {{\n *   headers: (Object.<string>|undefined),\n *   onChunk: (function(XMLHttpRequest, string)|undefined),\n *   onDone: (function(XMLHttpRequest)|undefined),\n *   onHeaders: (function(XMLHttpRequest)|undefined),\n *   onTimeout: (function(XMLHttpRequest)|undefined),\n *   responseType: (string|undefined),\n *   timeoutMs: (number|undefined),\n *   withCredentials: (boolean|undefined)\n * }}\n */\nspfNetXhr.Options\n\n/**\n * Type definition for POST data.\n * @typedef {(ArrayBuffer|Blob|Document|FormData|null|string|undefined)}\n */\nspfNetXhr.PostData\n\n/**\n * Sends an XMLHttpRequest object as asynchronous GET request.\n *\n * @param {string} url The URL to send the XHR to.\n * @param {spfNetXhr.Options=} opt_options Configuration options for the XHR.\n * @return {XMLHttpRequest} The XHR object being sent.\n */\nspfNetXhr.get = function (url, opt_options) {\n  return spfNetXhr.send('GET', url, null, opt_options)\n}\n\n/**\n * Sends an XMLHttpRequest object as asynchronous POST request.\n *\n * @param {string} url The URL to send the XHR to.\n * @param {spfNetXhr.PostData} data The data to send with the XHR.\n * @param {spfNetXhr.Options=} opt_options Configuration options for the XHR.\n * @return {XMLHttpRequest} The XHR object being sent.\n */\nspfNetXhr.post = function (url, data, opt_options) {\n  return spfNetXhr.send('POST', url, data, opt_options)\n}\n\n/**\n * Sends an XMLHttpRequest object.\n *\n * @param {string} method The HTTP method for the XHR.\n * @param {string} url The URL to send the XHR to.\n * @param {spfNetXhr.PostData} data The data to send with the XHR.\n * @param {spfNetXhr.Options=} opt_options Configuration options for the XHR.\n * @return {XMLHttpRequest} The XHR object being sent.\n */\nspfNetXhr.send = function (method, url, data, opt_options) {\n  var options = opt_options || {}\n  var chunked = false\n  var offset = 0\n  var timer\n\n  var xhr = new XMLHttpRequest()\n  xhr.open(method, url, true)\n  xhr['timing'] = {}\n\n  // Overload the abort method to handle the timer.\n  var xhr_abort = xhr.abort\n  xhr.abort = function () {\n    clearTimeout(timer)\n    xhr.onreadystatechange = null\n    xhr_abort.call(xhr)\n  }\n\n  xhr.onreadystatechange = function () {\n    var timing = xhr['timing']\n    if (xhr.readyState == spfNetXhr.State.HEADERS_RECEIVED) {\n      // Record responseStart time when first byte is received.\n      timing['responseStart'] = timing['responseStart'] || spfBase.now()\n      // Determine whether to process chunks as they arrive.\n      chunked = spfNetXhr.isChunked_(xhr)\n      if (options.onHeaders) {\n        options.onHeaders(xhr)\n      }\n    } else if (xhr.readyState == spfNetXhr.State.LOADING) {\n      if (chunked && options.onChunk) {\n        var chunk = xhr.responseText.substring(offset)\n        offset = xhr.responseText.length\n        options.onChunk(xhr, chunk)\n      }\n    } else if (xhr.readyState == spfNetXhr.State.DONE) {\n      // Record responseEnd time when full response is received.\n      timing['responseEnd'] = timing['responseEnd'] || spfBase.now()\n      // Record Resource Timing relative timings (where available) to later be\n      // converted into Navigation Timing absolute timings.\n      if (window.performance && window.performance.getEntriesByName) {\n        // Get always the latest entry available just in case old entries were\n        // not cleared out by performance.clearResourceTimings.\n        xhr['resourceTiming'] = window.performance.getEntriesByName(url).pop()\n      }\n      // If processing chunks as they arrive and the state was transitioned\n      // at response end to DONE without a LOADING, process the final chunk now.\n      if (chunked && options.onChunk && xhr.responseText.length > offset) {\n        var chunk = xhr.responseText.substring(offset)\n        offset = xhr.responseText.length\n        options.onChunk(xhr, chunk)\n      }\n      clearTimeout(timer)\n      if (options.onDone) {\n        options.onDone(xhr)\n      }\n    }\n  }\n\n  // If requested, attempt to use the JSON `responseType` to optimize parsing.\n  // If the browser supports `responseType` but not the `\"json\"` type, then\n  // the property will remain unset.\n  // NOTE: This removes the ability to handle chunked responses on the fly.\n  if ('responseType' in xhr && options.responseType == 'json') {\n    xhr.responseType = 'json'\n  }\n\n  if (options.withCredentials) {\n    xhr.withCredentials = options.withCredentials\n  }\n\n  // For POST, default to `Content-Type: application/x-www-form-urlencoded`\n  // unless a custom header was given.\n  var isFormData = ('FormData' in window && data instanceof FormData)\n  var addContentTypeFormUrlEncoded = (method == 'POST' && !isFormData)\n  if (options.headers) {\n    for (var key in options.headers) {\n      xhr.setRequestHeader(key, options.headers[key])\n      if (key.toLowerCase() == 'content-type') {\n        addContentTypeFormUrlEncoded = false\n      }\n    }\n  }\n  if (addContentTypeFormUrlEncoded) {\n    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')\n  }\n\n  // Set the timer if a timeout value was specified.\n  if (options.timeoutMs > 0) {\n    timer = setTimeout(function () {\n      xhr.abort()\n      if (options.onTimeout) {\n        options.onTimeout(xhr)\n      }\n    }, options.timeoutMs)\n  }\n\n  // Record fetchStart time when request is sent.\n  xhr['timing']['fetchStart'] = spfBase.now()\n  xhr.send(data)\n\n  return xhr\n}\n\n/**\n * Determines whether to process chunks as they arrive; should be called when\n * the XHR headers are received.  See {@link #send}.\n *\n * @param {XMLHttpRequest} xhr The XHR object being sent.\n * @return {boolean}\n * @private\n */\nspfNetXhr.isChunked_ = function (xhr) {\n  if (xhr.responseType == 'json') {\n    return false\n  }\n  // Determine whether to process chunks as they arrive.\n  // This is only possible with chunked transfer encoding.\n  // Note: handle Transfer-Encoding header values like:\n  //   \"chunked\"  (standard)\n  //   \"Chunked\"  (non-standard)\n  //   \"chunked, chunked\"  (multiple headers sent)\n  var encoding = xhr.getResponseHeader('Transfer-Encoding') || ''\n  if (encoding.toLowerCase().indexOf('chunked') > -1) {\n    return true\n  }\n  // SPDY inherently uses chunked transfer and does not define a header.\n  // Firefox provides a synthetic header which can be used instead.\n  // For Chrome, a non-standard JS function must be used to determine if\n  // the primary document was loaded with SPDY.  If the primary document\n  // was loaded with SPDY, then most likely the XHR will be as well.\n  var firefoxSpdy = xhr.getResponseHeader('X-Firefox-Spdy')\n  var loadTimes = window.chrome && chrome.loadTimes && chrome.loadTimes()\n  var chromeSpdy = loadTimes && loadTimes.wasFetchedViaSpdy\n  return !!(firefoxSpdy || chromeSpdy)\n}\n\n/**\n * @enum {number}\n */\nspfNetXhr.State = {\n  UNSENT: 0,\n  OPENED: 1,\n  HEADERS_RECEIVED: 2,\n  LOADING: 3,\n  DONE: 4\n}\nexport default spfNetXhr\n\n\n\n// WEBPACK FOOTER //\n// ./app/javascript/packs/spf/net/xhr.js","module.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tif(!module.children) module.children = [];\r\n\t\tObject.defineProperty(module, \"loaded\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.l;\r\n\t\t\t}\r\n\t\t});\r\n\t\tObject.defineProperty(module, \"id\", {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function() {\r\n\t\t\t\treturn module.i;\r\n\t\t\t}\r\n\t\t});\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n};\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/module.js\n// module id = 85\n// module chunks = 0"],"sourceRoot":""}